<html><head><link href="main.css" rel="stylesheet"></head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>Bardo</title><body class="full"><div id="root"><canvas id="ui"></canvas><canvas id="upgrades"></canvas><canvas id="map"></canvas><canvas id="gameplay"></canvas></div><script>(()=>{var t={705:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.i=void 0;s.i=function(t){var s=void 0===t?{}:t,i=s.h,e=void 0===i?0:i,n=s.o,h=void 0===n?-1:n,r=s.u,o=void 0===r?1:r,a=s.l,u=void 0===a?1:a,c=s.v,l=void 0===c?0:c,f=s.g,d=void 0===f?0:f,v=s.p,g=void 0!==v&&v;if(e<h||e>o)throw new Error("yStart must be between yMin and yMax");var p=2*Math.PI,w=(h+o)/2,y=(o-h)/2,m=g?-1:1,M=Math.asin(2*(e-h)/(o-h)-1)*(u/p);return function(t){return w+y*Math.sin(m*(p*(t-l+M))/u)+d}}},257:function(t,s,i){"use strict";var e=this&&this.m||(Object.create?function(t,s,i,e){void 0===e&&(e=i),Object.defineProperty(t,e,{M:!0,get:function(){return s[i]}})}:function(t,s,i,e){void 0===e&&(e=i),t[e]=s[i]}),n=this&&this.S||function(t,s){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(s,i)||e(s,t,i)};Object.defineProperty(s,"t",{value:!0}),n(i(705),s)},712:function(t,s,i){"use strict";var e=this&&this._||function(){return e=Object.assign||function(t){for(var s,i=1,e=arguments.length;i<e;i++)for(var n in s=arguments[i])Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);return t},e.apply(this,arguments)};Object.defineProperty(s,"t",{value:!0}),s.O=s.j=void 0;var n=i(839),h=i(603),r=i(674);!function(t){t.k="width",t.A="height"}(s.j||(s.j={}));var o=function(){function t(t,s){var i;void 0===s&&(s={}),this.context=t,this.coords=null!==(i=s.coords)&&void 0!==i?i:new n.R({canvas:t.canvas});var h={beginPath:!0,closePath:!1,fill:!1,C:-1,N:!0,stroke:!1,P:!1,L:!1,D:!1,W:0,U:!1,random:Math.random};this.options=e(e({},h),s),this.options.I=e(e({},{fontFamily:"sans-serif",fontSize:16}),s.I)}return t.prototype.rect=function(t,s,i,e,n){void 0===t&&(t=0),void 0===s&&(s=0),void 0===i&&(i=1),void 0===e&&(e=1),void 0===n&&(n={}),this.B("roughness",n)?this.F(t,s,i,e,n):this.K(t,s,i,e,n)},t.prototype.F=function(t,s,i,n,h){var r=this.q(t),o=this.H(s),a=this.T(i),u=this.$(n),c=[[r,o],[r+a,o],[r+a,o+u],[r,o+u],[r,o]];this.J(c,e(e({},h),{P:!1,N:!0,U:!0}))},t.prototype.K=function(t,s,i,e,n){this.Y(n),this.context.rect(this.q(t,n),this.H(s,n),this.T(i),this.$(e)),this.V(n)},t.prototype.J=function(t,s){void 0===s&&(s={}),this.B("roughness",s)?this.X(t,s):this.G(t,s)},t.prototype.G=function(t,s){this.Y(s);for(var i=0;i<t.length;i++){var e=this.q(t[i][0],s),n=this.H(t[i][1],s);0===i?this.context.moveTo(e,n):this.context.lineTo(e,n)}this.V(s)},t.prototype.X=function(t,s){for(var i=this.B("roughness",s)||0,h=this.B("random",s),r=t.length-1,o=0;o<2;o++){for(var a=[],u=0;u<r;u++)for(var c=t[u],l=c[0],f=c[1],d=t[u+1],v=d[0],g=d[1],p=i*Math.sqrt(Math.pow(l-v,2)+Math.pow(f-g,2)),w=0;w<4;w++){var y=h()*p,m=h()*n.Z,M=y*Math.cos(m),b=y*Math.sin(m),S=NaN,_=NaN;if(0===w&&(S=l+M,_=f+b),1===w){var O=.5;S=(0,n.tt)(O,l,v)+M,_=(0,n.tt)(O,f,g)+b}if(2===w){O=.75;S=(0,n.tt)(O,l,v)+M,_=(0,n.tt)(O,f,g)+b}3===w&&(s.U&&u===r-1?(S=a[0][0],_=a[0][1]):(S=v+M,_=g+b)),a.push([S,_])}var x=0===o?s:e(e({},s),{fill:!1});this.st(a,x)}},t.prototype.st=function(t,s){var i=this;void 0===s&&(s={}),this.Y(s);for(var e=0;e<t.length-1;e++){var n=this.q(t[e][0],s),h=this.H(t[e][1],s);if(0===e)this.context.moveTo(n,h);else{var r=this.q(t[e+1][0],s),o=this.H(t[e+1][1],s);if(r===n&&o===h)this.context.lineTo(r,o);else{var a=(n+r)/2,u=(h+o)/2;this.context.quadraticCurveTo(n,h,a,u)}}}t.slice(-1).forEach((function(t){i.context.lineTo(i.q(t[0],s),i.H(t[1],s))})),this.V(s)},t.prototype.it=function(t,s,i,e){void 0===e&&(e={}),this.B("roughness",e)?this.et(t,s,i,e):this.nt(t,s,i,e)},t.prototype.nt=function(t,s,i,e){this.Y(e),this.context.arc(this.q(t,e),this.H(s,e),this.ht(i,e),0,n.Z),this.V(e)},t.prototype.et=function(t,s,i,h){for(var r=this.B("roughness",h),o=this.B("random",h),a=r*this.ht(i,h)/window.innerWidth,u=0;u<2;u++){for(var c=[],l=0;l<16;l++){var f=o()*a,d=o()*n.Z,v=f*Math.cos(d),g=f*Math.sin(d),p=n.Z*l/16,w=this.q(t+v,h)+Math.cos(p)*this.ht(i,h),y=this.H(s+g,h)+Math.sin(p)*this.ht(i,h);c.push([w,y])}c[16]=c[0],c[17]=c[1],this.st(c,e(e({},h),{P:!1,N:!0,U:!0}))}},t.prototype.drawImage=function(t,s,i,e){void 0===e&&(e={}),this.Y(e),this.context.drawImage(t,this.q(s,e),this.H(i,e)),this.V(e)},t.prototype.rt=function(t,s,i,h,r,o){void 0===o&&(o={}),this.J((0,n.rt)(this.q(t,o),this.H(s,o),this.ht(i,o),h,r),e(e({},o),{P:!1,N:!0}))},t.prototype.ot=function(t,s,i,h,r){void 0===r&&(r={});var o=this.B("roughness",r);this.J((0,n.ot)(this.q(t,r),this.H(s,r),this.ht(i,r),h),e(e({},r),{P:!1,N:!0,U:Boolean(o)}))},t.prototype.ut=function(t){this.ct(e(e({},this.options.I),t))},t.prototype.text=function(t,s,i,e){void 0===e&&(e={}),this.B("roughness",e)?this.lt(t,s,i,e):this.ft(t,s,i,e)},t.prototype.ft=function(t,s,i,e){void 0===e&&(e={}),this.Y(e);var n=this.B("maxTextWidth",e);this.context.fillText(t,this.q(s,e),this.H(i,e),n>0?n:void 0),this.V(e)},t.prototype.lt=function(t,s,i,h){var o=this;void 0===h&&(h={});var a=this.dt(t,h.I),u=a.actualBoundingBoxAscent,c=a.actualBoundingBoxDescent,l=a.width,f=this.B("roughness",h),d=this.B("random",h),v=t.split(""),g=u-c,p=this.coords.vt(g),w=l/v.length,y=this.coords.gt(w)-this.coords.gt(0),m=y*v.length;this.ut(h.I),v.forEach((function(t,a){var u,c;if("left"===o.context.textAlign)c=(u=s+y*a)+y/2;else if("right"===o.context.textAlign)c=(u=-m+s+y*(a+1))-y/2;else{if("center"!==o.context.textAlign)throw new Error("textAlign must be 'left', 'right', or 'center' to use rough text");c=u=-m/2+s+y*(.5+a)}var v,g=i;if("top"===o.context.textBaseline)v=g-p/2;else if("bottom"===o.context.textBaseline)v=g-p/2;else{if("middle"!==o.context.textBaseline)throw new Error("textBaseline must be 'top', 'bottom', or 'middle' to use rough text");v=g}var w=f*l*.05,M=[(0,n.random)(Math.min(.4,w/6.5),0,d)*y,(0,n.random)(Math.min(.4,w/6.5),0,d)*y],b=[(0,n.random)(Math.min(.4,w/6.5),0,d)*p,(0,n.random)(Math.min(.4,w/6.5),0,d)*p];o.ft(t,u+M[0],g+b[0],e(e({},h),{I:e(e({},h.I),{rotation:{origin:new r.wt(c,v),rotation:w*Math.PI/16}})})),o.ft(t,u+M[1],g+b[1],e(e({},h),{I:e(e({},h.I),{rotation:{origin:new r.wt(c,v),rotation:-w*Math.PI/16}})}))}))},t.prototype.clear=function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.yt=function(t,s){void 0===s&&(s={}),t.width=t.clientWidth*(s.Mt?h.bt:1),t.height=t.clientHeight*(s.Mt?h.bt:1)},t.prototype.q=function(t,s){return void 0===s&&(s={}),this.B("useNormalCoordinates",s)?this.coords.St(t):t},t.prototype.H=function(t,s){return void 0===s&&(s={}),this.B("useNormalCoordinates",s)?this.coords._t(t):t},t.prototype.T=function(t){return this.coords.width(t)},t.prototype.$=function(t){return this.coords.height(t)},t.prototype.ht=function(t,s){void 0===s&&(s={});var i=this.B("scalarNormalization",s);return"width"===i?this.coords.width(t):"height"===i?this.coords.height(t):t},t.prototype.B=function(t,s){var i=s&&t in s?s[t]:this.options[t];return console.assert(null!=i,"A value for ".concat(i," could not be resolved.")),i},t.prototype.Ot=function(t,s){var i=s&&t in s?s[t]:this.options.I[t];return"function"==typeof i?i(this.coords):i},t.prototype.xt=function(t){var s=this.Ot("fontSize",t),i=this.Ot("lineHeight",t),e=this.Ot("fontStyle",t),n=this.Ot("fontFamily",t),h=this.Ot("fontWeight",t),r=this.Ot("fontStretch",t),o="number"==typeof s?"".concat(s,"px"):void 0;return i&&o&&(o="".concat(s," / ").concat(i,"}")),[o,n,e,h,r].join(" ").trim()},t.prototype.ct=function(t){for(var s in t){var i=this.Ot(s,t);if(!(0,n.jt)(i)){if("transform"===s&&this.context.setTransform(i),"translation"===s){var e=i,h=e.x,r=e.y;this.context.translate(this.q(h),this.H(r))}if("rotation"===s)if("number"==typeof i)this.context.rotate(i);else{var o=i,a=o.rotation,u=o.origin,c=this.q(u.x),l=this.H(u.y);this.context.translate(c,l),this.context.rotate(a),this.context.translate(-c,-l)}if("scale"===s)if("origin"in i){var f=i,d=f.origin,v=f.scale,g=f.kt,p=void 0!==g&&g;c=this.q(d.x),l=this.H(d.y);this.context.translate(c,l),this.context.scale(v.x,v.y),this.context.translate(-c,-l),p&&(this.context.lineWidth=this.context.lineWidth*(1/((v.x+v.y)/2)))}else{var w=i;h=w.x,r=w.y;this.context.scale(h,r)}"lineDash"===s&&this.context.setLineDash(i),"alpha"===s&&(this.context.globalAlpha=i),s in this.context&&"function"!=typeof this.context[s]&&(this.context[s]=this.Ot(s,t))}}this.context.font=this.xt(t)},t.prototype.Y=function(t){void 0===t&&(t={}),this.B("saveAndRestore",t)&&this.context.save(),this.B("skipApplyStyles",t)||this.ut(t.I),this.B("beginPath",t)&&this.context.beginPath()},t.prototype.V=function(t){this.B("closePath",t)&&this.context.closePath(),this.B("fill",t)&&this.context.fill(),this.B("stroke",t)&&this.context.stroke(),this.B("saveAndRestore",t)&&this.context.restore()},t.prototype.dt=function(t,s){this.context.save(),this.ut(s);var i=this.context.measureText(t);return this.context.restore(),i},t}();s.O=o},659:function(t,s,i){"use strict";var e=this&&this._||function(){return e=Object.assign||function(t){for(var s,i=1,e=arguments.length;i<e;i++)for(var n in s=arguments[i])Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);return t},e.apply(this,arguments)};Object.defineProperty(s,"t",{value:!0}),s.R=void 0;var n,h=i(654),r=i(796),o=i(908),a=i(482);!function(t){t.At="up",t.Rt="down"}(n||(n={}));var u=function(){function t(t){if(void 0===t&&(t={}),(0,r.jt)(t.canvas)&&(0,h.Ct)(t.zt,t.Nt))throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");Object.assign(this,e(e({},{Pt:[-1,1],Et:[-1,1],Lt:!1,orientationY:"down",Dt:!1}),t))}return t.prototype.Wt=function(){var t;return null!==(t=this.zt)&&void 0!==t?t:this.canvas.width},t.prototype.Ut=function(){return this.Wt()-2*this.It()},t.prototype.Bt=function(){var t;return null!==(t=this.Nt)&&void 0!==t?t:this.canvas.height},t.prototype.Ft=function(){return this.Bt()-2*this.Kt()},t.prototype.qt=function(){var t,s;return null!==(s=null!==(t=this.Ht)&&void 0!==t?t:this.padding)&&void 0!==s?s:0},t.prototype.It=function(){return this.qt()*this.Wt()},t.prototype.Tt=function(){return(0,r.jt)(this.$t)?(0,r.jt)(this.padding)?0:this.Dt?this.padding*(this.Wt()/this.Bt()):this.padding:this.$t},t.prototype.Kt=function(){return this.Tt()*this.Bt()},t.prototype.Jt=function(){var t;return null!==(t=this.offsetX)&&void 0!==t?t:0},t.prototype.Yt=function(){var t;return null!==(t=this.offsetY)&&void 0!==t?t:0},t.prototype.St=function(t){var s=(0,a.normalize)(t,this.Pt[0],this.Pt[1],this.Lt);return this.It()+this.Jt()+s*this.Ut()},t.prototype._t=function(t){var s=(0,a.normalize)(t,this.Et[0],this.Et[1],this.Lt),i=this.Vt===n.At;return this.Kt()+this.Yt()+(i?1-s:s)*this.Ft()},t.prototype.gt=function(t){var s=(0,a.normalize)(t,this.It(),this.It()+this.width(),this.Lt);return(0,o.tt)(s,this.Pt[0],this.Pt[1])},t.prototype.Xt=function(t){var s=(0,a.normalize)(t,this.Kt(),this.Kt()+this.height(),this.Lt);return(0,o.tt)(s,this.Pt[0],this.Pt[1])},t.prototype.width=function(t){return this.Ut()*(null!=t?t:1)},t.prototype.height=function(t){return this.Ft()*(null!=t?t:1)},t.prototype.Gt=function(t){return this.gt(t)-this.gt(0)},t.prototype.vt=function(t){return this.Xt(t)-this.Xt(0)},t}();s.R=u},326:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.Qt=void 0;var e=i(839);s.Qt=function(t,s){if(t.parentElement){var i=t.parentElement,n=s.x,h=s.y,r=new ResizeObserver((function(){var s=i.getBoundingClientRect(),r=s.width,o=s.height,a=Math.min(r/n,o/h),u=t.clientWidth,c=t.clientHeight,l=Math.round(a*n),f=Math.round(a*h);l===u&&f===c||(t instanceof HTMLCanvasElement&&(t.width=l*e.bt,t.height=f*e.bt),t.style.width=l+"px",t.style.height=f+"px")}));return r.observe(i),r}return console.warn("aspectRatioResize: element has no parent and cannot be resized"),null}},999:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.Zt=void 0;s.Zt=function(t,s,i){var e=i*Math.sqrt(3)/2;return[[t,s-2*e/3],[t+i/2,s*(e/3)],[t-i/2,s*(e/3)]]}},125:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ts=void 0;s.ts=function(t,s,i,e){var n=Math.sqrt(e*e/4-i*i);return[[t,s-2*n/3],[t+e/2,s*(n/3)],[t-e/2,s*(n/3)]]}},932:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ot=void 0;var e=i(965);s.ot=function(t,s,i,n){void 0===n&&(n=5);for(var h=[],r=0,o=n;r<=o;r++){var a=-e.PI/(2*n)+e.Z*(r/o);h.push([t+Math.cos(a)*i,s+Math.sin(a)*i])}return h}},166:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ss=void 0;s.ss=function(t,s,i,e,n){return[Math.cos(n)*(t-i)-Math.sin(n)*(s-e)+i,Math.sin(n)*(t-i)+Math.cos(n)*(s-e)+e]}},154:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.rt=void 0;var e=i(965);s.rt=function(t,s,i,n,h){void 0===n&&(n=5),void 0===h&&(h=.4);for(var r=[],o=0,a=2*n;o<=a;o++){var u=-e.PI/(2*n)+e.Z*(o/a),c=o%2;r.push([t+Math.cos(u)*(0===c?i:i*h),s+Math.sin(u)*(0===c?i:i*h)])}return r}},839:function(t,s,i){"use strict";var e=this&&this.m||(Object.create?function(t,s,i,e){void 0===e&&(e=i),Object.defineProperty(t,e,{M:!0,get:function(){return s[i]}})}:function(t,s,i,e){void 0===e&&(e=i),t[e]=s[i]}),n=this&&this.S||function(t,s){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(s,i)||e(s,t,i)};Object.defineProperty(s,"t",{value:!0}),n(i(712),s),n(i(659),s),n(i(603),s),n(i(147),s),n(i(654),s),n(i(796),s),n(i(90),s),n(i(466),s),n(i(92),s),n(i(358),s),n(i(159),s),n(i(600),s),n(i(965),s),n(i(908),s),n(i(250),s),n(i(482),s),n(i(674),s),n(i(327),s),n(i(326),s),n(i(999),s),n(i(125),s),n(i(932),s),n(i(166),s),n(i(154),s)},603:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.bt=void 0,s.bt=window.devicePixelRatio||1},90:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.es=void 0;s.es=function(t){return JSON.parse(JSON.stringify(t))}},147:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ns=void 0;s.ns=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return t.every((function(t){return void 0===t}))}},654:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.Ct=void 0;s.Ct=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return t.some((function(t){return void 0===t}))}},796:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.jt=void 0;s.jt=function(t){return void 0===t}},466:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.hs=void 0;s.hs=function(t){for(new Date;new Date-t<ms;);}},674:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.wt=void 0;var e=i(159),n=function(){function t(t,s){this.x=t,this.y=s}return Object.defineProperty(t.prototype,"ratio",{get:function(){return this.x/this.y},M:!1,rs:!0}),Object.defineProperty(t.prototype,"os",{get:function(){return Math.pow(Math.pow(this.x,2)+Math.pow(this.y,2),.5)},M:!1,rs:!0}),t.prototype.add=function(t,s){return"number"==typeof t?(this.x+=t,"number"==typeof s&&(this.y+=s)):(this.x+=t.x,this.y+=t.y),this},t.prototype.angle=function(){return Math.atan2(-this.y,-this.x)+Math.PI},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.us=function(t){return(0,e.cs)(this.x,this.y,t.x,t.y)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.os;return 0!==t&&(this.x/=t,this.y/=t),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},t.from=function(s,i){return new t(s.x-i.x,s.y-i.y)},t}();s.wt=n},600:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.Lt=void 0;s.Lt=function(t,s,i){return Math.max(Math.min(i,t),s)}},92:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ls=s.fs=void 0;var e=i(159);s.fs=function(t,s,i,n,h,r){return(0,e.cs)(t,s,n,h)<=i+r};s.ls=function(t,s,i,e,n,h,r,o){return!(s+e<h||s>h+o||t+i<n||t>n+r)}},965:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ds=s.PI=s.Z=void 0;var e=i(674);s.Z=2*Math.PI,s.PI=Math.PI,s.ds=new e.wt(0,0)},159:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.vs=s.cs=void 0;s.cs=function(t,i,e,n){return Math.pow((0,s.vs)(t,i,e,n),.5)};s.vs=function(t,s,i,e){return Math.pow(i-t,2)+Math.pow(e-s,2)}},908:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.tt=void 0;s.tt=function(t,s,i){return s*(1-t)+i*t}},250:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.gs=void 0;s.gs=function(t,s){return(t%s+s)%s}},327:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.ps=void 0;s.ps=function(t){return function(){var s=t+=1831565813;return s=Math.imul(s^s>>>15,1|s),(((s^=s+Math.imul(s^s>>>7,61|s))^s>>>14)>>>0)/4294967296}}},482:(t,s,i)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.normalize=void 0;var e=i(600);s.normalize=function(t,s,i,n){return void 0===n&&(n=!1),((n?(0,e.Lt)(t,s,i):t)-s)/(i-s)}},358:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.random=void 0,s.random=function(t,s,i){if(void 0===t&&(t=1),void 0===s&&(s=0),void 0===i&&(i=Math.random),Array.isArray(t)){var e="function"==typeof s?s:Math.random;return t[Math.floor(e()*t.length)]}if("number"==typeof t&&"number"==typeof s&&"function"==typeof i)return s+i()*(t-s);throw new Error("Invalid args. Check function signature.")}},557:function(t){var s;t.exports=(s=function(){function t(t){return n.appendChild(t.ws),t}function i(t){for(var s=0;s<n.children.length;s++)n.children[s].style.display=s===t?"block":"none";e=t}var e=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(t){t.preventDefault(),i(++e%n.children.length)}),!1);var h=(performance||Date).now(),r=h,o=0,a=t(new s.ys("FPS","#0ff","#002")),u=t(new s.ys("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new s.ys("MB","#f08","#201"));return i(0),{Ms:16,ws:n,bs:t,Ss:i,_s:function(){h=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(u.update(t-h,200),t>r+1e3&&(a.update(1e3*o/(t-r),100),r=t,o=0,c)){var s=performance.memory;c.update(s.Os/1048576,s.xs/1048576)}return t},update:function(){h=this.end()},js:n,ks:i}},s.ys=function(t,s,i){var e=1/0,n=0,h=Math.round,r=h(window.devicePixelRatio||1),o=80*r,a=48*r,u=3*r,c=2*r,l=3*r,f=15*r,d=74*r,v=30*r,g=document.createElement("canvas");g.width=o,g.height=a,g.style.cssText="width:80px;height:48px";var p=g.getContext("2d");return p.font="bold "+9*r+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=i,p.fillRect(0,0,o,a),p.fillStyle=s,p.fillText(t,u,c),p.fillRect(l,f,d,v),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(l,f,d,v),{ws:g,update:function(a,w){e=Math.min(e,a),n=Math.max(n,a),p.fillStyle=i,p.globalAlpha=1,p.fillRect(0,0,o,f),p.fillStyle=s,p.fillText(h(a)+" "+t+" ("+h(e)+"-"+h(n)+")",u,c),p.drawImage(g,l+r,f,d-r,v,l,f,d-r,v),p.fillRect(l+d-r,f,r,v),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(l+d-r,f,r,h((1-a/w)*v))}}},s)}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var h=s[e]={exports:{}};return t[e].call(h.exports,h,h.exports,i),h.exports}i.n=t=>{var s=t&&t.t?()=>t.default:()=>t;return i.d(s,{a:s}),s},i.d=(t,s)=>{for(var e in s)i.As(s,e)&&!i.As(t,e)&&Object.defineProperty(t,e,{M:!0,get:s[e]})},i.As=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),(()=>{"use strict";var t,s=i(839),e=i(557),n=i.n(e);!function(t){t.Rs="gameplay",t.Cs="intro",t.zs="paused",t.Ns="upgrade"}(t||(t={}));const h={move:{Ps:!1,Es:!1,left:!1,right:!1},timestamp:{Ls:0,Ds:-58e3},Ws:{Us:0,level:0,next:0,Is:0},Bs:!1,Fs:[],Ks:[],items:[],qs:[],Hs:t.Cs,Ts:3,$s:[],Js:0,Ys:1550},r=[[[58,15],[55,7],[48,4],[40,7],[37,15],[40,22],[48,26],[55,22],[58,15]],[[87,34],[85,30],[81,29],[14,29],[9,30],[8,34],[9,38],[14,40],[37,40],[37,88],[38,93],[43,95],[45,94],[49,90],[50,80],[52,80],[72,68],[72,62],[58,52],[58,40],[81,40],[85,38],[87,34]],[[50,68],[50,62],[54,65],[50,68]]],o=new s.wt(0,0),a=new s.wt(32,18),u=new s.wt(a.x/2-1,a.y/2-1),c=1/a.x,l=[3178312775,2263286931,486574442,329066167],f="#fff",d="rgb(28,5,50)",v="rgba(0,0,0)",g="rgb(253,93,106)",p="rgb(254,184,18)",w="rgb(111,254,237)",y="rgb(248,96,248)",m="rgb(1,255,185)",M={Vs:document.querySelector("canvas#upgrades"),Xs:document.querySelector("canvas#ui"),map:document.querySelector("canvas#map"),Gs:document.querySelector("canvas#gameplay")},b={Vs:M.Vs.getContext("2d"),Xs:M.Xs.getContext("2d"),map:M.map.getContext("2d"),Gs:M.Gs.getContext("2d")},S={strokeStyle:"white",fillStyle:"white",fontFamily:"Arial, sans-serif",textAlign:"center",textBaseline:"middle",lineWidth:t=>t.width(.00175),fontSize:t=>t.width(.1)},_={P:!0,L:"width",stroke:!0},O={map:new s.R({canvas:M.map,Pt:[0,a.x],Et:[0,a.y]}),upgrade:new s.R({canvas:M.Vs,padding:.1}),Xs:new s.R({canvas:M.Xs})},x={map:new s.O(b.map,{..._,coords:O.map,I:{...S,lineWidth:t=>t.width(.001)}}),Gs:new s.O(b.Gs,{..._,coords:O.map,I:{...S},W:.1}),upgrade:new s.O(b.Vs,{..._,coords:O.upgrade,I:{...S,lineWidth:t=>t.width(.0175)},W:.02}),Xs:new s.O(b.Xs,{..._,coords:O.Xs,I:{...S}})},j=t=>(0,s.ps)(l[t]),k=[0,100],A=[-1,1],R={Qs:{}};class C{constructor(t){this.Zs="",this.cache={},this.ti=!1,this.si=4,this.ii=0,this.position=t,this.ei=t.clone()}get ni(){if("ni"in this.cache)return this.cache.ni;const t=this.position.clone().add(this.hi/2,this.hi/2);return this.cache.ni=t,t}get key(){if("key"in this.cache)return this.cache.key;const t=[String(this.Zs),String(this.ri),JSON.stringify(this.options)].join("~");return this.cache.key=t,t}oi(t,i){const e=this.key;e in R.Qs&&R.Qs[e].length||(R.Qs[this.key]=((t,i,e,n,h)=>{const r=[];t.ut(t.options.I);for(let o=0;o<n;o++){const n=document.createElement("canvas");n.width=e,n.height=e;const a=n.getContext("2d");i(new s.O(a,{...t.options,I:{...t.options.I,lineWidth:t.context.lineWidth},coords:new s.R({canvas:n,Pt:h,Et:h}),random:j(o)})),r.push(n)}return r})(x.Gs,this.ai,x.Gs.coords.width(c*this.hi),this.si,this.ui));const n=R.Qs[e][this.ii];x.Gs.drawImage(n,(0,s.tt)(t,this.ei.x,this.position.x),(0,s.tt)(t,this.ei.y,this.position.y),i)}update(t,s,i){this.ei.set(this.position),this.ni.x=this.position.x+this.hi/2,this.ni.y=this.position.y+this.hi/2,this.ii=Math.floor(t/h.Ys%1*this.si)}}const z=new class extends C{constructor(t){super(t),this.ri=.75,this.hi=1.5,this.Zs=0,this.speed=.005,this.ui=k,this.ci="right",this.li={I:{scale:{origin:this.ni,scale:new s.wt(-1,1)}}},this.options={I:{fillStyle:y},fill:!0},this.ai=t=>{r.forEach((s=>{t.J(s,this.options)}))},this.update=(t,s)=>{super.update(t,s),this.fi(t,s)},this.fi=(t,i)=>{const e=i*this.speed,n=.7071*e;let r=0,o=0;h.move.left&&h.move.Ps?(r=-n,o=-n):h.move.left&&h.move.Es?(r=-n,o=n):h.move.right&&h.move.Ps?(r=n,o=-n):h.move.right&&h.move.Es?(r=n,o=n):h.move.Ps?o=-e:h.move.Es?o=e:h.move.left?r=-e:h.move.right&&(r=e),this.position.x=(0,s.Lt)(this.position.x+r,0,a.x-1),this.position.y=(0,s.Lt)(this.position.y+o,0,a.y-1)}}oi(t){super.oi(t,"left"===this.ci?this.li:void 0)}}(u.clone()),N={6:{di:[10,11,12.5,15,18,21.5,26.5],range:[1.5,1.55,1.65,1.8,2,2.25,2.55],vi:[1,2,3,4,5,6,7]},7:{gi:[.07,.09,.11,.15,.2,.25,.34],pi:[1.5,1.55,1.65,1.85,2.15,2.65,3.15]},8:{di:[6,6.5,7.5,9,11,13.5,17],frequency:[1,1.5,2,3,4,6,8]},9:{di:[3,4,6,9,13,18,24],pi:[1.5,1.7,2,2.4,2.9,3.5,4.2]},10:{di:[16,18,21,25,30,36,43],frequency:[.5,.6,.7,.9,1.1,1.4,1.7]}};class P extends C{constructor(t,i=z.ni.clone()){super(i),this.size=.25,this.wi=!1,this.yi=(t,i,e)=>{for(let n=0;n<h.Fs.length;n++){const r=h.Fs[n];(0,s.fs)(this.ni.x,this.ni.y,this.ri,r.ni.x,r.ni.y,r.ri)&&(r.di(t,i,e,this.Zs),this.wi&&(this.ti=!0))}},this.parent=t}update(t,s,i){super.update(t,s),this.fi(t,s,i),this.yi(this.parent.di,i,t)}}class E{constructor(){this.mi=[],h.Ks.push(this)}Mi(){return this.level<7}oi(t){for(let s=0;s<this.mi.length;s++)this.mi[s].oi(t)}update(t,s){for(let i=0;i<this.mi.length;i++)this.mi[i].ti?this.mi.splice(i,1):this.mi[i].update(t,s,i)}}class L extends P{constructor(t,i){super(t,z.position.clone()),this.ui=A,this.hi=1,this.ri=.05,this.Zs=8,this.options=void 0,this.wi=!0,this.ai=t=>{t.J([[-1,0],[1,0]]),t.J([[-.75,-.4],[-1,0],[-.75,.4]])},this.fi=(t,s)=>{this.ei.set(this.position),this.position.x+=this.bi.x*this.parent.speed,this.position.y+=this.bi.y*this.parent.speed},this.bi=s.wt.from(i,this.ni).normalize(),this.Si=this.bi.angle()+s.PI,this._i={I:{rotation:{origin:this.ni,rotation:this.Si}}}}oi(t){super.oi(t,this._i)}}class D extends E{constructor(){super(),this.level=1,this.range=5,this.speed=.1,this.Oi=0,this.type=8,this.upgrade=()=>{this.Mi()&&this.level++}}get xi(){return N[8]}get frequency(){return 1e3/this.xi.frequency[this.level-1]}get di(){return this.xi.di[this.level-1]}update(t,s){if(super.update(t,s),t-this.Oi>this.frequency){this.Oi=t;const s=this.ji();s&&this.mi.push(new L(this,s.ni))}for(let i=0;i<this.mi.length;i++){const e=this.mi[i];e.update(t,s,i),e.ni.us(z.ni)>this.range&&(e.ti=!0)}}ji(){let t,s=1/0;for(let i=0;i<h.Fs.length;i++){const e=z.ni.us(h.Fs[i].ni);e<s&&(s=e,t=h.Fs[i])}return t}}const W={ki:[],Ai:[],Ri:[],Ci:[],zi:[],Ni:[],Pi:[],Ei:[]};let U=0;const I=(t,s)=>(W[t].push({id:U,Li:s}),U++,U-1),B=(t,...s)=>{const i=W[t];for(let t=0;t<i.length;t++)i[t].Li(...s)};new ResizeObserver((()=>{B("CanvasResize")})).observe(M.map),window.addEventListener("keydown",(t=>{B("KeyDown",t.key)})),window.addEventListener("keyup",(t=>{B("KeyUp",t.key)})),window.addEventListener("resize",(t=>{B("WindowResize")}));const F=[.4,.2,.6],K=[0,.2,.6];class q extends P{constructor(t,i,e){super(t,i),this.ui=A,this.hi=2,this.ri=.5,this.Zs=10,this.options=void 0,this.ai=t=>{const s=-1/3;t.J([[s,0],[s,0-F[0]/2],[s+K[1],0-F[1]/2],[s+K[2],0-F[2]/2],[s+K[2],0+F[2]/2],[s+K[1],0+F[1]/2],[s,0+F[0]/2],[s,0]]),t.J([[s+K[1],.8],[s+K[1],0+F[0]/2]])},this.fi=(t,i)=>{this.ei.set(this.position);const e=(0,s.normalize)(t,this.start,this.start+this.parent.duration),n=-s.PI/2-e*s.PI;this.parent.Di(this.position,n,this.Wi),this.position.add(-this.hi/2,-this.hi/2)},this.start=e,this.Wi="left"===z.ci?1:-1,this._i={I:{rotation:{origin:this.ni,rotation:this.Wi*-Math.PI/4},scale:{origin:this.ni,scale:new s.wt(-1*this.Wi,1)}}}}oi(t){super.oi(t,this._i)}}class H extends E{constructor(){super(),this.level=1,this.range=1.7,this.speed=.09,this.duration=500,this.Oi=0,this.type=10,this.upgrade=()=>{this.Mi()&&this.level++}}get xi(){return N[10]}get frequency(){return 1e3/this.xi.frequency[this.level-1]}Di(t,s,i){t.x=z.ni.x+i*Math.cos(i*s)*this.range,t.y=z.ni.y+i*Math.sin(i*s)*this.range}get di(){return this.xi.di[this.level-1]}update(t,i){if(super.update(t,i),t-this.Oi>this.frequency){this.Oi=t;const i=z.position.clone();this.Di(i,-s.PI/2,1),i.add(-.5,-.5),this.mi.push(new q(this,i,t))}for(let s=0;s<this.mi.length;s++){const e=this.mi[s];e.update(t,i,s),t-e.start>this.duration&&(e.ti=!0)}}}class T extends P{constructor(t,i){super(t),this.ui=A,this.Zs=9,this.options=void 0,this.ai=t=>{t.it(0,0,.5,{I:{fillStyle:y,alpha:.1},fill:!0}),t.it(0,0,.5,{I:{strokeStyle:y}}),t.it(0,0,.4,{I:{strokeStyle:y}});for(let i=0;i<5;i++){const e=.3*Math.cos(s.Z*i/5),n=.3*Math.sin(s.Z*i/5);t.it(e,n,.2,{I:{strokeStyle:y}})}},this.fi=(t,s)=>{this.ei.set(this.position)},this.start=i,this.Ui={I:{scale:new s.wt(this.parent.pi,this.parent.pi)}},this.ei.add(-this.ri,-this.ri),this.position.add(-this.ri,-this.ri)}get ri(){return this.parent.pi}get hi(){return 2*this.ri}}class $ extends E{constructor(){super(),this.level=1,this.range=5,this.speed=.1,this.Oi=0,this.frequency=1500,this.duration=1500,this.type=9,this.upgrade=()=>{this.Mi()&&this.level++}}get xi(){return N[9]}get pi(){return this.xi.pi[this.level-1]}get di(){return this.xi.di[this.level-1]}update(t,s){super.update(t,s),t-this.Oi>this.frequency&&(this.Oi=t,this.mi.push(new T(this,t)));for(let i=0;i<this.mi.length;i++){const e=this.mi[i];e.update(t,s,i),t-e.start>this.duration&&(e.ti=!0)}}}class J extends P{constructor(t){super(t),this.ui=A,this.hi=1,this.Zs=6,this.ri=.25,this.offset=0,this.options=void 0,this.ai=t=>{t.it(0,0,this.ri,{I:{fillStyle:y},fill:!0})},this.fi=(t,i)=>{this.ei.set(this.position);const e=this.offset+s.Z*(t/this.parent.l),n=z.ni.x+Math.cos(e)*this.parent.range-this.hi/2,h=z.ni.y+Math.sin(e)*this.parent.range-this.hi/2;this.position.x=(0,s.tt)(1-this.parent.Ii,this.ei.x,n),this.position.y=(0,s.tt)(1-this.parent.Ii,this.ei.y,h)}}}class Y extends E{constructor(){super(),this.level=1,this.Ii=.33,this.l=2e3,this.type=6,this.upgrade=()=>{if(this.Mi())for(this.level++;this.mi.length<this.vi;)this.mi.push(new J(this)),this.mi.forEach(((t,i)=>t.offset=s.Z*i/this.mi.length))},this.mi.push(new J(this))}get xi(){return N[6]}get vi(){return this.xi.vi[this.level-1]}get range(){return this.xi.range[this.level-1]}get di(){return this.xi.di[this.level-1]}}const V=[8,10,6,9],X=()=>{const t=(0,s.random)(V),i=h.Ks.find((s=>s.type===t)),e=(i?.level??0)+1;let n,r,o;switch(t){case 8:1===e?n=D:i&&(r=i.upgrade),o=`Arrow - L${e}`;break;case 10:1===e?n=H:i&&(r=i.upgrade),o=`Axe - L${e}`;break;case 6:1===e?n=Y:i&&(r=i.upgrade),o=`Orb - L${e}`;break;case 9:1===e?n=$:i&&(r=i.upgrade),o=`Summoning Circle - L${e}`;break;default:throw new Error}return{Bi:n,upgrade:r,text:o}},G=()=>{h.Ws.Is=h.Ws.Us,h.Ws.level++,h.Ws.next=50*h.Ws.level,h.$s.length=0;for(let t=0;t<h.Ts;t++)h.$s.push(X());B("StateChange",t.Ns)},Q=()=>{x.upgrade.options.random=j(0),x.upgrade.clear();for(let t=0;t<h.Ts;t++){const i=h.$s[t],e=new s.R({offsetX:x.upgrade.coords.St(-1)+x.upgrade.coords.width(t/h.Ts),offsetY:x.upgrade.coords._t(-1),zt:x.upgrade.coords.width()/h.Ts,Nt:x.upgrade.coords.height(),padding:.05}),n=new s.O(x.upgrade.context,{...x.upgrade.options,coords:e,stroke:!1});n.rect(-1,-1,1,1,{stroke:!0,fill:!0,I:{fillStyle:d,strokeStyle:h.Js===t?m:f}}),n.text(i.text,0,-.8,{I:{textBaseline:"top",fillStyle:h.Js===t?m:f}})}},Z=()=>{const t=(h.Ws.Us-h.Ws.Is)/(h.Ws.next-h.Ws.Is);console.log("drawing",t),x.Xs.rect(-1,-1,1,1,{fill:!1,W:0,stroke:!0}),x.Xs.rect(-1,-1,t,1,{fill:!0,W:0,I:{fillStyle:m}})},tt=[[[22,38],[35,87],[37,89],[44,92],[55,92],[60,89],[64,84],[76,38],[74,35],[59,22],[49,20],[38,22],[29,29],[22,38]],[[31,52],[45,55],[40,61],[35,59],[31,52]],[[58,61],[56,60],[54,55],[67,52],[62,59],[58,61]],[[58,25],[59,17],[63,12],[68,8],[76,7],[83,8],[88,12],[92,17],[94,25],[93,29],[89,38]],[[74,35],[89,52],[86,54],[83,55],[79,55],[75,51],[72,40],[74,35]],[[40,25],[38,17],[34,12],[29,8],[22,7],[15,8],[10,12],[6,17],[5,29],[9,38]],[[25,35],[9,52],[11,54],[14,55],[19,55],[22,51],[25,40],[25,35]]];class st extends C{constructor(t,s){super(t),this.Fi=t=>{this.ti=!0},this.Ki=s}update(t,s,i){super.update(t,s),this.fi(t,s,i)}fi(t,i,e){this.Ki.qi&&((t,i,e,n)=>{const h=s.wt.from(z.position,t);if(!e.start&&h.os<e.cs)e.start=i;else if(e.start&&h.os<.5)e.Hi(n);else if(e.start){const s=i-e.start;h.normalize();const n=h.clone().multiply(.0015*s-.25);t.x+=n.x,t.y+=n.y}})(this.position,t,this.Ki.qi,e)}}class it extends st{constructor(t,s){let i;super(t,{qi:{cs:3,Ti:t.clone(),Hi:t=>{h.Ws.Us+=s,Z(),this.Fi(t)}}}),this.ui=A,this.hi=1,this.ri=.25,this.Zs=11,this.ai=t=>{t.rt(0,0,this.ri,5,.4,this.options)},this.Ws=s,i=this.Ws<20?0:this.Ws<50?1:2,this.options={I:it.I[i],fill:!0}}}it.I={0:{fillStyle:p,strokeStyle:p},1:{fillStyle:w,strokeStyle:w},2:{fillStyle:y,strokeStyle:y}};const et=(0,i(257).i)({h:.5,u:1,o:.2,l:2});class nt extends C{constructor(t,i,e){super(nt.$i(t.ni.clone(),t)),this.ri=.5,this.hi=1,this.duration=500,this.Ui={I:{scale:{origin:o,scale:new s.wt(1,1)}}},this.options=void 0,this.ui=A,this.oi=t=>{super.oi(t,this.Ui)},this.ai=t=>{t.text(this.text,0,0,{fill:!0,I:{fontSize:t=>t.width(.35),textBaseline:"top"},W:.3})},this.target=t,this.Zs=i,this.text=i,this.start=e}static $i(t,s){return t.x=s.ni.x-.5,t.y=s.ni.y-1.5,t}update(t,s){super.update(t,0,s);const i=et((t-this.start)/this.duration);this.Ui.I.scale.origin=this.ni,this.Ui.I.scale.scale.x=i,this.Ui.I.scale.scale.y=i,nt.$i(this.position,this.target),t-this.start>=this.duration&&(this.ti=!0)}}class ht extends C{constructor(t,s,i){super(t),this.speed=.00175,this.Ji=1e3,this.Yi={},this.options={I:{fillStyle:v},fill:!0},this.Ki=s,this.Vi=i,this.Xi=i}Gi(t){x.Gs.text(String(t),this.ni.x,this.ni.y-this.hi/2)}di(t,s,i,e){const n=this.Yi[e];n&&i-n<this.Ji||(this.Vi-=t,h.qs.push(new nt(this,String(t),i)),this.Vi<=0&&this.Fi(),this.Yi[e]=i)}Fi(){const t=new it(this.ni.clone(),this.Xi);t.position.add(-t.hi/2,-t.hi/2),h.items.push(t),this.ti=!0}update(t,s){super.update(t,s),this.fi(t,s)}fi(t,i){this.Ki.Qi&&((t,i,e)=>{const n=s.wt.from(z.position,t).normalize().multiply(i*e.Zi);t.x+=n.x,t.y+=n.y})(this.position,i,this.Ki.Qi),this.Ki.te&&((t,i,e)=>{const n=s.wt.from(z.position,t);if(n.os<e.cs){const s=n.normalize().multiply(i*e.Qi);t.x+=s.x,t.y+=s.y}else{if(t.equals(e.se))return;if(t.us(e.se)<.1)t.set(e.se);else{const n=s.wt.from(e.se,t).normalize().multiply(i*e.Qi);t.x+=n.x,t.y+=n.y}}})(this.position,i,this.Ki.te)}}class rt extends ht{constructor(t,s){super(t,{te:{Qi:.002,cs:3,se:t.clone()}},s),this.ui=k,this.hi=1,this.Zs=1,this.ri=.5,this.ai=t=>{tt.forEach((s=>t.J(s,this.options)))}}}const ot=[[[87,35],[83,21],[80,15],[70,6],[57,1],[43,1],[30,6],[20,15],[15,28],[14,35],[9,39],[7,47],[9,54],[14,59],[18,72],[26,84],[37,92],[44,95],[57,95],[63,92],[74,84],[82,72],[87,59],[94,50],[95,47],[92,39],[87,35]],[[87,45],[76,44],[76,35],[80,34],[80,41],[83,41],[87,45]],[[78,63],[76,68],[76,65],[78,63]],[[63,74],[63,63],[71,63],[73,65],[73,74],[63,74]],[[45,74],[43,73],[43,65],[45,63],[57,63],[57,74],[45,74]],[[29,74],[30,63],[38,63],[40,65],[40,73],[29,74]],[[24,63],[25,68],[24,63]],[[22,30],[25,24],[25,29],[22,30]],[[57,19],[57,30],[43,29],[43,21],[45,19],[57,19]],[[78,30],[76,29],[76,24],[78,30]],[[73,58],[71,60],[63,60],[62,56],[58,54],[57,60],[45,60],[43,58],[43,54],[40,56],[38,60],[30,60],[29,35],[38,34],[40,35],[40,38],[43,40],[43,35],[45,34],[57,34],[58,40],[62,38],[63,34],[73,35],[73,58]],[[29,29],[29,19],[38,19],[40,21],[40,29],[29,29]],[[73,19],[73,29],[63,30],[63,19],[73,19]],[[63,16],[62,11],[70,16],[63,16]],[[40,14],[38,16],[31,16],[40,11],[40,14]],[[58,9],[57,16],[45,16],[43,14],[43,9],[58,9]],[[18,41],[21,41],[21,35],[24,34],[25,44],[14,45],[18,41]],[[18,52],[14,49],[25,50],[24,60],[22,60],[21,53],[18,52]],[[31,78],[40,79],[40,86],[31,78]],[[43,88],[43,79],[58,79],[58,88],[43,88]],[[62,86],[63,78],[71,78],[62,86]],[[83,52],[80,53],[78,60],[76,58],[76,50],[87,49],[83,52]],[[38,41],[33,42],[32,47],[33,50],[38,52],[41,50],[43,47],[41,42],[38,41]],[[63,41],[59,42],[58,47],[59,50],[63,52],[67,50],[69,47],[67,42],[63,41]]];const at=[[[37,36],[46,37],[53,42],[57,48],[60,58],[59,66],[56,69],[49,74],[46,84],[37,87],[31,86],[28,84],[26,74],[17,69],[14,62],[17,48],[21,42],[28,37],[37,36]],[[63,95],[68,71],[69,59],[67,45],[64,35],[58,28],[47,21],[37,19],[27,21],[15,28],[10,35],[7,45],[6,59],[6,71],[12,95]],[[14,61],[15,79],[21,95]],[[61,61],[59,79],[54,95]],[[77,21],[45,10],[29,9],[20,9],[12,13],[17,8],[25,4],[44,2],[71,6],[92,13],[77,21]],[[94,9],[82,95]],[[42,51],[39,53],[40,59],[43,63],[46,63],[51,60],[53,55],[53,51],[47,48],[42,51]],[[37,63],[34,66],[33,71],[41,71],[40,66],[37,63]],[[33,51],[30,49],[24,49],[22,51],[20,55],[24,60],[30,63],[34,59],[35,56],[33,51]]];const ut=[[[95,56],[75,43],[51,35],[43,53],[40,65],[40,82],[44,91],[49,95],[54,96],[65,94],[72,90],[86,74],[96,59],[95,56]],[[53,85],[49,80],[47,68],[56,79],[71,80],[59,85],[53,85]],[[73,71],[67,65],[76,65],[81,72],[73,71]],[[54,62],[49,55],[57,56],[63,62],[54,62]],[[39,47],[33,49],[27,56],[31,45],[36,42],[42,42],[44,36],[48,29],[52,29],[57,31],[55,20],[49,2],[24,7],[2,19],[11,42],[23,57],[35,63],[39,47]],[[43,22],[51,25],[43,29],[35,25],[43,22]],[[25,36],[16,38],[20,31],[29,29],[25,36]]];const ct=[[[58,46],[68,43],[75,40],[74,43],[70,50],[63,50],[60,49],[58,46]],[[49,3],[35,6],[24,14],[16,26],[14,40],[16,62],[23,78],[34,88],[49,94],[62,89],[73,79],[81,63],[84,40],[81,26],[73,14],[62,6],[49,3]],[[46,48],[45,59],[37,54],[34,57],[31,63],[32,73],[43,84],[35,81],[26,74],[21,63],[19,50],[19,34],[22,24],[29,14],[41,7],[32,17],[31,32],[33,37],[39,41],[42,38],[43,31],[46,43],[43,45],[46,48]],[[56,85],[64,76],[68,68],[66,59],[61,54],[58,55],[54,59],[53,48],[56,46],[53,44],[54,33],[56,31],[58,40],[62,40],[65,37],[68,28],[66,18],[58,7],[69,14],[76,24],[79,34],[79,50],[77,63],[75,70],[69,77],[62,82],[56,85]],[[41,46],[30,43],[23,40],[23,43],[27,50],[35,50],[38,49],[41,46]]];class lt extends C{constructor(t,i){super(t),this.ti=!1,this.Zs=12,this.ri=1.5,this.hi=3,this.duration=2500,this.ie=h.Ys/2,this.options=void 0,this.ui=A,this.ai=t=>{t.rect(-.2,-.8,.2,.8,{I:{rotation:{origin:o,rotation:s.PI/4},fillStyle:g},fill:!0,stroke:!1}),t.rect(-.2,-.8,.2,.8,{I:{rotation:{origin:o,rotation:-s.PI/4},fillStyle:g},fill:!0,stroke:!1})},this.start=i}update(t,s){super.update(t,0,s),t-this.start>lt.duration&&(this.ti=!0)}}lt.duration=2500;const ft=[0,1,2,3],dt=[class extends ht{constructor(t,s){super(t,{Qi:{Zi:.002}},s),this.ui=k,this.hi=1,this.Zs=3,this.ri=.5,this.ai=t=>{ct.forEach((s=>t.J(s,this.options)))}}},class extends ht{constructor(t,s){super(t,{Qi:{Zi:.002}},s),this.ui=k,this.hi=2,this.Zs=2,this.ri=1,this.ai=t=>{ut.forEach((s=>t.J(s,this.options)))}}},class extends ht{constructor(t,s){super(t,{Qi:{Zi:.002}},s),this.ui=k,this.hi=1,this.Zs=4,this.ri=.5,this.speed=.002,this.ai=t=>{ot.forEach((s=>t.J(s,this.options)))}}},class extends ht{constructor(t,s){super(t,{Qi:{Zi:.002}},s),this.ui=k,this.hi=1,this.Zs=5,this.ri=.5,this.ai=t=>{at.forEach((s=>t.J(s,this.options)))}}}],vt=t=>{const i=(t-h.timestamp.Ds-6e4)/lt.duration;if(i<1&&!h.Bs){const i=(0,s.random)(.8*a.x,.1),e=(0,s.random)(.8*a.y,.1),n=new lt(new s.wt(i,e),t);h.Bs=n,h.qs.push(n)}else if(i>1&&h.Bs){const i=Math.floor((0,s.random)(16,12));for(let t=0;t<i;t++){const e=h.Bs.ni.x+1.5*Math.cos(s.Z*t/i),n=h.Bs.ni.y+1.5*Math.sin(s.Z*t/i);h.Fs.push(new rt(new s.wt(e,n),5))}h.timestamp.Ds=t,h.Bs=!1}};let gt;const pt=new(n()),wt=pt.bs(new(n().ys)("phys","#0ff","#002"));pt.ws.id="stats",document.body.appendChild(pt.ws);const yt=1e3/60;let mt=0,Mt=0,bt=0;const St=(s=0)=>{pt._s();const i=h.Hs!==t.Rs?0:s-Mt;for(Mt=s,bt+=Math.min(i,50);bt>=yt;)_t(),bt-=yt,mt+=yt;Ot(bt/yt),pt.end(),window.requestAnimationFrame(St)},_t=()=>{wt.update(59.99999999999999,200),z.update(mt,yt);for(let t=h.Ks.length-1;t>=0;t--)h.Ks[t].update(mt,yt);for(let t=h.Fs.length-1;t>=0;t--)h.Fs[t].ti?h.Fs.splice(t,1):h.Fs[t].update(mt,yt);for(let t=h.items.length-1;t>=0;t--)h.items[t].ti?h.items.splice(t,1):h.items[t].update(mt,yt,t);for(let t=h.qs.length-1;t>=0;t--)h.qs[t].ti?h.qs.splice(t,1):h.qs[t].update(mt,t);(t=>{const i=1e3*(9e5-Math.max(0,t)/1e3)/1e6;if(t-h.timestamp.Ls>=i){h.timestamp.Ls=t;const i=(0,s.random)(dt),e=(0,s.random)(ft);let n,r;0===e&&(n=(0,s.random)(a.x),r=0),1===e&&(n=(0,s.random)(a.x),r=a.y),2===e&&(n=0,r=(0,s.random)(a.y)),3===e&&(n=0,r=(0,s.random)(a.y)),h.Fs.push(new i(new s.wt(n,r),5))}t-h.timestamp.Ds>=6e4&&vt(t)})(mt)},Ot=t=>{x.Gs.clear();for(let s=0;s<h.Fs.length;s++)h.Fs[s].oi(t);for(let s=0;s<h.Ks.length;s++)h.Ks[s].oi(t);for(let s=0;s<h.items.length;s++)h.items[s].oi(t);for(let s=0;s<h.qs.length;s++)h.qs[s].oi(t);z.oi(t)};(0,s.Qt)(M.map,a),(0,s.Qt)(M.Gs,a),(0,s.Qt)(M.Vs,a),I("KeyDown",(i=>{if("Enter"===i&&(h.Ks.forEach((t=>t.upgrade())),h.Hs===t.Ns)){const i=h.$s[h.Js];(0,s.jt)(i.Bi)?i.upgrade():new i.Bi,h.Js=0,x.upgrade.clear(),B("StateChange",t.Rs)}"Shift"===i&&(console.log(i),h.Ws.Us=h.Ws.next,B("LevelUp")),"Escape"===i&&h.Hs===t.Rs&&B("StateChange",t.zs),"ArrowLeft"!==i&&"a"!==i||(h.Hs===t.Rs&&(h.move.left=!0,z.ci="left"),h.Hs===t.Ns&&(h.Js=(0,s.gs)(h.Js-1,h.Ts),Q())),"ArrowRight"!==i&&"d"!==i||(h.Hs===t.Rs&&(h.move.right=!0,z.ci="right"),h.Hs===t.Ns&&(h.Js=(0,s.gs)(h.Js+1,h.Ts),Q())),"ArrowUp"!==i&&"w"!==i||(h.move.Ps=!0),"ArrowDown"!==i&&"s"!==i||(h.move.Es=!0)})),I("KeyUp",(s=>{"ArrowLeft"!==s&&"a"!==s||(h.move.left=!1),"ArrowRight"!==s&&"d"!==s||(h.move.right=!1),"ArrowUp"!==s&&"w"!==s||(h.move.Ps=!1),"ArrowDown"!==s&&"s"!==s||(h.move.Es=!1),"Enter"===s&&h.Hs===t.zs&&B("StateChange",t.Rs)})),I("CanvasResize",(()=>{for(const t in R.Qs)R.Qs[t].length=0;(()=>{for(let t=0;t<a.x;t++)for(let s=0;s<a.y;s++)x.map.rect(t,s,1/a.x,1/a.y,{I:{strokeStyle:"rgba(255,255,255,0.1)"}})})();const i=M.map.getBoundingClientRect();M.Xs.style.height=String(.05*i.height),M.Xs.style.left=String(i.left),M.Xs.style.top=String(i.top-M.Xs.clientHeight),M.Xs.style.width=String(i.width),M.Xs.width=M.Xs.clientWidth*s.bt,M.Xs.height=M.Xs.clientHeight*s.bt,Z(),h.Hs===t.Ns&&Q()})),I("WindowResize",(()=>{const t=M.map.getBoundingClientRect();M.Xs.style.height=String(.05*t.height),M.Xs.style.left=String(t.left),M.Xs.style.top=String(t.top-M.Xs.clientHeight),M.Xs.style.width=String(t.width)})),I("StateChange",(s=>{if(s===t.Ns)h.Js=0,Q(),gt=I("CanvasResize",Q);s!==t.Ns&&(t=>{let s;for(s in W)for(let i=W[s].length-1;i>=0;i--)W[s][i].id===t&&W[s].splice(i,1)})(gt),h.Hs=s})),I("LevelUp",G),I("Initialize",(()=>{document.body.style.backgroundColor=d,M.map.style.zIndex="-1",G(),new D})),B("Initialize"),B("StateChange",t.Rs),window.requestAnimationFrame(St)})()})();</script></body></html>