<html><head><link href="main.css" rel="stylesheet"></head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>Bardo</title><body class="full"><div id="root"><canvas id="ui"></canvas><canvas id="upgrades"></canvas><canvas id="map"></canvas><canvas id="gameplay"></canvas></div><script>(()=>{var t={705:(t,s)=>{"use strict";Object.defineProperty(s,"t",{value:!0}),s.i=void 0;s.i=function(t){var s=void 0===t?{}:t,i=s.h,e=void 0===i?0:i,h=s.o,n=void 0===h?-1:h,r=s.l,o=void 0===r?1:r,a=s.u,l=void 0===a?1:a,c=s.g,u=void 0===c?0:c,d=s.p,f=void 0===d?0:d,g=s.m,p=void 0!==g&&g;if(e<n||e>o)throw new Error("yStart must be between yMin and yMax");var w=2*Math.PI,y=(n+o)/2,m=(o-n)/2,v=p?-1:1,S=Math.asin(2*(e-n)/(o-n)-1)*(l/w);return function(t){return y+m*Math.sin(v*(w*(t-u+S))/l)+f}}},257:function(t,s,i){"use strict";var e=this&&this.v||(Object.create?function(t,s,i,e){void 0===e&&(e=i),Object.defineProperty(t,e,{S:!0,get:function(){return s[i]}})}:function(t,s,i,e){void 0===e&&(e=i),t[e]=s[i]}),h=this&&this.M||function(t,s){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(s,i)||e(s,t,i)};Object.defineProperty(s,"t",{value:!0}),h(i(705),s)},466:function(t){var s;t.exports=(s=function(){function t(t){return h.appendChild(t.R),t}function i(t){for(var s=0;s<h.children.length;s++)h.children[s].style.display=s===t?"block":"none";e=t}var e=0,h=document.createElement("div");h.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",h.addEventListener("click",(function(t){t.preventDefault(),i(++e%h.children.length)}),!1);var n=(performance||Date).now(),r=n,o=0,a=t(new s.k("FPS","#0ff","#002")),l=t(new s.k("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new s.k("MB","#f08","#201"));return i(0),{C:16,R:h,A:t,P:i,D:function(){n=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(l.update(t-n,200),t>r+1e3&&(a.update(1e3*o/(t-r),100),r=t,o=0,c)){var s=performance.memory;c.update(s.O/1048576,s.W/1048576)}return t},update:function(){n=this.end()},N:h,B:i}},s.k=function(t,s,i){var e=1/0,h=0,n=Math.round,r=n(window.devicePixelRatio||1),o=80*r,a=48*r,l=3*r,c=2*r,u=3*r,d=15*r,f=74*r,g=30*r,p=document.createElement("canvas");p.width=o,p.height=a,p.style.cssText="width:80px;height:48px";var w=p.getContext("2d");return w.font="bold "+9*r+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=i,w.fillRect(0,0,o,a),w.fillStyle=s,w.fillText(t,l,c),w.fillRect(u,d,f,g),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(u,d,f,g),{R:p,update:function(a,y){e=Math.min(e,a),h=Math.max(h,a),w.fillStyle=i,w.globalAlpha=1,w.fillRect(0,0,o,d),w.fillStyle=s,w.fillText(n(a)+" "+t+" ("+n(e)+"-"+n(h)+")",l,c),w.drawImage(p,u+r,d,f-r,g,u,d,f-r,g),w.fillRect(u+f-r,d,r,g),w.fillStyle=i,w.globalAlpha=.9,w.fillRect(u+f-r,d,r,n((1-a/y)*g))}}},s)}},s={};function i(e){var h=s[e];if(void 0!==h)return h.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.n=t=>{var s=t&&t.t?()=>t.default:()=>t;return i.d(s,{a:s}),s},i.d=(t,s)=>{for(var e in s)i.L(s,e)&&!i.L(t,e)&&Object.defineProperty(t,e,{S:!0,get:s[e]})},i.L=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),(()=>{"use strict";var t=i(466),s=i.n(t);const e=(t,s,i,e)=>h(t,s,i,e)**.5,h=(t,s,i,e)=>(i-t)**2+(e-s)**2,n=(...t)=>t.reduce(((t,s)=>t+s**2),0)**.5;class r{constructor(t,s){this.x=t,this.y=s}get ratio(){return this.x/this.y}get $(){return n(this.x,this.y)}add(t,s){return"number"==typeof t?(this.x+=t,"number"==typeof s&&(this.y+=s)):(this.x+=t.x,this.y+=t.y),this}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}clone(){return new r(this.x,this.y)}U(t){return e(this.x,this.y,t.x,t.y)}equals(t){return this.x===t.x&&this.y===t.y}multiply(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.$;return 0!==t&&(this.x/=t,this.y/=t),this}set(t){return this.x=t.x,this.y=t.y,this}static from(t,s){return new r(t.x-s.x,t.y-s.y)}}const o=2*Math.PI,a=Math.PI,l=(new r(0,0),window.devicePixelRatio||1),c=t=>void 0===t,u=(t,s,i)=>Math.max(Math.min(i,t),s),d=(t,s,i)=>s*(1-t)+i*t;function f(t=1,s=0,i=Math.random){if(Array.isArray(t)){const i="function"==typeof s?s:Math.random;return t[Math.floor(i()*t.length)]}if("number"==typeof t&&"number"==typeof s&&"function"==typeof i)return s+i()*(t-s);throw new Error("Invalid args. Check function signature.")}const g=(t,s,i,e=!1)=>((e?u(t,s,i):t)-s)/(i-s);var p,w;!function(t){t.j="up",t.T="down"}(p||(p={}));class y{constructor(t={}){if(c(t.canvas)&&((...t)=>t.some((t=>void 0===t)))(t.F,t.H))throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");Object.assign(this,{I:[-1,1],Y:[-1,1],K:!1,orientationY:"down",X:!1,...t})}q(){return this.F??this.canvas.width}_(){return this.q()-2*this.J()}V(){return this.H??this.canvas.height}G(){return this.V()-2*this.Z()}tt(){return this.st??this.padding??0}J(){return this.tt()*this.q()}it(){return c(this.et)?c(this.padding)?0:this.X?this.padding*(this.q()/this.V()):this.padding:this.et}Z(){return this.it()*this.V()}ht(){return this.offsetX??0}nt(){return this.offsetY??0}rt(t){const s=g(t,this.I[0],this.I[1],this.K);return this.J()+this.ht()+s*this._()}ot(t){const s=g(t,this.Y[0],this.Y[1],this.K),i=this.lt===p.j;return this.Z()+this.nt()+(i?1-s:s)*this.G()}ct(t){const s=g(t,this.J(),this.J()+this.width(),this.K);return d(s,this.I[0],this.I[1])}ut(t){const s=g(t,this.Z(),this.Z()+this.height(),this.K);return d(s,this.I[0],this.I[1])}width(t){return this._()*(t??1)}height(t){return this.G()*(t??1)}dt(t){return this.ct(t??this.width())-this.ct(0)}ft(t){return this.ut(t??this.height())-this.ut(0)}}!function(t){t.gt="width",t.wt="height"}(w||(w={}));class m{constructor(t,s={}){this.context=t,this.coords=s.coords??new y({canvas:t.canvas});const i={beginPath:!0,closePath:!1,fill:!1,yt:-1,vt:!0,stroke:!1,St:!1,xt:!1,Mt:!1,bt:0,Rt:!1,random:Math.random};this.options={...i,...s},this.options.kt={fontFamily:"sans-serif",fontSize:16,textAlign:"center",textBaseline:"middle",...s.kt}}rect(t=0,s=0,i=1,e=1,h={}){this.Ct("roughness",h)?this.At(t,s,i,e,h):this.zt(t,s,i,e,h)}At(t,s,i,e,h){const n=this.Pt(t),r=this.Dt(s),o=this.Ot(i),a=this.Wt(e),l=[[n,r],[n+o,r],[n+o,r+a],[n,r+a],[n,r]];this.Nt(l,{...h,St:!1,vt:!0,Rt:!0})}zt(t,s,i,e,h){this.Bt(h),this.context.rect(this.Pt(t,h),this.Dt(s,h),this.Ot(i),this.Wt(e)),this.Et(h)}Nt(t,s={}){this.Ct("roughness",s)?this.Lt(t,s):this.$t(t,s)}$t(t,s){this.Bt(s);for(let i=0;i<t.length;i++){const e=this.Pt(t[i][0],s),h=this.Dt(t[i][1],s);0===i?this.context.moveTo(e,h):this.context.lineTo(e,h)}this.Et(s)}Lt(t,s){const i=this.Ct("roughness",s),e=this.Ct("random",s),h=t.length-1;for(let r=0;r<2;r++){const a=[];for(let r=0;r<h;r++){const[l,c]=t[r],[f,g]=t[r+1],p=n(this.coords.rt(l)-this.coords.rt(f),this.coords.ot(c)-this.coords.ot(g)),w=n(l-f,c-g),y=u(w*i-p*w*4e-5,i*w*.1,i*w*.25);for(let t=0;t<4;t++){const i=e()*y,n=e()*o,u=i*Math.cos(n),p=i*Math.sin(n);let w=NaN,m=NaN;if(0===t&&(w=l+u,m=c+p),1===t){const t=.5;w=d(t,l,f)+u,m=d(t,c,g)+p}if(2===t){const t=.75;w=d(t,l,f)+u,m=d(t,c,g)+p}3===t&&(s.Rt&&r===h-1?(w=a[0][0],m=a[0][1]):(w=f+u,m=g+p)),a.push([w,m])}}const l=0===r?s:{...s,fill:!1};this.Ut(a,l)}}Ut(t,s={}){this.Bt(s);for(let i=0;i<t.length-1;i++){const e=this.Pt(t[i][0],s),h=this.Dt(t[i][1],s);if(0===i)this.context.moveTo(e,h);else{const n=this.Pt(t[i+1][0],s),r=this.Dt(t[i+1][1],s);if(n===e&&r===h)this.context.lineTo(n,r);else{const t=(e+n)/2,s=(h+r)/2;this.context.quadraticCurveTo(e,h,t,s)}}}t.slice(-1).forEach((t=>{this.context.lineTo(this.Pt(t[0],s),this.Dt(t[1],s))})),this.Et(s)}jt(t,s,i,e={}){this.Ct("roughness",e)?this.Tt(t,s,i,e):this.Ft(t,s,i,e)}Ft(t,s,i,e){this.Bt(e),this.context.arc(this.Pt(t,e),this.Dt(s,e),this.Ht(i,e),0,o),this.Et(e)}Tt(t,s,i,e){const h=this.Ct("roughness",e),n=this.Ct("random",e),r=this.Ht(i,e),a=u(50*i*h-r*i*.05,h*r*.05,h*r*.2);for(let i=0;i<2;i++){const i=[];for(let h=0;h<16;h++){const l=n()*a,c=n()*o,u=l*Math.cos(c),d=l*Math.sin(c),f=o*h/16,g=u+this.Pt(t,e)+Math.cos(f)*r,p=d+this.Dt(s,e)+Math.sin(f)*r;i.push([g,p])}i[16]=i[0],i[17]=i[1],this.Ut(i,{...e,St:!1,vt:!0,Rt:!0})}}drawImage(t,s,i,e={}){this.Bt(e),this.context.drawImage(t,this.Pt(s,e),this.Dt(i,e)),this.Et(e)}It(t,s,i,e,h,n={}){this.Nt(((t,s,i,e=5,h=.4)=>{const n=[];for(let r=0,l=2*e;r<=l;r++){const c=-a/(2*e)+o*(r/l),u=r%2;n.push([t+Math.cos(c)*(0===u?i:i*h),s+Math.sin(c)*(0===u?i:i*h)])}return n})(this.Pt(t,n),this.Dt(s,n),this.Ht(i,n),e,h),{...n,St:!1,vt:!0})}Yt(t,s,i,e,h={}){const n=this.Ct("roughness",h);this.Nt(((t,s,i,e=5)=>{const h=[];for(let n=0,r=e;n<=r;n++){const l=-a/(2*e)+o*(n/r);h.push([t+Math.cos(l)*i,s+Math.sin(l)*i])}return h})(this.Pt(t,h),this.Dt(s,h),this.Ht(i,h),e),{...h,St:!1,vt:!0,Rt:Boolean(n)})}Kt(t){this.Xt({...this.options.kt,...t})}text(t,s,i,e={}){this.Ct("roughness",e)?this.qt(t,s,i,e):this._t(t,s,i,e)}_t(t,s,i,e={}){this.Bt(e);const h=this.Ct("maxTextWidth",e);this.context.fillText(t,this.Pt(s,e),this.Dt(i,e),h>0?h:void 0),this.Et(e)}qt(t,s,i,e={}){const h=this.Ct("roughness",e),n=this.Ct("random",e),{actualBoundingBoxAscent:o,actualBoundingBoxDescent:a,width:l}=this.Jt(t,e.kt),c=this.coords.dt(l),u=o-a,d=this.coords.ft(u),g=t.split(""),p=this.Vt("textAlign"),w=this.Vt("textBaseline");let y=0;g.forEach(((t,o)=>{let a,l;const u=this.Jt(t,{...e.kt}),g=this.coords.dt(u.width);if("left"===p)a=s+y,l=a+g/2;else if("right"===p)a=-c+s+y,l=a-g/2;else{if("center"!==p)throw new Error("textAlign must be 'left', 'right', or 'center' to use rough text");a=-c/2+s+y,l=a}y+=1.1*g;const m=i;let v;if("top"===w)v=m-d/2;else if("bottom"===w)v=m-d/2;else{if("middle"!==w)throw new Error("textBaseline must be 'top', 'bottom', or 'middle' to use rough text");v=m}const S=[f(Math.min(.4,h/20),0,n),f(Math.min(.4,h/20),0,n)],x=[f(Math.min(.4,h/20),0,n),f(Math.min(.4,h/20),0,n)];this._t(t,a+S[0],m+x[0],{...e,kt:{...e.kt,rotation:{origin:new r(l,v),rotation:h*Math.PI/16}},vt:!0}),this._t(t,a+S[1],m+x[1],{...e,kt:{...e.kt,rotation:{origin:new r(l,v),rotation:-h*Math.PI/16}},vt:!0})}))}clear(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)}Gt(t,s={}){t.width=t.clientWidth*(s.Qt?l:1),t.height=t.clientHeight*(s.Qt?l:1)}Pt(t,s={}){return this.Ct("useNormalCoordinates",s)?this.coords.rt(t):t}Dt(t,s={}){return this.Ct("useNormalCoordinates",s)?this.coords.ot(t):t}Ot(t){return this.coords.width(t)}Wt(t){return this.coords.height(t)}Ht(t,s={}){const i=this.Ct("scalarNormalization",s);return"width"===i?this.coords.width(t):"height"===i?this.coords.height(t):t}Ct(t,s){const i=s&&t in s?s[t]:this.options[t];return console.assert(null!=i,`A value for ${i} could not be resolved.`),"roughness"===t?u(i,0,1):i}Vt(t,s){const i=s&&t in s?s[t]:this.options.kt[t];return"function"==typeof i?i(this.coords):i}Zt(t){const s=this.Vt("fontSize",t),i=this.Vt("lineHeight",t),e=this.Vt("fontStyle",t);let h="number"==typeof s?`${s}px`:void 0;i&&h&&(h=`${s} / ${i}}`);return[h,this.Vt("fontFamily",t),e,this.Vt("fontWeight",t),this.Vt("fontStretch",t)].join(" ").trim()}Xt(t){for(const s in t){const i=this.Vt(s,t);if(!c(i)){if("transform"===s&&this.context.setTransform(i),"translation"===s){const{x:t,y:s}=i;this.context.translate(this.Pt(t),this.Dt(s))}if("rotation"===s)if("number"==typeof i)this.context.rotate(i);else{const{rotation:t,origin:s}=i,e=this.Pt(s.x),h=this.Dt(s.y);this.context.translate(e,h),this.context.rotate(t),this.context.translate(-e,-h)}if("scale"===s)if("origin"in i){const{origin:t,scale:s,ts:e=!1}=i,h=this.Pt(t.x),n=this.Dt(t.y);this.context.translate(h,n),this.context.scale(s.x,s.y),this.context.translate(-h,-n),e&&(this.context.lineWidth=this.context.lineWidth*(1/((s.x+s.y)/2)))}else{const{x:t,y:s}=i;this.context.scale(t,s)}"lineDash"===s&&this.context.setLineDash(i),"alpha"===s&&(this.context.globalAlpha=i),s in this.context&&"function"!=typeof this.context[s]&&(this.context[s]=this.Vt(s,t))}}this.context.font=this.Zt(t)}Bt(t={}){this.Ct("saveAndRestore",t)&&this.context.save(),this.Ct("skipApplyStyles",t)||this.Kt(t.kt),this.Ct("beginPath",t)&&this.context.beginPath()}Et(t){this.Ct("closePath",t)&&this.context.closePath(),this.Ct("fill",t)&&this.context.fill(),this.Ct("stroke",t)&&this.context.stroke(),this.Ct("saveAndRestore",t)&&this.context.restore()}Jt(t,s){this.context.save(),this.Kt(s);const i=this.context.measureText(t);return this.context.restore(),i}}const v=(t,s,i,h,n,r)=>e(t,s,h,n)<=i+r,S=(t,s)=>(t%s+s)%s,x=(t,s)=>{if(t.parentElement){const i=t.parentElement,{x:e,y:h}=s,n=new ResizeObserver((()=>{const{width:s,height:n}=i.getBoundingClientRect(),r=Math.min(s/e,n/h),o=t.clientWidth,a=t.clientHeight,c=Math.round(r*e),u=Math.round(r*h);c===o&&u===a||(t instanceof HTMLCanvasElement&&(t.width=c*l,t.height=u*l),t.style.width=c+"px",t.style.height=u+"px")}));return n.observe(i),n}return console.warn("aspectRatioResize: element has no parent and cannot be resized"),null},M=[[[58,15],[55,7],[48,4],[40,7],[37,15],[40,22],[48,26],[55,22],[58,15]],[[87,34],[85,30],[81,29],[14,29],[9,30],[8,34],[9,38],[14,40],[37,40],[37,88],[38,93],[43,95],[45,94],[49,90],[50,80],[52,80],[72,68],[72,62],[58,52],[58,40],[81,40],[85,38],[87,34]],[[50,68],[50,62],[54,65],[50,68]]];var b;!function(t){t.ss="gameplay",t.es="intro",t.hs="paused",t.ns="upgrade"}(b||(b={}));const R={move:{rs:!1,os:!1,left:!1,right:!1},timestamp:{ls:0,cs:-58e3},us:!1,ds:100,fs:{gs:0,level:0,next:0,ps:0},ws:!1,ys:[],vs:[],items:[],Ss:[],xs:b.es,Ms:3,bs:[],Rs:0,ks:1550},k={Cs:document.querySelector("canvas#upgrades"),As:document.querySelector("canvas#ui"),map:document.querySelector("canvas#map"),zs:document.querySelector("canvas#gameplay")},C={Cs:k.Cs.getContext("2d"),As:k.As.getContext("2d"),map:k.map.getContext("2d"),zs:k.zs.getContext("2d")},A=new r(0,0),z=new r(32,18),P=new r(z.x/2-1,z.y/2-1),D=1/z.x,O={strokeStyle:"white",fillStyle:"white",fontFamily:"Comic Sans MS, Chalkboard SE, Comic Neue sans-serif",textAlign:"center",textBaseline:"middle",lineWidth:t=>t.width(.00175),fontSize:t=>t.width(.1)},W={St:!0,xt:"width",stroke:!0},N={map:new y({canvas:k.map,I:[0,z.x],Y:[0,z.y]}),upgrade:new y({canvas:k.Cs,padding:.1}),As:new y({canvas:k.As})},B={map:new m(C.map,{...W,coords:N.map,kt:{...O,lineWidth:t=>t.width(.001)}}),zs:new m(C.zs,{...W,coords:N.map,kt:{...O},bt:.1}),upgrade:new m(C.Cs,{...W,coords:N.upgrade,kt:{...O,lineWidth:t=>t.width(.0175)},bt:.02}),As:new m(C.As,{...W,coords:N.As,kt:{...O}})},E=[3178312775,2263286931,486574442,329066167],L="#fff",$="rgb(28,5,50)",U="rgba(0,0,0)",j="rgb(253,93,106)",T="rgb(254,184,18)",F="rgb(111,254,237)",H="rgb(248,96,248)",I="rgb(1,255,185)",Y=t=>{return s=E[t],()=>{let t=s+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296};var s},K=[0,100],X=[-1,1],q={Ps:{}};class _{constructor(t,s=B.zs){this.Ds="",this.cache={},this.Os=!1,this.Ws=new r(0,0),this.Ns=new r(0,0),this.Bs=4,this.Es=0,this.position=t,this.Ls=s,this.$s=t.clone()}get Us(){if("Us"in this.cache)return this.cache.Us;const t=this.position.clone().add(this.js/2,this.js/2);return this.cache.Us=t,t}get Ts(){if("Ts"in this.cache)return this.cache.Ts;const t=this.position.clone().add(this.js/2,this.js/2);return this.cache.Ts=t,t}get key(){if("key"in this.cache)return this.cache.key;const t=[String(this.Ds),String(this.Fs),JSON.stringify(this.options)].join("~");return this.cache.key=t,t}Hs(t){this.Ns.x=d(t,this.$s.x,this.position.x),this.Ns.y=d(t,this.$s.y,this.position.y),this.Ws.x=d(t,this.Ts.x,this.Us.x),this.Ws.y=d(t,this.Ts.y,this.Us.y)}Is(t,s,i=!0){const e=this.key,h=e in q.Ps&&q.Ps[e].length;i&&this.Hs(t),h||(q.Ps[this.key]=((t,s,i,e,h)=>{const n=[];t.Kt(t.options.kt);for(let r=0;r<e;r++){const e=document.createElement("canvas");e.width=i,e.height=i;const o=e.getContext("2d");s(new m(o,{...t.options,kt:{...t.options.kt,lineWidth:t.context.lineWidth},coords:new y({canvas:e,I:h,Y:h}),random:Y(r)})),n.push(e)}return n})(this.Ls,this.Ys,this.Ls.coords.width(D*this.js),this.Bs,this.Ks));const n=q.Ps[e][this.Es];this.Ls.drawImage(n,this.Ns.x,this.Ns.y,s)}update(t,s,i){this.$s.set(this.position),this.Ts.set(this.Us),this.Es=Math.floor(t/R.ks%1*this.Bs)}Xs(){this.Us.x=this.position.x+this.js/2,this.Us.y=this.position.y+this.js/2}}class J extends _{constructor(t){super(t),this.qs=0,this._s=100,this.ds=100,this.Fs=.6,this.js=1.5,this.Ds=0,this.speed=.065,this.Ks=K,this.Js="right",this.Vs={kt:{scale:{origin:this.Ws,scale:new r(-1,1)}}},this.options={kt:{fillStyle:H},fill:!0},this.Ys=t=>{M.forEach((s=>{t.Nt(s,this.options)}))},this.update=(t,s)=>{super.update(t,s),this.Gs(t,s),this.Xs(),this.Qs(t)},this.Gs=(t,s)=>{const i=this.speed,e=.7071*i;let h=0,n=0;R.move.left&&R.move.rs?(h=-e,n=-e):R.move.left&&R.move.os?(h=-e,n=e):R.move.right&&R.move.rs?(h=e,n=-e):R.move.right&&R.move.os?(h=e,n=e):R.move.rs?n=-i:R.move.os?n=i:R.move.left?h=-i:R.move.right&&(h=i),this.position.x=u(this.position.x+h,0,z.x-1),this.position.y=u(this.position.y+n,0,z.y-1)}}get Zs(){const t=.1;return this.position.y<z.y*t?0:this.position.y>.9*z.y?1:this.position.x<z.x*t?2:this.position.x>.9*z.x&&3}Is(t){this.Hs(t),super.Is(t,"left"===this.Js?this.Vs:void 0,!1),B.zs.rect(this.Ws.x-.5,this.Ws.y+this.js/2,D*this.ds/this._s,D/10,{fill:!0,stroke:!1,bt:0,kt:{fillStyle:j}})}Qs(t){if(!(t<this.qs+J.ti))for(let s=0;s<R.ys.length;s++){const i=R.ys[s];v(this.Us.x,this.Us.y,this.Fs,i.Us.x,i.Us.y,i.Fs)&&this.si(i.ii,t)}}si(t,s){this.qs=s,this.ds-=t}}J.ti=400;const V=new J(P.clone()),G={6:{ei:[10,11,12.5,15,18,21.5,26.5],Range:[1.5,1.55,1.65,1.8,2,2.25,2.55],hi:[1,2,3,4,5,6,7]},8:{ei:[6,6.5,7.5,9,11,13.5,17],ni:[1,1.5,2,3,4,6,8]},9:{ei:[1,2,4,7,11,16,22],ri:[1.5,1.7,2,2.4,2.9,3.5,4.2]},10:{ei:[16,18,21,25,30,36,43],ni:[.5,.6,.7,.9,1.1,1.4,1.7]}},Q=(t,s)=>{const i=G[t];return Object.keys(i).map((t=>{const e=i[t],h=e[s-1];if(1===s)return`${t}: ${h}`;const n=e[s-2];return`${t}: ${n} -> ${h}`}))};class Z extends _{constructor(t,s=V.Us.clone()){super(s),this.oi=!1,this.ai=(t,s,i)=>{for(let e=0;e<R.ys.length;e++){const h=R.ys[e];v(this.Us.x,this.Us.y,this.Fs,h.Us.x,h.Us.y,h.Fs)&&(h.li(t,s,i,this.Ds),this.oi&&(this.Os=!0))}},this.parent=t}update(t,s,i){super.update(t,s),this.Gs(t,s,i),this.Xs(),this.ai(this.parent.li,i,t)}}class tt{constructor(t=!0){this.ci=[],t&&R.vs.push(this)}ui(){return this.level<7}Is(t,s){for(let i=0;i<this.ci.length;i++)this.ci[i].Is(t,s)}update(t,s){for(let i=0;i<this.ci.length;i++)this.ci[i].Os?this.ci.splice(i,1):this.ci[i].update(t,s,i)}}class st extends Z{constructor(t,s){super(t,V.position.clone()),this.Ks=X,this.js=1,this.Fs=.05,this.Ds=8,this.options=void 0,this.oi=!0,this.Ys=t=>{st.di(t)},this.Gs=(t,s)=>{this.position.x+=this.fi.x*this.parent.speed,this.position.y+=this.fi.y*this.parent.speed},this.fi=r.from(s,this.Us).normalize(),this.gi=this.fi.angle()+a,this.pi={kt:{rotation:{origin:this.Ws,rotation:this.gi}}}}static di(t){t.Nt([[-1,0],[1,0]]),t.Nt([[-.75,-.4],[-1,0],[-.75,.4]])}Is(t){this.Hs(t),super.Is(t,this.pi,!1)}}class it extends tt{constructor(t){super(t),this.level=1,this.range=5,this.speed=.1,this.wi=0,this.type=8,this.upgrade=()=>{this.ui()&&this.level++}}get yi(){return G[8]}get frequency(){return 1e3/this.yi["ni"][this.level-1]}get li(){return this.yi.ei[this.level-1]}update(t,s){if(super.update(t,s),t-this.wi>this.frequency){this.wi=t;const s=this.mi();s&&this.ci.push(new st(this,s.Us))}for(let i=0;i<this.ci.length;i++){const e=this.ci[i];e.update(t,s,i),e.Us.U(V.Us)>this.range&&(e.Os=!0)}}mi(){let t,s=1/0;for(let i=0;i<R.ys.length;i++){const e=V.Us.U(R.ys[i].Us);e<s&&(s=e,t=R.ys[i])}return t}}const et={vi:[],Si:[],xi:[],Mi:[],bi:[],Ri:[],ki:[],Ci:[]};let ht=0;const nt=(t,s)=>(et[t].push({id:ht,Ai:s}),ht++,ht-1),rt=(t,...s)=>{const i=et[t];for(let t=0;t<i.length;t++)i[t].Ai(...s)};new ResizeObserver((()=>{rt("CanvasResize")})).observe(k.map),window.addEventListener("keydown",(t=>{rt("KeyDown",t.key)})),window.addEventListener("keyup",(t=>{rt("KeyUp",t.key)})),window.addEventListener("resize",(t=>{rt("WindowResize")}));const ot=[.4,.2,.6],at=[0,.2,.6];class lt extends Z{constructor(t,s,i){super(t,s),this.Ks=X,this.js=2,this.Fs=.5,this.Ds=10,this.options=void 0,this.Ys=t=>{lt.di(t)},this.Gs=(t,s)=>{const i=g(t,this.start,this.start+this.parent.duration),e=-a/2-i*a;this.parent.zi(this.position,e,this.Pi),this.position.add(-this.js/2,-this.js/2)},this.start=i,this.Pi="left"===V.Js?1:-1,this.pi={kt:{rotation:{origin:this.Us,rotation:this.Pi*-Math.PI/4},scale:{origin:this.Us,scale:new r(-1*this.Pi,1)}}}}static di(t){const s=-1/3;t.Nt([[s,0],[s,0-ot[0]/2],[s+at[1],0-ot[1]/2],[s+at[2],0-ot[2]/2],[s+at[2],0+ot[2]/2],[s+at[1],0+ot[1]/2],[s,0+ot[0]/2],[s,0]]),t.Nt([[s+at[1],.8],[s+at[1],0+ot[0]/2]])}Is(t){super.Is(t,this.pi)}}class ct extends tt{constructor(t){super(t),this.level=1,this.range=1.7,this.speed=.09,this.duration=500,this.wi=0,this.type=10,this.upgrade=()=>{this.ui()&&this.level++}}get yi(){return G[10]}get frequency(){return 1e3/this.yi["ni"][this.level-1]}zi(t,s,i){t.x=V.Us.x+i*Math.cos(i*s)*this.range,t.y=V.Us.y+i*Math.sin(i*s)*this.range}get li(){return this.yi.ei[this.level-1]}update(t,s){if(super.update(t,s),t-this.wi>this.frequency){this.wi=t;const s=V.position.clone();this.zi(s,-a/2,1),s.add(-.5,-.5),this.ci.push(new lt(this,s,t))}for(let i=0;i<this.ci.length;i++){const e=this.ci[i];e.update(t,s,i),t-e.start>this.duration&&(e.Os=!0)}}}class ut extends Z{constructor(t,s){super(t),this.Ks=X,this.Ds=9,this.options=void 0,this.Ys=t=>{ut.di(t)},this.Gs=(t,s)=>{},this.start=s,this.Di={kt:{scale:new r(this.parent.Oi,this.parent.Oi)}},this.$s.add(-this.Fs,-this.Fs),this.position.add(-this.Fs,-this.Fs)}static di(t){t.jt(0,0,.5,{kt:{fillStyle:H,alpha:.1},fill:!0}),t.jt(0,0,.5,{kt:{strokeStyle:H}}),t.jt(0,0,.4,{kt:{strokeStyle:H}});for(let s=0;s<5;s++){const i=.3*Math.cos(o*s/5),e=.3*Math.sin(o*s/5);t.jt(i,e,.2,{kt:{strokeStyle:H}})}}get Fs(){return this.parent.Oi}get js(){return 2*this.Fs}}class dt extends tt{constructor(t){super(t),this.level=1,this.range=5,this.speed=.1,this.wi=0,this.frequency=1500,this.duration=1500,this.type=9,this.upgrade=()=>{this.ui()&&this.level++}}get yi(){return G[9]}get Oi(){return this.yi.ri[this.level-1]}get li(){return this.yi.ei[this.level-1]}update(t,s){super.update(t,s),t-this.wi>this.frequency&&(this.wi=t,this.ci.push(new ut(this,t)));for(let i=0;i<this.ci.length;i++){const e=this.ci[i];e.update(t,s,i),t-e.start>this.duration&&(e.Os=!0)}}}class ft extends Z{constructor(t){super(t),this.Ks=X,this.js=1,this.Ds=6,this.Fs=.25,this.offset=0,this.options=void 0,this.Ys=t=>{ft.di(t,this.Fs)},this.Gs=(t,s)=>{const i=this.offset+o*(t/this.parent.u),e=V.Us.x+Math.cos(i)*this.parent.range-this.js/2,h=V.Us.y+Math.sin(i)*this.parent.range-this.js/2;this.position.x=d(1-this.parent.Wi,this.$s.x,e),this.position.y=d(1-this.parent.Wi,this.$s.y,h)}}static di(t,s){t.jt(0,0,s,{kt:{fillStyle:H},fill:!0})}}class gt extends tt{constructor(t){super(t),this.level=1,this.Wi=.33,this.u=2e3,this.type=6,this.upgrade=()=>{if(this.ui())for(this.level++;this.ci.length<this.Ni;)this.ci.push(new ft(this)),this.ci.forEach(((t,s)=>t.offset=o*s/this.ci.length))},this.ci.push(new ft(this))}get yi(){return G[6]}get Ni(){return this.yi.hi[this.level-1]}get range(){return this.yi.Range[this.level-1]}get li(){return this.yi.ei[this.level-1]}}const pt={6:gt,8:it,10:ct,9:dt},wt=()=>{R.fs.ps=R.fs.gs,R.fs.level++,R.fs.next=50*Math.pow(R.fs.level,2),R.bs.length=0,R.bs=(t=>{const s=Object.keys(pt).map((t=>{const s=R.vs.find((s=>s.type===Number(t))),i=(s?.level??0)+1;let e,h,n,r=[];switch(Number(t)){case 8:{n=st.di;const o=G[8];1===i?(r=[`Damage: ${o.ei[i-1]}`,`Firing Rate: ${o["ni"][i-1]}`],e=()=>new it):s&&(e=()=>s.upgrade()),h=`Arrow - L${i}`,r=Q(t,i);break}case 10:n=lt.di,1===i?e=()=>new ct:s&&(e=()=>s.upgrade()),h=`Axe - L${i}`,r=Q(t,i);break;case 6:n=ft.di,1===i?e=()=>new gt:s&&(e=()=>s.upgrade()),h=`Orb - L${i}`,r=Q(t,i);break;case 9:n=ut.di,1===i?e=()=>new dt:s&&(e=()=>s.upgrade()),h=`Summoning Circle - L${i}`,r=Q(t,i);break;default:throw new Error}return{type:t,level:i,text:h,Bi:r,Is:n,Ei:e}})),i=[];for(let e=0;e<t;e++){const t=Math.floor(Math.random()*s.length);i.push(s[t]),s.splice(t,1)}return i})(R.Ms),rt("StateChange",b.ns)},yt=()=>{B.upgrade.options.random=Y(0),B.upgrade.clear();for(let t=0;t<R.Ms;t++){const s=R.bs[t],i=new y({offsetX:B.upgrade.coords.rt(-1)+B.upgrade.coords.width(t/R.Ms),offsetY:B.upgrade.coords.ot(-1),F:B.upgrade.coords.width()/R.Ms,H:B.upgrade.coords.height(),padding:.05}),e=new m(B.upgrade.context,{...B.upgrade.options,coords:i,stroke:!1});e.rect(-1,-1,1,1,{stroke:!0,fill:!0,kt:{fillStyle:$,strokeStyle:R.Rs===t?I:L}}),e.text(s.text,0,-.8,{kt:{textBaseline:"top",fillStyle:R.Rs===t?I:L},bt:0,yt:i.width(.9)}),s.Bi.forEach(((t,s)=>{e.text(t,0,.3+.2*s,{bt:0})}));const h=new m(B.upgrade.context,{...W,kt:{...O,lineWidth:t=>t.width(.01)},bt:.05,random:Y(0),coords:new y({F:e.coords.F,H:e.coords.F,offsetX:e.coords.offsetX,offsetY:e.coords.offsetY+e.coords.height(.1),padding:e.coords.padding+.2})});h.rect(-1,-1,1,1),e.options=B.zs.options,s.Is(h,.2)}},mt=()=>{const t=(R.fs.gs-R.fs.ps)/(R.fs.next-R.fs.ps);B.As.clear(),B.As.rect(-1,-1,1,1,{fill:!1,bt:0,stroke:!0}),B.As.rect(-1,-1,t,1,{fill:!0,bt:0,kt:{fillStyle:I}})},vt=()=>{for(let t=0;t<z.x;t++)for(let s=0;s<z.y;s++)B.map.rect(t,s,1/z.x,1/z.y,{kt:{strokeStyle:"rgba(255,255,255,0.1)"}})},St=[[[22,38],[35,87],[37,89],[44,92],[55,92],[60,89],[64,84],[76,38],[74,35],[59,22],[49,20],[38,22],[29,29],[22,38]],[[31,52],[45,55],[40,61],[35,59],[31,52]],[[58,61],[56,60],[54,55],[67,52],[62,59],[58,61]],[[58,25],[59,17],[63,12],[68,8],[76,7],[83,8],[88,12],[92,17],[94,25],[93,29],[89,38]],[[74,35],[89,52],[86,54],[83,55],[79,55],[75,51],[72,40],[74,35]],[[40,25],[38,17],[34,12],[29,8],[22,7],[15,8],[10,12],[6,17],[5,29],[9,38]],[[25,35],[9,52],[11,54],[14,55],[19,55],[22,51],[25,40],[25,35]]];class xt extends _{constructor(t,s){super(t),this.Li=t=>{this.Os=!0},this.$i=s}update(t,s,i){super.update(t,s),this.Gs(t,s,i),this.Xs()}Gs(t,s,i){this.$i.Ui&&((t,s,i,e)=>{const h=r.from(V.position,t);if(!i.start&&h.$<i.ji)i.start=s;else if(i.start&&h.$<1)i.Ti(e);else if(i.start){const e=s-i.start;h.normalize();const n=h.clone().multiply(.0015*e-.25);t.x+=n.x,t.y+=n.y}})(this.position,t,this.$i.Ui,i)}}class Mt extends xt{constructor(t,s){let i;super(t,{Ui:{ji:2,Fi:t.clone(),Ti:t=>{R.fs.gs+=s,R.fs.gs>R.fs.next&&rt("LevelUp"),mt(),this.Li(t)}}}),this.Ks=X,this.js=1,this.Fs=.25,this.Ds=11,this.Ys=t=>{t.It(0,0,this.Fs,5,.4,this.options)},this.fs=s,i=this.fs<20?0:this.fs<50?1:2,this.options={kt:Mt.kt[i],fill:!0}}}Mt.kt={0:{fillStyle:T,strokeStyle:T},1:{fillStyle:F,strokeStyle:F},2:{fillStyle:H,strokeStyle:H}};const bt=(0,i(257).i)({h:.5,l:1,o:.2,u:2});class Rt extends _{constructor(t,s,i){super(Rt.Hi(t.Us.clone(),t)),this.Fs=.5,this.js=1,this.duration=500,this.Di={kt:{scale:{origin:A,scale:new r(1,1)}}},this.options=void 0,this.Ks=X,this.Is=t=>{super.Is(t,this.Di)},this.Ys=t=>{t.text(this.text,0,0,{fill:!0,kt:{fontSize:t=>t.width(.35),textBaseline:"top"},bt:0})},this.target=t,this.Ds=s,this.text=s,this.start=i}static Hi(t,s){return t.x=s.Us.x-.5,t.y=s.Us.y-1.5,t}update(t,s){super.update(t,0,s);const i=bt((t-this.start)/this.duration);this.Di.kt.scale.origin=this.Us,this.Di.kt.scale.scale.x=i,this.Di.kt.scale.scale.y=i,Rt.Hi(this.position,this.target),t-this.start>=this.duration&&(this.Os=!0)}}class kt extends _{constructor(t,s,i){super(t),this.ii=5,this.speed=.025,this.Ii={10:1e3,9:150,6:1e3,8:1},this.Yi={},this.options={kt:{fillStyle:U},fill:!0},this.$i=s,this.ds=i,this._s=i}Ki(t){B.zs.text(String(t),this.Us.x,this.Us.y-this.js/2,{bt:0})}li(t,s,i,e){const h=this.Yi[e],n=e in this.Ii?this.Ii[e]:1e3;h&&i-h<n||(this.ds-=t,R.Ss.push(new Rt(this,String(t),i)),this.ds<=0&&this.Li(),this.Yi[e]=i)}Li(){const t=new Mt(this.Us.clone(),this._s);t.position.add(-t.js/2,-t.js/2),R.items.push(t),this.Os=!0}update(t,s){super.update(t,s),this.Gs(t,s),this.Xs()}Gs(t,s){this.$i.Xi&&((t,s)=>{const i=r.from(V.position,t).normalize().multiply(s);t.x+=i.x,t.y+=i.y})(this.position,this.speed),this.$i.qi&&((t,s,i)=>{const e=r.from(V.position,t);if(e.$<i.ji){const h=e.normalize().multiply(s*i.Xi);t.x+=h.x,t.y+=h.y}else{if(t.equals(i._i))return;if(t.U(i._i)<.1)t.set(i._i);else{const e=r.from(i._i,t).normalize().multiply(s*i.Xi);t.x+=e.x,t.y+=e.y}}})(this.position,s,this.$i.qi)}}class Ct extends kt{constructor(t,s){super(t,{qi:{Xi:.002,ji:3,_i:t.clone()}},s),this.Ks=K,this.js=1,this.Ds=1,this.Fs=.5,this.Ys=t=>{St.forEach((s=>t.Nt(s,this.options)))}}}Ct.Ji=7;const At=[[[87,35],[83,21],[80,15],[70,6],[57,1],[43,1],[30,6],[20,15],[15,28],[14,35],[9,39],[7,47],[9,54],[14,59],[18,72],[26,84],[37,92],[44,95],[57,95],[63,92],[74,84],[82,72],[87,59],[94,50],[95,47],[92,39],[87,35]],[[87,45],[76,44],[76,35],[80,34],[80,41],[83,41],[87,45]],[[78,63],[76,68],[76,65],[78,63]],[[63,74],[63,63],[71,63],[73,65],[73,74],[63,74]],[[45,74],[43,73],[43,65],[45,63],[57,63],[57,74],[45,74]],[[29,74],[30,63],[38,63],[40,65],[40,73],[29,74]],[[24,63],[25,68],[24,63]],[[22,30],[25,24],[25,29],[22,30]],[[57,19],[57,30],[43,29],[43,21],[45,19],[57,19]],[[78,30],[76,29],[76,24],[78,30]],[[73,58],[71,60],[63,60],[62,56],[58,54],[57,60],[45,60],[43,58],[43,54],[40,56],[38,60],[30,60],[29,35],[38,34],[40,35],[40,38],[43,40],[43,35],[45,34],[57,34],[58,40],[62,38],[63,34],[73,35],[73,58]],[[29,29],[29,19],[38,19],[40,21],[40,29],[29,29]],[[73,19],[73,29],[63,30],[63,19],[73,19]],[[63,16],[62,11],[70,16],[63,16]],[[40,14],[38,16],[31,16],[40,11],[40,14]],[[58,9],[57,16],[45,16],[43,14],[43,9],[58,9]],[[18,41],[21,41],[21,35],[24,34],[25,44],[14,45],[18,41]],[[18,52],[14,49],[25,50],[24,60],[22,60],[21,53],[18,52]],[[31,78],[40,79],[40,86],[31,78]],[[43,88],[43,79],[58,79],[58,88],[43,88]],[[62,86],[63,78],[71,78],[62,86]],[[83,52],[80,53],[78,60],[76,58],[76,50],[87,49],[83,52]],[[38,41],[33,42],[32,47],[33,50],[38,52],[41,50],[43,47],[41,42],[38,41]],[[63,41],[59,42],[58,47],[59,50],[63,52],[67,50],[69,47],[67,42],[63,41]]];class zt extends kt{constructor(t,s){super(t,{Xi:{Vi:.002}},s),this.Ks=K,this.js=1,this.Ds=4,this.Fs=.5,this.Ys=t=>{At.forEach((s=>t.Nt(s,this.options)))},this.options={...this.options,kt:{...this.options.kt,lineWidth:t=>t.width(.025)}}}}zt.Ji=13;const Pt=[[[37,36],[46,37],[53,42],[57,48],[60,58],[59,66],[56,69],[49,74],[46,84],[37,87],[31,86],[28,84],[26,74],[17,69],[14,62],[17,48],[21,42],[28,37],[37,36]],[[63,95],[68,71],[69,59],[67,45],[64,35],[58,28],[47,21],[37,19],[27,21],[15,28],[10,35],[7,45],[6,59],[6,71],[12,95]],[[14,61],[15,79],[21,95]],[[61,61],[59,79],[54,95]],[[77,21],[45,10],[29,9],[20,9],[12,13],[17,8],[25,4],[44,2],[71,6],[92,13],[77,21]],[[94,9],[82,95]],[[42,51],[39,53],[40,59],[43,63],[46,63],[51,60],[53,55],[53,51],[47,48],[42,51]],[[37,63],[34,66],[33,71],[41,71],[40,66],[37,63]],[[33,51],[30,49],[24,49],[22,51],[20,55],[24,60],[30,63],[34,59],[35,56],[33,51]]];class Dt extends kt{constructor(t,s){super(t,{Xi:{Vi:.002}},s),this.Ks=K,this.js=1,this.Ds=5,this.Fs=.5,this.Ys=t=>{Pt.forEach((s=>t.Nt(s,this.options)))}}}Dt.Ji=15;const Ot=[[[95,56],[75,43],[51,35],[43,53],[40,65],[40,82],[44,91],[49,95],[54,96],[65,94],[72,90],[86,74],[96,59],[95,56]],[[53,85],[49,80],[47,68],[56,79],[71,80],[59,85],[53,85]],[[73,71],[67,65],[76,65],[81,72],[73,71]],[[54,62],[49,55],[57,56],[63,62],[54,62]],[[39,47],[33,49],[27,56],[31,45],[36,42],[42,42],[44,36],[48,29],[52,29],[57,31],[55,20],[49,2],[24,7],[2,19],[11,42],[23,57],[35,63],[39,47]],[[43,22],[51,25],[43,29],[35,25],[43,22]],[[25,36],[16,38],[20,31],[29,29],[25,36]]];class Wt extends kt{constructor(t,s){super(t,{Xi:{Vi:.002}},s),this.Ks=K,this.js=2,this.Ds=2,this.Fs=.8,this.Ys=t=>{Ot.forEach((s=>t.Nt(s,this.options)))}}}Wt.Ji=10;const Nt=[[[58,46],[68,43],[75,40],[74,43],[70,50],[63,50],[60,49],[58,46]],[[49,3],[35,6],[24,14],[16,26],[14,40],[16,62],[23,78],[34,88],[49,94],[62,89],[73,79],[81,63],[84,40],[81,26],[73,14],[62,6],[49,3]],[[46,48],[45,59],[37,54],[34,57],[31,63],[32,73],[43,84],[35,81],[26,74],[21,63],[19,50],[19,34],[22,24],[29,14],[41,7],[32,17],[31,32],[33,37],[39,41],[42,38],[43,31],[46,43],[43,45],[46,48]],[[56,85],[64,76],[68,68],[66,59],[61,54],[58,55],[54,59],[53,48],[56,46],[53,44],[54,33],[56,31],[58,40],[62,40],[65,37],[68,28],[66,18],[58,7],[69,14],[76,24],[79,34],[79,50],[77,63],[75,70],[69,77],[62,82],[56,85]],[[41,46],[30,43],[23,40],[23,43],[27,50],[35,50],[38,49],[41,46]]];class Bt extends kt{constructor(t,s){super(t,{Xi:{Vi:.002}},s),this.Ks=K,this.js=1,this.Ds=3,this.Fs=.5,this.Ys=t=>{Nt.forEach((s=>t.Nt(s,this.options)))},this.options={...this.options,kt:{...this.options.kt,lineWidth:t=>t.width(.025)}}}}Bt.Ji=5;const Et={1:Ct,2:Wt,3:Bt,4:zt,5:Dt};class Lt extends _{constructor(t,s){super(t),this.Os=!1,this.Ds=12,this.Fs=1.5,this.js=3,this.duration=2500,this.Gi=R.ks/2,this.options=void 0,this.Ks=X,this.Ys=t=>{t.rect(-.2,-.8,.2,.8,{kt:{rotation:{origin:A,rotation:a/4},fillStyle:j},fill:!0,stroke:!1}),t.rect(-.2,-.8,.2,.8,{kt:{rotation:{origin:A,rotation:-a/4},fillStyle:j},fill:!0,stroke:!1})},this.start=s}update(t,s){super.update(t,0,s),t-this.start>Lt.duration&&(this.Os=!0)}}Lt.duration=2500;const $t=[0,1,2,3],Ut=Object.keys(Et),jt=t=>{const s=1e3*(9e5-Math.max(0,t)/1e3)/1e6;if(t-R.timestamp.ls>=s){R.timestamp.ls=t;const s=f(Ut),i=f($t);let e,h;0===i&&(e=f(z.x),h=0),1===i&&(e=f(z.x),h=z.y),2===i&&(e=0,h=f(z.y)),3===i&&(e=0,h=f(z.y));const n=Et[s];R.ys.push(new n(new r(e,h),(t=>Et[t].Ji*R.fs.level*.5)(s)))}t-R.timestamp.cs>=6e4&&Tt(t)},Tt=t=>{const s=(t-R.timestamp.cs-6e4)/Lt.duration;if(s<1&&!R.ws){const s=f(.8*z.x,.1),i=f(.8*z.y,.1),e=new Lt(new r(s,i),t);R.ws=e,R.Ss.push(e)}else if(s>1&&R.ws){const s=Math.floor(f(16,12));for(let t=0;t<s;t++){const i=R.ws.Us.x+1.5*Math.cos(o*t/s),e=R.ws.Us.y+1.5*Math.sin(o*t/s);R.ys.push(new Ct(new r(i,e),5))}R.timestamp.cs=t,R.ws=!1}};let Ft;const Ht=[[[16,20],[25,25],[26,24],[25,19],[22,17],[19,17],[16,20]],[[34,5],[30,5],[28,7],[28,13],[30,15],[35,15],[38,12],[37,6],[34,5]],[[65,5],[61,8],[61,12],[64,15],[69,15],[71,13],[71,7],[69,5],[65,5]],[[74,25],[83,19],[80,17],[75,18],[73,21],[74,25]],[[21,47],[26,50],[21,47]],[[21,47],[26,50],[21,47]],[[21,53],[25,50],[21,53]],[[21,53],[25,50],[21,53]],[[74,50],[78,53],[79,52],[74,50]],[[74,50],[78,53],[79,52],[74,50]],[[74,49],[78,46],[74,49]],[[74,49],[78,46],[74,49]]],It=[[[25,50],[40,58],[52,60],[59,58],[74,49],[58,44],[46,43],[25,50]]],Yt=[[[86,37],[85,34],[81,34],[79,36],[79,40],[83,42],[86,40],[86,37]],[[20,39],[20,35],[13,35],[14,41],[17,42],[20,39]]],Kt=[[[25,49],[26,50],[44,44],[55,44],[74,50],[63,43],[52,39],[40,41],[25,49]],[[16,20],[16,26],[20,28],[24,27],[25,25],[16,20]],[[55,5],[53,1],[48,0],[45,2],[44,7],[46,10],[51,11],[54,9],[55,5]],[[74,25],[78,28],[82,27],[84,24],[83,19],[74,25]],[[21,40],[21,36],[18,34],[13,34],[11,37],[11,42],[13,44],[19,44],[21,40]],[[29,8],[28,13],[30,15],[35,14],[35,8],[29,8]],[[64,14],[69,15],[71,13],[71,9],[68,7],[64,8],[64,14]],[[78,41],[80,44],[86,44],[88,42],[87,35],[79,35],[78,41]],[[-90,50],[-89,51],[-72,45],[-60,45],[-43,51],[-41,50],[-62,40],[-70,40],[-76,42],[-90,50]],[[-99,21],[-100,26],[-98,28],[-95,29],[-91,27],[-99,21]],[[-61,6],[-63,2],[-67,1],[-71,4],[-71,9],[-67,12],[-64,12],[-61,9],[-61,6]],[[-41,26],[-40,28],[-37,29],[-34,28],[-32,26],[-32,21],[-33,20],[-41,26]],[[-94,41],[-94,38],[-97,35],[-102,35],[-105,39],[-102,45],[-97,45],[-94,41]],[[-86,9],[-88,13],[-85,16],[-82,16],[-80,14],[-80,10],[-82,8],[-86,9]],[[-51,15],[-45,15],[-45,9],[-50,8],[-52,10],[-51,15]],[[-37,42],[-35,45],[-30,45],[-27,39],[-30,35],[-35,35],[-38,39],[-37,42]]],Xt=.2;const qt=new class extends _{constructor(){super(...arguments),this.Ks=K,this.options=void 0,this.Fs=1,this.js=z.y,this.Ds="third-eye",this.Ys=t=>{(t=>{It.forEach((s=>{t.Nt(s,{fill:!0,kt:{fillStyle:$},bt:Xt})})),Ht.forEach((s=>{t.Nt(s,{bt:Xt})})),t.jt(50,50,.09,{bt:Xt}),t.jt(50,50,.06,{bt:Xt}),t.jt(50,65,.01,{bt:Xt}),t.jt(50,70,.0125,{bt:Xt}),t.jt(50,75,.015,{bt:Xt}),Kt.forEach((s=>{t.Nt(s,{fill:!0,kt:{fillStyle:H},bt:Xt})})),Yt.forEach((s=>{t.Nt(s,{fill:!0,kt:{fillStyle:$},bt:Xt})})),t.text("BARDO",50,23,{bt:0}),t.text("The journey between",50,30,{bt:0,kt:{fontSize:t=>t.width(.035)}}),t.text("lives on Earth",50,35,{bt:0,kt:{fontSize:t=>t.width(.035)}}),t.text("Press any key to start",50,92,{bt:0,kt:{fontSize:t=>t.width(.04)}}),t.Nt([[50,79],[50,87]],{bt:Xt}),t.Nt([[47,85],[50,87],[53,85]],{bt:Xt})})(t)}}}(new r((z.x-z.y)/2,0)),_t=new(s()),Jt=_t.A(new(s().k)("phys","#0ff","#002"));_t.R.id="stats",document.body.appendChild(_t.R);const Vt=1e3/60;let Gt=0,Qt=0,Zt=0,ts=0;const ss=(t=0)=>{_t.D();const s=R.xs===b.hs?0:t-Qt;for(Qt=t,ts=0===V.qs?1:Math.min(1,(Gt-V.qs)/J.ti),Zt+=Math.min(s,50)*ts;Zt>=Vt;)is(),Zt-=Vt,Gt+=Vt;es(Zt/Vt),_t.end(),window.requestAnimationFrame(ss)},is=()=>{if(Jt.update(59.99999999999999,200),R.xs===b.es&&qt.update(Gt,Vt),R.xs===b.ss){V.update(Gt,Vt);for(let t=R.vs.length-1;t>=0;t--)R.vs[t].update(Gt,Vt);for(let t=R.ys.length-1;t>=0;t--)R.ys[t].Os?R.ys.splice(t,1):R.ys[t].update(Gt,Vt);for(let t=R.items.length-1;t>=0;t--)R.items[t].Os?R.items.splice(t,1):R.items[t].update(Gt,Vt,t);for(let t=R.Ss.length-1;t>=0;t--)R.Ss[t].Os?R.Ss.splice(t,1):R.Ss[t].update(Gt,t);jt(Gt)}},es=t=>{if(B.zs.clear(),R.xs===b.es&&qt.Is(t),R.xs===b.ss||R.xs===b.hs){for(let s=0;s<R.vs.length;s++)R.vs[s].Is(t);for(let s=0;s<R.ys.length;s++)R.ys[s].Is(t);for(let s=0;s<R.items.length;s++)R.items[s].Is(t);for(let s=0;s<R.Ss.length;s++)R.Ss[s].Is(t);V.Is(t),ts<1&&B.zs.rect(0,0,z.x,z.y,{bt:0,fill:!0,kt:{fillStyle:"red",alpha:.33*(1-ts)}})}};x(k.map,z),x(k.zs,z),x(k.Cs,z),nt("KeyDown",(t=>{if(R.xs!==b.es){if("Enter"===t&&R.xs===b.ns){R.bs[R.Rs].Ei(),R.Rs=0,B.upgrade.clear(),rt("StateChange",b.ss)}"Shift"===t&&(R.fs.gs=R.fs.next,rt("LevelUp")),"Escape"===t&&R.xs===b.ss&&rt("StateChange",b.hs),"ArrowLeft"!==t&&"a"!==t||(R.xs===b.ss&&(R.move.left=!0,V.Js="left"),R.xs===b.ns&&(R.Rs=S(R.Rs-1,R.Ms),yt())),"ArrowRight"!==t&&"d"!==t||(R.xs===b.ss&&(R.move.right=!0,V.Js="right"),R.xs===b.ns&&(R.Rs=S(R.Rs+1,R.Ms),yt())),"ArrowUp"!==t&&"w"!==t||(R.move.rs=!0),"ArrowDown"!==t&&"s"!==t||(R.move.os=!0)}else rt("StateChange",b.ss)})),nt("KeyUp",(t=>{"ArrowLeft"!==t&&"a"!==t||(R.move.left=!1),"ArrowRight"!==t&&"d"!==t||(R.move.right=!1),"ArrowUp"!==t&&"w"!==t||(R.move.rs=!1),"ArrowDown"!==t&&"s"!==t||(R.move.os=!1),"Enter"===t&&R.xs===b.hs&&rt("StateChange",b.ss)})),nt("CanvasResize",(()=>{for(const t in q.Ps)q.Ps[t].length=0;const t=k.map.getBoundingClientRect();k.As.style.height=String(.05*t.height),k.As.style.left=String(t.left),k.As.style.top=String(t.top-k.As.clientHeight),k.As.style.width=String(t.width),k.As.width=k.As.clientWidth*l,k.As.height=k.As.clientHeight*l,R.xs===b.ss&&(vt(),mt()),R.xs===b.ns&&yt()})),nt("WindowResize",(()=>{const t=k.map.getBoundingClientRect();k.As.style.height=String(.05*t.height),k.As.style.left=String(t.left),k.As.style.top=String(t.top-k.As.clientHeight),k.As.style.width=String(t.width)})),nt("StateChange",(t=>{switch(t){case b.ns:R.Rs=0,yt(),Ft=nt("CanvasResize",yt);case b.ss:B.map.clear(),B.As.clear(),vt(),mt()}t!==b.ns&&(t=>{let s;for(s in et)for(let i=et[s].length-1;i>=0;i--)et[s][i].id===t&&et[s].splice(i,1)})(Ft),R.xs=t})),nt("LevelUp",wt),nt("Initialize",(()=>{document.body.style.backgroundColor=$,k.map.style.zIndex="-1",wt(),new it})),rt("Initialize"),rt("StateChange",b.es),window.requestAnimationFrame(ss)})()})();</script></body></html>