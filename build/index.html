<html><head><link href="main.css" rel="stylesheet"></head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>Bardo</title><body class="full"><div id="root"><canvas id="ui"></canvas><canvas id="upgrades"></canvas><canvas id="map"></canvas><canvas id="gameplay"></canvas></div><script>(()=>{var t={705:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.i=void 0;i.i=function(t){var i=void 0===t?{}:t,s=i.o,e=void 0===s?0:s,n=i.h,r=void 0===n?-1:n,o=i.u,h=void 0===o?1:o,a=i.l,u=void 0===a?1:a,c=i.v,l=void 0===c?0:c,f=i.p,d=void 0===f?0:f,v=i.g,p=void 0!==v&&v;if(e<r||e>h)throw new Error("yStart must be between yMin and yMax");var g=2*Math.PI,w=(r+h)/2,M=(h-r)/2,m=p?-1:1,b=Math.asin(2*(e-r)/(h-r)-1)*(u/g);return function(t){return w+M*Math.sin(m*(g*(t-l+b))/u)+d}}},257:function(t,i,s){"use strict";var e=this&&this.M||(Object.create?function(t,i,s,e){void 0===e&&(e=s),Object.defineProperty(t,e,{m:!0,get:function(){return i[s]}})}:function(t,i,s,e){void 0===e&&(e=s),t[e]=i[s]}),n=this&&this.S||function(t,i){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(i,s)||e(i,t,s)};Object.defineProperty(i,"t",{value:!0}),n(s(705),i)},712:function(t,i,s){"use strict";var e=this&&this._||function(){return e=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t},e.apply(this,arguments)};Object.defineProperty(i,"t",{value:!0}),i.O=i.j=void 0;var n=s(839),r=s(603),o=s(674);!function(t){t.R="width",t.k="height"}(i.j||(i.j={}));var h=function(){function t(t,i){var s;void 0===i&&(i={}),this.context=t,this.coords=null!==(s=i.coords)&&void 0!==s?s:new n.A({canvas:t.canvas});var r={beginPath:!0,closePath:!1,fill:!1,C:void 0,N:!0,stroke:!1,P:!1,D:!1,W:!1,L:0,U:!1};this.options=e(e({},r),i),this.options.B=e(e({},{fontFamily:"sans-serif",fontSize:16}),i.B)}return t.prototype.rect=function(t,i,s,e,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===e&&(e=1),void 0===n&&(n={}),this.I("roughness",n)?this.T(t,i,s,e,n):this.K(t,i,s,e,n)},t.prototype.T=function(t,i,s,n,r){var o=this.F(t),h=this.H(i),a=this.q(s),u=this.J(n),c=[[o,h],[o+a,h],[o+a,h+u],[o,h+u],[o,h]];this.Y(c,e(e({},r),{P:!1,N:!0,U:!0}))},t.prototype.K=function(t,i,s,e,n){this.V(n),this.context.rect(this.F(t,n),this.H(i,n),this.q(s),this.J(e)),this.X(n)},t.prototype.Y=function(t,i){void 0===i&&(i={}),this.I("roughness",i)?this.G(t,i):this.Z(t,i)},t.prototype.Z=function(t,i){this.V(i);for(var s=0;s<t.length;s++){var e=this.F(t[s][0],i),n=this.H(t[s][1],i);0===s?this.context.moveTo(e,n):this.context.lineTo(e,n)}this.X(i)},t.prototype.G=function(t,i){for(var s=this.I("roughness",i)||0,r=t.length-1,o=0;o<2;o++){for(var h=[],a=0;a<r;a++)for(var u=t[a],c=u[0],l=u[1],f=t[a+1],d=f[0],v=f[1],p=s*Math.sqrt(Math.pow(c-d,2)+Math.pow(l-v,2)),g=0;g<4;g++){var w=Math.random()*p,M=Math.random()*n.$,m=w*Math.cos(M),b=w*Math.sin(M),y=NaN,S=NaN;if(0===g&&(y=c+m,S=l+b),1===g){var _=.5;y=(0,n.tt)(_,c,d)+m,S=(0,n.tt)(_,l,v)+b}if(2===g){_=.75;y=(0,n.tt)(_,c,d)+m,S=(0,n.tt)(_,l,v)+b}3===g&&(i.U&&a===r-1?(y=h[0][0],S=h[0][1]):(y=d+m,S=v+b)),h.push([y,S])}var O=0===o?i:e(e({},i),{fill:!1});this.it(h,O)}},t.prototype.it=function(t,i){var s=this;void 0===i&&(i={}),this.V(i);for(var e=0;e<t.length-1;e++){var n=this.F(t[e][0],i),r=this.H(t[e][1],i);if(0===e)this.context.moveTo(n,r);else{var o=this.F(t[e+1][0],i),h=this.H(t[e+1][1],i);if(o===n&&h===r)this.context.lineTo(o,h);else{var a=(n+o)/2,u=(r+h)/2;this.context.quadraticCurveTo(n,r,a,u)}}}t.slice(-1).forEach((function(t){s.context.lineTo(s.F(t[0],i),s.H(t[1],i))})),this.X(i)},t.prototype.st=function(t,i,s,e){void 0===e&&(e={}),this.I("roughness",e)?this.et(t,i,s,e):this.nt(t,i,s,e)},t.prototype.nt=function(t,i,s,e){this.V(e),this.context.arc(this.F(t,e),this.H(i,e),this.rt(s,e),0,n.$),this.X(e)},t.prototype.et=function(t,i,s,r){for(var o=(this.I("roughness",r)||0)*this.rt(s,r)/window.innerWidth,h=0;h<2;h++){for(var a=[],u=0;u<16;u++){var c=Math.random()*o,l=Math.random()*n.$,f=c*Math.cos(l),d=c*Math.sin(l),v=n.$*u/16,p=this.F(t+f,r)+Math.cos(v)*this.rt(s,r),g=this.H(i+d,r)+Math.sin(v)*this.rt(s,r);a.push([p,g])}a[16]=a[0],a[17]=a[1],this.it(a,e(e({},r),{P:!1,N:!0,U:!0}))}},t.prototype.drawImage=function(t,i,s,e){void 0===e&&(e={}),this.V(e),this.context.drawImage(t,this.F(i,e),this.H(s,e)),this.X(e)},t.prototype.ot=function(t,i,s,r,o,h){void 0===h&&(h={}),this.Y((0,n.ot)(this.F(t,h),this.H(i,h),this.rt(s,h),r,o),e(e({},h),{P:!1,N:!0}))},t.prototype.ht=function(t,i,s,r,o){void 0===o&&(o={});var h=this.I("roughness",o);this.Y((0,n.ht)(this.F(t,o),this.H(i,o),this.rt(s,o),r),e(e({},o),{P:!1,N:!0,U:Boolean(h)}))},t.prototype.ut=function(t){this.ct(e(e({},this.options.B),t))},t.prototype.text=function(t,i,s,e){void 0===e&&(e={}),this.I("roughness",e)?this.lt(t,i,s,e):this.ft(t,i,s,e)},t.prototype.ft=function(t,i,s,e){void 0===e&&(e={}),this.V(e),this.context.fillText(t,this.F(i,e),this.H(s,e),this.I("maxTextWidth",e)),this.X(e)},t.prototype.lt=function(t,i,s,r){var h,a=this;void 0===r&&(r={});var u=this.dt(t,r.B),c=u.actualBoundingBoxAscent,l=u.actualBoundingBoxDescent,f=u.width,d=null!==(h=this.I("roughness",r))&&void 0!==h?h:0,v=t.split(""),p=c-l,g=this.coords.vt(p),w=f/v.length,M=this.coords.gt(w)-this.coords.gt(0),m=M*v.length;this.ut(r.B),v.forEach((function(t,h){var u,c;if("left"===a.context.textAlign)c=(u=i+M*h)+M/2;else if("right"===a.context.textAlign)c=(u=-m+i+M*(h+1))-M/2;else{if("center"!==a.context.textAlign)throw new Error("textAlign must be 'left', 'right', or 'center' to use rough text");c=u=-m/2+i+M*(.5+h)}var l,v=s;if("top"===a.context.textBaseline)l=v-g/2;else if("bottom"===a.context.textBaseline)l=v-g/2;else{if("middle"!==a.context.textBaseline)throw new Error("textBaseline must be 'top', 'bottom', or 'middle' to use rough text");l=v}var p=d*f*.05,w=[(0,n.random)(Math.min(.4,p/6.5))*M,(0,n.random)(Math.min(.4,p/6.5))*M],b=[(0,n.random)(Math.min(.4,p/6.5))*g,(0,n.random)(Math.min(.4,p/6.5))*g];a.ft(t,u+w[0],v+b[0],e(e({},r),{B:e(e({},r.B),{rotation:{origin:new o.wt(c,l),rotation:p*Math.PI/16}})})),a.ft(t,u+w[1],v+b[1],e(e({},r),{B:e(e({},r.B),{rotation:{origin:new o.wt(c,l),rotation:-p*Math.PI/16}})}))}))},t.prototype.clear=function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.Mt=function(t,i){void 0===i&&(i={}),t.width=t.clientWidth*(i.bt?r.yt:1),t.height=t.clientHeight*(i.bt?r.yt:1)},t.prototype.F=function(t,i){return void 0===i&&(i={}),this.I("useNormalCoordinates",i)?this.coords.St(t):t},t.prototype.H=function(t,i){return void 0===i&&(i={}),this.I("useNormalCoordinates",i)?this.coords._t(t):t},t.prototype.q=function(t){return this.coords.width(t)},t.prototype.J=function(t){return this.coords.height(t)},t.prototype.rt=function(t,i){void 0===i&&(i={});var s=this.I("scalarNormalization",i);return"width"===s?this.coords.width(t):"height"===s?this.coords.height(t):t},t.prototype.I=function(t,i){return i&&t in i?i[t]:this.options[t]},t.prototype.Ot=function(t,i){var s=i&&t in i?i[t]:this.options.B[t];return"function"==typeof s?s(this.coords):s},t.prototype.xt=function(t){var i=this.Ot("fontSize",t),s=this.Ot("lineHeight",t),e=this.Ot("fontStyle",t),n=this.Ot("fontFamily",t),r=this.Ot("fontWeight",t),o=this.Ot("fontStretch",t),h="number"==typeof i?"".concat(i,"px"):void 0;return s&&h&&(h="".concat(i," / ").concat(s,"}")),[h,n,e,r,o].join(" ").trim()},t.prototype.ct=function(t){for(var i in t){var s=this.Ot(i,t);if(!(0,n.jt)(s)){if("transform"===i&&this.context.setTransform(s),"translation"===i){var e=s,r=e.x,o=e.y;this.context.translate(this.F(r),this.H(o))}if("rotation"===i)if("number"==typeof s)this.context.rotate(s);else{var h=s,a=h.rotation,u=h.origin,c=this.F(u.x),l=this.H(u.y);this.context.translate(c,l),this.context.rotate(a),this.context.translate(-c,-l)}if("scale"===i)if("origin"in s){var f=s,d=f.origin,v=f.scale,p=f.Rt,g=void 0!==p&&p;c=this.F(d.x),l=this.H(d.y);this.context.translate(c,l),this.context.scale(v.x,v.y),this.context.translate(-c,-l),g&&(this.context.lineWidth=this.context.lineWidth*(1/((v.x+v.y)/2)))}else{var w=s;r=w.x,o=w.y;this.context.scale(r,o)}"lineDash"===i&&this.context.setLineDash(s),"alpha"===i&&(this.context.globalAlpha=s),i in this.context&&"function"!=typeof this.context[i]&&(this.context[i]=this.Ot(i,t))}}this.context.font=this.xt(t)},t.prototype.V=function(t){void 0===t&&(t={}),this.I("saveAndRestore",t)&&this.context.save(),this.I("skipApplyStyles",t)||this.ut(t.B),this.I("beginPath",t)&&this.context.beginPath()},t.prototype.X=function(t){this.I("closePath",t)&&this.context.closePath(),this.I("fill",t)&&this.context.fill(),this.I("stroke",t)&&this.context.stroke(),this.I("saveAndRestore",t)&&this.context.restore()},t.prototype.dt=function(t,i){this.context.save(),this.ut(i);var s=this.context.measureText(t);return this.context.restore(),s},t}();i.O=h},659:function(t,i,s){"use strict";var e=this&&this._||function(){return e=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t},e.apply(this,arguments)};Object.defineProperty(i,"t",{value:!0}),i.A=void 0;var n,r=s(654),o=s(796),h=s(908),a=s(482);!function(t){t.kt="up",t.zt="down"}(n||(n={}));var u=function(){function t(t){if(void 0===t&&(t={}),(0,o.jt)(t.canvas)&&(0,r.At)(t.Ct,t.Nt))throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");Object.assign(this,e(e({},{Pt:[-1,1],Et:[-1,1],Dt:!1,orientationY:"down",Wt:!1}),t))}return t.prototype.Lt=function(){var t;return null!==(t=this.Ct)&&void 0!==t?t:this.canvas.width},t.prototype.Ut=function(){return this.Lt()-2*this.Bt()},t.prototype.It=function(){var t;return null!==(t=this.Nt)&&void 0!==t?t:this.canvas.height},t.prototype.Tt=function(){return this.It()-2*this.Kt()},t.prototype.Ft=function(){var t,i;return null!==(i=null!==(t=this.Ht)&&void 0!==t?t:this.padding)&&void 0!==i?i:0},t.prototype.Bt=function(){return this.Ft()*this.Lt()},t.prototype.qt=function(){return(0,o.jt)(this.Jt)?(0,o.jt)(this.padding)?0:this.Wt?this.padding*(this.Lt()/this.It()):this.padding:this.Jt},t.prototype.Kt=function(){return this.qt()*this.It()},t.prototype.Yt=function(){var t;return null!==(t=this.offsetX)&&void 0!==t?t:0},t.prototype.Vt=function(){var t;return null!==(t=this.offsetY)&&void 0!==t?t:0},t.prototype.St=function(t){var i=(0,a.normalize)(t,this.Pt[0],this.Pt[1],this.Dt);return this.Bt()+this.Yt()+i*this.Ut()},t.prototype._t=function(t){var i=(0,a.normalize)(t,this.Et[0],this.Et[1],this.Dt),s=this.Xt===n.kt;return this.Kt()+this.Vt()+(s?1-i:i)*this.Tt()},t.prototype.gt=function(t){var i=(0,a.normalize)(t,this.Bt(),this.Bt()+this.width(),this.Dt);return(0,h.tt)(i,this.Pt[0],this.Pt[1])},t.prototype.Gt=function(t){var i=(0,a.normalize)(t,this.Kt(),this.Kt()+this.height(),this.Dt);return(0,h.tt)(i,this.Pt[0],this.Pt[1])},t.prototype.width=function(t){return this.Ut()*(null!=t?t:1)},t.prototype.height=function(t){return this.Tt()*(null!=t?t:1)},t.prototype.Qt=function(t){return this.gt(t)-this.gt(0)},t.prototype.vt=function(t){return this.Gt(t)-this.Gt(0)},t}();i.A=u},326:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Zt=void 0;var e=s(839);i.Zt=function(t,i){if(t.parentElement){var s=t.parentElement,n=i.x,r=i.y,o=new ResizeObserver((function(){var i=s.getBoundingClientRect(),o=i.width,h=i.height,a=Math.min(o/n,h/r),u=t.clientWidth,c=t.clientHeight,l=Math.round(a*n),f=Math.round(a*r);l===u&&f===c||(t instanceof HTMLCanvasElement&&(t.width=l*e.yt,t.height=f*e.yt),t.style.width=l+"px",t.style.height=f+"px")}));return o.observe(s),o}return console.warn("aspectRatioResize: element has no parent and cannot be resized"),null}},999:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.$t=void 0;i.$t=function(t,i,s){var e=s*Math.sqrt(3)/2;return[[t,i-2*e/3],[t+s/2,i*(e/3)],[t-s/2,i*(e/3)]]}},125:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ti=void 0;i.ti=function(t,i,s,e){var n=Math.sqrt(e*e/4-s*s);return[[t,i-2*n/3],[t+e/2,i*(n/3)],[t-e/2,i*(n/3)]]}},932:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ht=void 0;var e=s(965);i.ht=function(t,i,s,n){void 0===n&&(n=5);for(var r=[],o=0,h=n;o<=h;o++){var a=-e.PI/(2*n)+e.$*(o/h);r.push([t+Math.cos(a)*s,i+Math.sin(a)*s])}return r}},166:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ii=void 0;i.ii=function(t,i,s,e,n){return[Math.cos(n)*(t-s)-Math.sin(n)*(i-e)+s,Math.sin(n)*(t-s)+Math.cos(n)*(i-e)+e]}},154:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ot=void 0;var e=s(965);i.ot=function(t,i,s,n,r){void 0===n&&(n=5),void 0===r&&(r=.4);for(var o=[],h=0,a=2*n;h<=a;h++){var u=-e.PI/(2*n)+e.$*(h/a),c=h%2;o.push([t+Math.cos(u)*(0===c?s:s*r),i+Math.sin(u)*(0===c?s:s*r)])}return o}},839:function(t,i,s){"use strict";var e=this&&this.M||(Object.create?function(t,i,s,e){void 0===e&&(e=s),Object.defineProperty(t,e,{m:!0,get:function(){return i[s]}})}:function(t,i,s,e){void 0===e&&(e=s),t[e]=i[s]}),n=this&&this.S||function(t,i){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(i,s)||e(i,t,s)};Object.defineProperty(i,"t",{value:!0}),n(s(712),i),n(s(659),i),n(s(603),i),n(s(147),i),n(s(654),i),n(s(796),i),n(s(90),i),n(s(466),i),n(s(92),i),n(s(358),i),n(s(159),i),n(s(600),i),n(s(965),i),n(s(908),i),n(s(250),i),n(s(482),i),n(s(674),i),n(s(326),i),n(s(999),i),n(s(125),i),n(s(932),i),n(s(166),i),n(s(154),i)},603:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.yt=void 0,i.yt=window.devicePixelRatio||1},90:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.si=void 0;i.si=function(t){return JSON.parse(JSON.stringify(t))}},147:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ei=void 0;i.ei=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.every((function(t){return void 0===t}))}},654:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.At=void 0;i.At=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.some((function(t){return void 0===t}))}},796:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.jt=void 0;i.jt=function(t){return void 0===t}},466:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ni=void 0;i.ni=function(t){for(new Date;new Date-t<ms;);}},674:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.wt=void 0;var e=s(159),n=function(){function t(t,i){this.x=t,this.y=i}return Object.defineProperty(t.prototype,"ratio",{get:function(){return this.x/this.y},m:!1,ri:!0}),Object.defineProperty(t.prototype,"oi",{get:function(){return Math.pow(Math.pow(this.x,2)+Math.pow(this.y,2),.5)},m:!1,ri:!0}),t.prototype.add=function(t,i){return"number"==typeof t?(this.x+=t,"number"==typeof i&&(this.y+=i)):(this.x+=t.x,this.y+=t.y),this},t.prototype.angle=function(){return Math.atan2(-this.y,-this.x)+Math.PI},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.hi=function(t){return(0,e.ai)(this.x,this.y,t.x,t.y)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.oi;return 0!==t&&(this.x/=t,this.y/=t),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},t.from=function(i,s){return new t(i.x-s.x,i.y-s.y)},t}();i.wt=n},600:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Dt=void 0;i.Dt=function(t,i,s){return Math.max(Math.min(s,t),i)}},92:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ui=i.ci=void 0;var e=s(159);i.ci=function(t,i,s,n,r,o){return(0,e.ai)(t,i,n,r)<=s+o};i.ui=function(t,i,s,e,n,r,o,h){return!(i+e<r||i>r+h||t+s<n||t>n+o)}},965:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.li=i.PI=i.$=void 0;var e=s(674);i.$=2*Math.PI,i.PI=Math.PI,i.li=new e.wt(0,0)},159:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.fi=i.ai=void 0;i.ai=function(t,s,e,n){return Math.pow((0,i.fi)(t,s,e,n),.5)};i.fi=function(t,i,s,e){return Math.pow(s-t,2)+Math.pow(e-i,2)}},908:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.tt=void 0;i.tt=function(t,i,s){return i*(1-t)+s*t}},250:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.di=void 0;i.di=function(t,i){return(t%i+i)%i}},482:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.normalize=void 0;var e=s(600);i.normalize=function(t,i,s,n){return void 0===n&&(n=!1),((n?(0,e.Dt)(t,i,s):t)-i)/(s-i)}},358:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.random=void 0,i.random=function(t,i){return void 0===t&&(t=1),void 0===i&&(i=0),Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:i+Math.random()*(t-i)}},557:function(t){var i;t.exports=(i=function(){function t(t){return n.appendChild(t.vi),t}function s(t){for(var i=0;i<n.children.length;i++)n.children[i].style.display=i===t?"block":"none";e=t}var e=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(t){t.preventDefault(),s(++e%n.children.length)}),!1);var r=(performance||Date).now(),o=r,h=0,a=t(new i.pi("FPS","#0ff","#002")),u=t(new i.pi("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new i.pi("MB","#f08","#201"));return s(0),{gi:16,vi:n,wi:t,Mi:s,mi:function(){r=(performance||Date).now()},end:function(){h++;var t=(performance||Date).now();if(u.update(t-r,200),t>o+1e3&&(a.update(1e3*h/(t-o),100),o=t,h=0,c)){var i=performance.memory;c.update(i.bi/1048576,i.yi/1048576)}return t},update:function(){r=this.end()},Si:n,_i:s}},i.pi=function(t,i,s){var e=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),h=80*o,a=48*o,u=3*o,c=2*o,l=3*o,f=15*o,d=74*o,v=30*o,p=document.createElement("canvas");p.width=h,p.height=a,p.style.cssText="width:80px;height:48px";var g=p.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=s,g.fillRect(0,0,h,a),g.fillStyle=i,g.fillText(t,u,c),g.fillRect(l,f,d,v),g.fillStyle=s,g.globalAlpha=.9,g.fillRect(l,f,d,v),{vi:p,update:function(a,w){e=Math.min(e,a),n=Math.max(n,a),g.fillStyle=s,g.globalAlpha=1,g.fillRect(0,0,h,f),g.fillStyle=i,g.fillText(r(a)+" "+t+" ("+r(e)+"-"+r(n)+")",u,c),g.drawImage(p,l+o,f,d-o,v,l,f,d-o,v),g.fillRect(l+d-o,f,o,v),g.fillStyle=s,g.globalAlpha=.9,g.fillRect(l+d-o,f,o,r((1-a/w)*v))}}},i)}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.n=t=>{var i=t&&t.t?()=>t.default:()=>t;return s.d(i,{a:i}),i},s.d=(t,i)=>{for(var e in i)s.Oi(i,e)&&!s.Oi(t,e)&&Object.defineProperty(t,e,{m:!0,get:i[e]})},s.Oi=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{"use strict";var t,i=s(839),e=s(557),n=s.n(e);!function(t){t.xi="gameplay",t.ji="intro",t.Ri="paused",t.ki="upgrade"}(t||(t={}));const r={move:{zi:!1,Ai:!1,left:!1,right:!1},timestamp:{Ci:0,Ni:-58e3},Pi:{Ei:0,level:0,next:0,Di:0},Wi:!1,Li:[],Ui:[],items:[],Bi:[],Ii:t.ji,Ti:3,Ki:0,Fi:1550},o=[[[58,15],[55,7],[48,4],[40,7],[37,15],[40,22],[48,26],[55,22],[58,15]],[[87,34],[85,30],[81,29],[14,29],[9,30],[8,34],[9,38],[14,40],[37,40],[37,88],[38,93],[43,95],[45,94],[49,90],[50,80],[52,80],[72,68],[72,62],[58,52],[58,40],[81,40],[85,38],[87,34]],[[50,68],[50,62],[54,65],[50,68]]],h=new i.wt(0,0),a=new i.wt(32,18),u=new i.wt(a.x/2-1,a.y/2-1),c=1/a.x,l="rgb(28,5,50)",f="rgba(0,0,0)",d="rgb(253,93,106)",v="rgb(254,184,18)",p="rgb(111,254,237)",g="rgb(248,96,248)",w="rgb(1,255,185)",M={Hi:document.querySelector("canvas#upgrades"),qi:document.querySelector("canvas#ui"),map:document.querySelector("canvas#map"),Ji:document.querySelector("canvas#gameplay")},m={Hi:M.Hi.getContext("2d"),qi:M.qi.getContext("2d"),map:M.map.getContext("2d"),Ji:M.Ji.getContext("2d")},b={strokeStyle:"white",fillStyle:"white",fontFamily:"Arial, sans-serif",textAlign:"center",textBaseline:"middle",lineWidth:t=>t.width(.00175),fontSize:t=>t.width(.1)},y={P:!0,D:"width",stroke:!0},S={map:new i.A({canvas:M.map,Pt:[0,a.x],Et:[0,a.y]}),upgrade:new i.A({canvas:M.Hi,padding:.1}),qi:new i.A({canvas:M.qi})},_={map:new i.O(m.map,{...y,coords:S.map,B:{...b,lineWidth:t=>t.width(.001)}}),Ji:new i.O(m.Ji,{...y,coords:S.map,B:{...b},L:.1}),upgrade:new i.O(m.Hi,{...y,coords:S.upgrade,B:{...b},L:.05}),qi:new i.O(m.qi,{...y,coords:S.qi,B:{...b}})},O=[0,100],x=[-1,1],j={Yi:{}};class R{constructor(t){this.Vi="",this.cache={},this.Xi=!1,this.Gi=4,this.Qi=0,this.position=t,this.Zi=t.clone()}get $i(){if("$i"in this.cache)return this.cache.$i;const t=this.position.clone().add(this.ts/2,this.ts/2);return this.cache.$i=t,t}get key(){if("key"in this.cache)return this.cache.key;const t=String(this.Vi)+String(this.ss)+JSON.stringify(this.options);return this.cache.key=t,t}es(t,s){const e=this.key;e in j.Yi&&j.Yi[e].length||(j.Yi[this.key]=((t,s,e,n,r)=>{const o=[];t.ut(t.options.B);for(let h=0;h<n;h++){const n=document.createElement("canvas");n.width=e,n.height=e;const h=n.getContext("2d");s(new i.O(h,{...t.options,B:{...t.options.B,lineWidth:t.context.lineWidth},coords:new i.A({canvas:n,Pt:r,Et:r})})),o.push(n)}return o})(_.Ji,this.ns,_.Ji.coords.width(c*this.ts),this.Gi,this.rs));const n=j.Yi[e][this.Qi];_.Ji.drawImage(n,(0,i.tt)(t,this.Zi.x,this.position.x),(0,i.tt)(t,this.Zi.y,this.position.y),s)}update(t,i,s){this.Zi.set(this.position),this.$i.x=this.position.x+this.ts/2,this.$i.y=this.position.y+this.ts/2,this.Qi=Math.floor(t/r.Fi%1*this.Gi)}}const k=new class extends R{constructor(t){super(t),this.ss=.75,this.ts=1.5,this.Vi=0,this.speed=.005,this.rs=O,this.os="right",this.hs={B:{scale:{origin:this.$i,scale:new i.wt(-1,1)}}},this.options={B:{fillStyle:g},fill:!0},this.ns=t=>{o.forEach((i=>{t.Y(i,this.options)}))},this.update=(t,i)=>{super.update(t,i),this.us(t,i)},this.us=(t,s)=>{const e=s*this.speed,n=.7071*e;let o=0,h=0;r.move.left&&r.move.zi?(o=-n,h=-n):r.move.left&&r.move.Ai?(o=-n,h=n):r.move.right&&r.move.zi?(o=n,h=-n):r.move.right&&r.move.Ai?(o=n,h=n):r.move.zi?h=-e:r.move.Ai?h=e:r.move.left?o=-e:r.move.right&&(o=e),this.position.x=(0,i.Dt)(this.position.x+o,0,a.x-1),this.position.y=(0,i.Dt)(this.position.y+h,0,a.y-1)}}es(t){super.es(t,"left"===this.os?this.hs:void 0)}}(u.clone()),z={6:{cs:[10,11,12.5,15,18,21.5,26.5],range:[1.5,1.55,1.65,1.8,2,2.25,2.55],ls:[1,2,3,4,5,6,7]},7:{fs:[.07,.09,.11,.15,.2,.25,.34],ds:[1.5,1.55,1.65,1.85,2.15,2.65,3.15]},8:{cs:[6,6.5,7.5,9,11,13.5,17],frequency:[1,1.5,2,3,4,6,8]},9:{cs:[3,4,6,9,13,18,24],ds:[1.5,1.7,2,2.4,2.9,3.5,4.2]},10:{cs:[16,18,21,25,30,36,43],frequency:[.5,.6,.7,.9,1.1,1.4,1.7]}};class A extends R{constructor(t,s=k.$i.clone()){super(s),this.size=.25,this.vs=!1,this.ps=(t,s,e)=>{for(let n=0;n<r.Li.length;n++){const o=r.Li[n];(0,i.ci)(this.$i.x,this.$i.y,this.ss,o.$i.x,o.$i.y,o.ss)&&(o.cs(t,s,e,this.Vi),this.vs&&(this.Xi=!0))}},this.parent=t}update(t,i,s){super.update(t,i),this.us(t,i,s),this.ps(this.parent.cs,s,t)}}class C extends A{constructor(t,s){super(t,k.position.clone()),this.rs=x,this.ts=1,this.ss=.05,this.Vi=8,this.options=void 0,this.vs=!0,this.ns=t=>{t.Y([[-1,0],[1,0]]),t.Y([[-.75,-.4],[-1,0],[-.75,.4]])},this.us=(t,i)=>{this.Zi.set(this.position),this.position.x+=this.gs.x*this.parent.speed,this.position.y+=this.gs.y*this.parent.speed},this.gs=i.wt.from(s,this.$i).normalize(),this.ws=this.gs.angle()+i.PI,this.Ms={B:{rotation:{origin:this.$i,rotation:this.ws}}}}es(t){super.es(t,this.Ms)}}class N extends class{constructor(){this.bs=[],r.Ui.push(this)}ys(){return this.level<7}es(t){for(let i=0;i<this.bs.length;i++)this.bs[i].es(t)}update(t,i){for(let s=0;s<this.bs.length;s++)this.bs[s].Xi?this.bs.splice(s,1):this.bs[s].update(t,i,s)}}{constructor(){super(),this.level=1,this.range=5,this.speed=.1,this.Ss=0,this.upgrade=()=>{this.ys()&&this.level++}}get _s(){return z[8]}get frequency(){return 1e3/this._s.frequency[this.level-1]}get cs(){return this._s.cs[this.level-1]}update(t,i){if(super.update(t,i),t-this.Ss>this.frequency){this.Ss=t;const i=this.Os();i&&this.bs.push(new C(this,i.$i))}for(let s=0;s<this.bs.length;s++){const e=this.bs[s];e.update(t,i,s),e.$i.hi(k.$i)>this.range&&(e.Xi=!0)}}Os(){let t,i=1/0;for(let s=0;s<r.Li.length;s++){const e=k.$i.hi(r.Li[s].$i);e<i&&(i=e,t=r.Li[s])}return t}}const P={xs:[],js:[],Rs:[],ks:[],zs:[],As:[],Cs:[],Ns:[]};let E=0;const D=(t,i)=>(P[t].push({id:E,Ps:i}),E++,E-1),W=(t,...i)=>{const s=P[t];for(let t=0;t<s.length;t++)s[t].Ps(...i)};new ResizeObserver((()=>{W("CanvasResize")})).observe(M.map),window.addEventListener("keydown",(t=>{W("KeyDown",t.key)})),window.addEventListener("keyup",(t=>{W("KeyUp",t.key)})),window.addEventListener("resize",(t=>{W("WindowResize")}));const L=()=>{r.Pi.Di=r.Pi.Ei,r.Pi.level++,r.Pi.next=50*r.Pi.level,W("StateChange",t.ki)},U=()=>{_.upgrade.clear();for(let t=0;t<r.Ti;t++){const s=new i.A({offsetX:_.upgrade.coords.St(-1)+_.upgrade.coords.width(t/r.Ti),offsetY:_.upgrade.coords._t(-1),Ct:_.upgrade.coords.width()/r.Ti,Nt:_.upgrade.coords.height(),padding:.05}),e=new i.O(_.upgrade.context,{..._.upgrade.options,coords:s,stroke:!1});e.rect(-1,-1,1,e.coords.height()/e.coords.width(),{stroke:r.Ki===t,fill:!0,B:{fillStyle:"rgba(255,255,255,.5)"}}),e.text("TEST",0,-.8,{B:{textBaseline:"top"}})}},B=()=>{const t=(r.Pi.Ei-r.Pi.Di)/(r.Pi.next-r.Pi.Di);console.log("drawing",t),_.qi.rect(-1,-1,1,1,{fill:!1,L:0,stroke:!0}),_.qi.rect(-1,-1,t,1,{fill:!0,L:0,B:{fillStyle:w}})},I=[[[22,38],[35,87],[37,89],[44,92],[55,92],[60,89],[64,84],[76,38],[74,35],[59,22],[49,20],[38,22],[29,29],[22,38]],[[31,52],[45,55],[40,61],[35,59],[31,52]],[[58,61],[56,60],[54,55],[67,52],[62,59],[58,61]],[[58,25],[59,17],[63,12],[68,8],[76,7],[83,8],[88,12],[92,17],[94,25],[93,29],[89,38]],[[74,35],[89,52],[86,54],[83,55],[79,55],[75,51],[72,40],[74,35]],[[40,25],[38,17],[34,12],[29,8],[22,7],[15,8],[10,12],[6,17],[5,29],[9,38]],[[25,35],[9,52],[11,54],[14,55],[19,55],[22,51],[25,40],[25,35]]];class T extends R{constructor(t,i){super(t),this.Es=t=>{this.Xi=!0},this.Ds=i}update(t,i,s){super.update(t,i),this.us(t,i,s)}us(t,s,e){this.Ds.Ws&&((t,s,e,n)=>{const r=i.wt.from(k.position,t);if(!e.start&&r.oi<e.ai)e.start=s;else if(e.start&&r.oi<.5)e.Ls(n);else if(e.start){const i=s-e.start;r.normalize();const n=r.clone().multiply(.0015*i-.25);t.x+=n.x,t.y+=n.y}})(this.position,t,this.Ds.Ws,e)}}class K extends T{constructor(t,i){let s;super(t,{Ws:{ai:3,Us:t.clone(),Ls:t=>{r.Pi.Ei+=i,B(),this.Es(t)}}}),this.rs=x,this.ts=1,this.ss=.25,this.Vi=11,this.ns=t=>{t.ot(0,0,this.ss,5,.4,this.options)},this.Pi=i,s=this.Pi<20?0:this.Pi<50?1:2,this.options={B:K.B[s],fill:!0}}}K.B={0:{fillStyle:v,strokeStyle:v},1:{fillStyle:p,strokeStyle:p},2:{fillStyle:g,strokeStyle:g}};const F=(0,s(257).i)({o:.5,u:1,h:.2,l:2});class H extends R{constructor(t,s,e){super(H.Bs(t.$i.clone(),t)),this.ss=.5,this.ts=1,this.duration=500,this.Is={B:{scale:{origin:h,scale:new i.wt(1,1)}}},this.options=void 0,this.rs=x,this.es=t=>{super.es(t,this.Is)},this.ns=t=>{t.text(this.text,0,0,{fill:!0,B:{fontSize:t=>t.width(.35),textBaseline:"top"},L:.3})},this.target=t,this.Vi=s,this.text=s,this.start=e}static Bs(t,i){return t.x=i.$i.x-.5,t.y=i.$i.y-1.5,t}update(t,i){super.update(t,0,i);const s=F((t-this.start)/this.duration);this.Is.B.scale.origin=this.$i,this.Is.B.scale.scale.x=s,this.Is.B.scale.scale.y=s,H.Bs(this.position,this.target),t-this.start>=this.duration&&(this.Xi=!0)}}class q extends R{constructor(t,i,s){super(t),this.speed=.00175,this.Ts=1e3,this.Ks={},this.options={B:{fillStyle:f},fill:!0},this.Ds=i,this.Fs=s,this.Hs=s}qs(t){_.Ji.text(String(t),this.$i.x,this.$i.y-this.ts/2)}cs(t,i,s,e){const n=this.Ks[e];n&&s-n<this.Ts||(this.Fs-=t,r.Bi.push(new H(this,String(t),s)),this.Fs<=0&&this.Es(),this.Ks[e]=s)}Es(){const t=new K(this.$i.clone(),this.Hs);t.position.add(-t.ts/2,-t.ts/2),r.items.push(t),this.Xi=!0}update(t,i){super.update(t,i),this.us(t,i)}us(t,s){this.Ds.Js&&((t,s,e)=>{const n=i.wt.from(k.position,t).normalize().multiply(s*e.Ys);t.x+=n.x,t.y+=n.y})(this.position,s,this.Ds.Js),this.Ds.Vs&&((t,s,e)=>{const n=i.wt.from(k.position,t);if(n.oi<e.ai){const i=n.normalize().multiply(s*e.Js);t.x+=i.x,t.y+=i.y}else{if(t.equals(e.Xs))return;if(t.hi(e.Xs)<.1)t.set(e.Xs);else{const n=i.wt.from(e.Xs,t).normalize().multiply(s*e.Js);t.x+=n.x,t.y+=n.y}}})(this.position,s,this.Ds.Vs)}}class J extends q{constructor(t,i){super(t,{Vs:{Js:.002,ai:3,Xs:t.clone()}},i),this.rs=O,this.ts=1,this.Vi=1,this.ss=.5,this.ns=t=>{I.forEach((i=>t.Y(i,this.options)))}}}const Y=[[[87,35],[83,21],[80,15],[70,6],[57,1],[43,1],[30,6],[20,15],[15,28],[14,35],[9,39],[7,47],[9,54],[14,59],[18,72],[26,84],[37,92],[44,95],[57,95],[63,92],[74,84],[82,72],[87,59],[94,50],[95,47],[92,39],[87,35]],[[87,45],[76,44],[76,35],[80,34],[80,41],[83,41],[87,45]],[[78,63],[76,68],[76,65],[78,63]],[[63,74],[63,63],[71,63],[73,65],[73,74],[63,74]],[[45,74],[43,73],[43,65],[45,63],[57,63],[57,74],[45,74]],[[29,74],[30,63],[38,63],[40,65],[40,73],[29,74]],[[24,63],[25,68],[24,63]],[[22,30],[25,24],[25,29],[22,30]],[[57,19],[57,30],[43,29],[43,21],[45,19],[57,19]],[[78,30],[76,29],[76,24],[78,30]],[[73,58],[71,60],[63,60],[62,56],[58,54],[57,60],[45,60],[43,58],[43,54],[40,56],[38,60],[30,60],[29,35],[38,34],[40,35],[40,38],[43,40],[43,35],[45,34],[57,34],[58,40],[62,38],[63,34],[73,35],[73,58]],[[29,29],[29,19],[38,19],[40,21],[40,29],[29,29]],[[73,19],[73,29],[63,30],[63,19],[73,19]],[[63,16],[62,11],[70,16],[63,16]],[[40,14],[38,16],[31,16],[40,11],[40,14]],[[58,9],[57,16],[45,16],[43,14],[43,9],[58,9]],[[18,41],[21,41],[21,35],[24,34],[25,44],[14,45],[18,41]],[[18,52],[14,49],[25,50],[24,60],[22,60],[21,53],[18,52]],[[31,78],[40,79],[40,86],[31,78]],[[43,88],[43,79],[58,79],[58,88],[43,88]],[[62,86],[63,78],[71,78],[62,86]],[[83,52],[80,53],[78,60],[76,58],[76,50],[87,49],[83,52]],[[38,41],[33,42],[32,47],[33,50],[38,52],[41,50],[43,47],[41,42],[38,41]],[[63,41],[59,42],[58,47],[59,50],[63,52],[67,50],[69,47],[67,42],[63,41]]];const V=[[[37,36],[46,37],[53,42],[57,48],[60,58],[59,66],[56,69],[49,74],[46,84],[37,87],[31,86],[28,84],[26,74],[17,69],[14,62],[17,48],[21,42],[28,37],[37,36]],[[63,95],[68,71],[69,59],[67,45],[64,35],[58,28],[47,21],[37,19],[27,21],[15,28],[10,35],[7,45],[6,59],[6,71],[12,95]],[[14,61],[15,79],[21,95]],[[61,61],[59,79],[54,95]],[[77,21],[45,10],[29,9],[20,9],[12,13],[17,8],[25,4],[44,2],[71,6],[92,13],[77,21]],[[94,9],[82,95]],[[42,51],[39,53],[40,59],[43,63],[46,63],[51,60],[53,55],[53,51],[47,48],[42,51]],[[37,63],[34,66],[33,71],[41,71],[40,66],[37,63]],[[33,51],[30,49],[24,49],[22,51],[20,55],[24,60],[30,63],[34,59],[35,56],[33,51]]];const X=[[[95,56],[75,43],[51,35],[43,53],[40,65],[40,82],[44,91],[49,95],[54,96],[65,94],[72,90],[86,74],[96,59],[95,56]],[[53,85],[49,80],[47,68],[56,79],[71,80],[59,85],[53,85]],[[73,71],[67,65],[76,65],[81,72],[73,71]],[[54,62],[49,55],[57,56],[63,62],[54,62]],[[39,47],[33,49],[27,56],[31,45],[36,42],[42,42],[44,36],[48,29],[52,29],[57,31],[55,20],[49,2],[24,7],[2,19],[11,42],[23,57],[35,63],[39,47]],[[43,22],[51,25],[43,29],[35,25],[43,22]],[[25,36],[16,38],[20,31],[29,29],[25,36]]];const G=[[[58,46],[68,43],[75,40],[74,43],[70,50],[63,50],[60,49],[58,46]],[[49,3],[35,6],[24,14],[16,26],[14,40],[16,62],[23,78],[34,88],[49,94],[62,89],[73,79],[81,63],[84,40],[81,26],[73,14],[62,6],[49,3]],[[46,48],[45,59],[37,54],[34,57],[31,63],[32,73],[43,84],[35,81],[26,74],[21,63],[19,50],[19,34],[22,24],[29,14],[41,7],[32,17],[31,32],[33,37],[39,41],[42,38],[43,31],[46,43],[43,45],[46,48]],[[56,85],[64,76],[68,68],[66,59],[61,54],[58,55],[54,59],[53,48],[56,46],[53,44],[54,33],[56,31],[58,40],[62,40],[65,37],[68,28],[66,18],[58,7],[69,14],[76,24],[79,34],[79,50],[77,63],[75,70],[69,77],[62,82],[56,85]],[[41,46],[30,43],[23,40],[23,43],[27,50],[35,50],[38,49],[41,46]]];class Q extends R{constructor(t,s){super(t),this.Xi=!1,this.Vi=12,this.ss=1.5,this.ts=3,this.duration=2500,this.Gs=r.Fi/2,this.options=void 0,this.rs=x,this.ns=t=>{t.rect(-.2,-.8,.2,.8,{B:{rotation:{origin:h,rotation:i.PI/4},fillStyle:d},fill:!0,stroke:!1}),t.rect(-.2,-.8,.2,.8,{B:{rotation:{origin:h,rotation:-i.PI/4},fillStyle:d},fill:!0,stroke:!1})},this.start=s}update(t,i){super.update(t,0,i),t-this.start>Q.duration&&(this.Xi=!0)}}Q.duration=2500;const Z=[0,1,2,3],$=[class extends q{constructor(t,i){super(t,{Js:{Ys:.002}},i),this.rs=O,this.ts=1,this.Vi=3,this.ss=.5,this.ns=t=>{G.forEach((i=>t.Y(i,this.options)))}}},class extends q{constructor(t,i){super(t,{Js:{Ys:.002}},i),this.rs=O,this.ts=2,this.Vi=2,this.ss=1,this.ns=t=>{X.forEach((i=>t.Y(i,this.options)))}}},class extends q{constructor(t,i){super(t,{Js:{Ys:.002}},i),this.rs=O,this.ts=1,this.Vi=4,this.ss=.5,this.speed=.002,this.ns=t=>{Y.forEach((i=>t.Y(i,this.options)))}}},class extends q{constructor(t,i){super(t,{Js:{Ys:.002}},i),this.rs=O,this.ts=1,this.Vi=5,this.ss=.5,this.ns=t=>{V.forEach((i=>t.Y(i,this.options)))}}}],tt=t=>{const s=(t-r.timestamp.Ni-6e4)/Q.duration;if(s<1&&!r.Wi){const s=(0,i.random)(.8*a.x,.1),e=(0,i.random)(.8*a.y,.1),n=new Q(new i.wt(s,e),t);r.Wi=n,r.Bi.push(n)}else if(s>1&&r.Wi){const s=Math.floor((0,i.random)(16,12));for(let t=0;t<s;t++){const e=r.Wi.$i.x+1.5*Math.cos(i.$*t/s),n=r.Wi.$i.y+1.5*Math.sin(i.$*t/s);r.Li.push(new J(new i.wt(e,n),5))}r.timestamp.Ni=t,r.Wi=!1}};let it;const st=new(n()),et=st.wi(new(n().pi)("phys","#0ff","#002"));st.vi.id="stats",document.body.appendChild(st.vi);const nt=1e3/60;let rt=0,ot=0,ht=0;const at=(i=0)=>{st.mi();const s=r.Ii!==t.xi?0:i-ot;for(ot=i,ht+=Math.min(s,50);ht>=nt;)ut(),ht-=nt,rt+=nt;ct(ht/nt),st.end(),window.requestAnimationFrame(at)},ut=()=>{et.update(59.99999999999999,200),k.update(rt,nt);for(let t=r.Ui.length-1;t>=0;t--)r.Ui[t].update(rt,nt);for(let t=r.Li.length-1;t>=0;t--)r.Li[t].Xi?r.Li.splice(t,1):r.Li[t].update(rt,nt);for(let t=r.items.length-1;t>=0;t--)r.items[t].Xi?r.items.splice(t,1):r.items[t].update(rt,nt,t);for(let t=r.Bi.length-1;t>=0;t--)r.Bi[t].Xi?r.Bi.splice(t,1):r.Bi[t].update(rt,t);(t=>{const s=1e3*(9e5-Math.max(0,t)/1e3)/1e6;if(t-r.timestamp.Ci>=s){r.timestamp.Ci=t;const s=(0,i.random)($),e=(0,i.random)(Z);let n,o;0===e&&(n=(0,i.random)(a.x),o=0),1===e&&(n=(0,i.random)(a.x),o=a.y),2===e&&(n=0,o=(0,i.random)(a.y)),3===e&&(n=0,o=(0,i.random)(a.y)),r.Li.push(new s(new i.wt(n,o),5))}t-r.timestamp.Ni>=6e4&&tt(t)})(rt)},ct=t=>{_.Ji.clear();for(let i=0;i<r.Li.length;i++)r.Li[i].es(t);for(let i=0;i<r.Ui.length;i++)r.Ui[i].es(t);for(let i=0;i<r.items.length;i++)r.items[i].es(t);for(let i=0;i<r.Bi.length;i++)r.Bi[i].es(t);k.es(t)};(0,i.Zt)(M.map,a),(0,i.Zt)(M.Ji,a),(0,i.Zt)(M.Hi,a),D("KeyDown",(s=>{"Enter"===s&&r.Ui.forEach((t=>t.upgrade())),"Shift"===s&&(console.log(s),r.Pi.Ei=r.Pi.next,W("LevelUp")),"Escape"===s&&r.Ii===t.xi&&W("StateChange",t.Ri),"ArrowLeft"!==s&&"a"!==s||(r.Ii===t.xi&&(r.move.left=!0,k.os="left"),r.Ii===t.ki&&(r.Ki=(0,i.di)(r.Ki-1,r.Ti),U())),"ArrowRight"!==s&&"d"!==s||(r.Ii===t.xi&&(r.move.right=!0,k.os="right"),r.Ii===t.ki&&(r.Ki=(0,i.di)(r.Ki+1,r.Ti),U())),"ArrowUp"!==s&&"w"!==s||(r.move.zi=!0),"ArrowDown"!==s&&"s"!==s||(r.move.Ai=!0)})),D("KeyUp",(i=>{"ArrowLeft"!==i&&"a"!==i||(r.move.left=!1),"ArrowRight"!==i&&"d"!==i||(r.move.right=!1),"ArrowUp"!==i&&"w"!==i||(r.move.zi=!1),"ArrowDown"!==i&&"s"!==i||(r.move.Ai=!1),"Enter"===i&&r.Ii===t.Ri&&W("StateChange",t.xi)})),D("CanvasResize",(()=>{(()=>{for(let t=0;t<a.x;t++)for(let i=0;i<a.y;i++)_.map.rect(t,i,1/a.x,1/a.y,{B:{strokeStyle:"rgba(255,255,255,0.1)"}})})();const s=M.map.getBoundingClientRect();M.qi.style.height=String(.05*s.height),M.qi.style.left=String(s.left),M.qi.style.top=String(s.top-M.qi.clientHeight),M.qi.style.width=String(s.width),M.qi.width=M.qi.clientWidth*i.yt,M.qi.height=M.qi.clientHeight*i.yt,B();for(const t in j.Yi)j.Yi[t].length=0;r.Ii===t.ki&&U()})),D("WindowResize",(()=>{const t=M.map.getBoundingClientRect();M.qi.style.height=String(.05*t.height),M.qi.style.left=String(t.left),M.qi.style.top=String(t.top-M.qi.clientHeight),M.qi.style.width=String(t.width)})),D("StateChange",(i=>{if(console.log("state change",i),i===t.ki)r.Ki=0,U(),it=D("CanvasResize",U);i!==t.ki&&(t=>{let i;for(i in P)for(let s=P[i].length-1;s>=0;s--)P[i][s].id===t&&P[i].splice(s,1)})(it),r.Ii=i})),D("LevelUp",L),D("Initialize",(()=>{document.body.style.backgroundColor=l,M.map.style.zIndex="-1",L(),new N})),W("Initialize"),W("StateChange",t.xi),window.requestAnimationFrame(at)})()})();</script></body></html>