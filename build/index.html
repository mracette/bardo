<html><head><link href="main.css" rel="stylesheet"></head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>Bardo</title><body class="full"><div id="root"><canvas id="ui"></canvas><canvas id="map"></canvas><canvas id="gameplay"></canvas></div><script>(()=>{var t={705:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.i=void 0;i.i=function(t){var i=void 0===t?{}:t,s=i.o,e=void 0===s?0:s,n=i.h,r=void 0===n?-1:n,o=i.u,h=void 0===o?1:o,a=i.l,u=void 0===a?1:a,c=i.v,l=void 0===c?0:c,f=i.p,d=void 0===f?0:f,v=i.M,p=void 0!==v&&v;if(e<r||e>h)throw new Error("yStart must be between yMin and yMax");var w=2*Math.PI,M=(r+h)/2,g=(h-r)/2,b=p?-1:1,m=Math.asin(2*(e-r)/(h-r)-1)*(u/w);return function(t){return M+g*Math.sin(b*(w*(t-l+m))/u)+d}}},257:function(t,i,s){"use strict";var e=this&&this.g||(Object.create?function(t,i,s,e){void 0===e&&(e=s),Object.defineProperty(t,e,{m:!0,get:function(){return i[s]}})}:function(t,i,s,e){void 0===e&&(e=s),t[e]=i[s]}),n=this&&this._||function(t,i){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(i,s)||e(i,t,s)};Object.defineProperty(i,"t",{value:!0}),n(s(705),i)},712:function(t,i,s){"use strict";var e=this&&this.O||function(){return e=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t},e.apply(this,arguments)};Object.defineProperty(i,"t",{value:!0}),i.j=i.S=void 0;var n=s(839),r=s(603);!function(t){t.A="width",t.k="height"}(i.S||(i.S={}));var o=function(){function t(t,i){var s;void 0===i&&(i={}),this.context=t,this.coords=null!==(s=i.coords)&&void 0!==s?s:new n.R({canvas:t.canvas});var r={beginPath:!0,closePath:!1,fill:!1,N:void 0,P:!0,stroke:!1,C:!1,D:!1,W:!1};this.options=e(e({},r),i),this.options.T=e(e({},{fontFamily:"sans-serif",fontSize:16}),i.T)}return t.prototype.rect=function(t,i,s,e,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===e&&(e=1),void 0===n&&(n={}),this.B(n),this.context.rect(this.F(t,n),this.I(i,n),this.L(s,n),this.L(e,n)),this.H(n)},t.prototype.q=function(t,i){void 0===i&&(i={}),this.B(i);for(var s=0;s<t.length;s++){var e=this.F(t[s][0],i),n=this.I(t[s][1],i);0===s?this.context.moveTo(e,n):this.context.lineTo(e,n)}this.H(i)},t.prototype.U=function(t,i){var s=this;void 0===i&&(i={}),this.B(i);for(var e=0;e<t.length-1;e++){var n=this.F(t[e][0],i),r=this.I(t[e][1],i);if(0===e)this.context.moveTo(n,r);else{var o=this.F(t[e+1][0],i),h=this.I(t[e+1][1],i);if(o===n&&h===r)this.context.lineTo(o,h);else{var a=(n+o)/2,u=(r+h)/2;this.context.quadraticCurveTo(n,r,a,u)}}}t.slice(-1).forEach((function(t){s.context.lineTo(s.F(t[0],i),s.I(t[1],i))})),this.H(i)},t.prototype.J=function(t,i,s,e){void 0===e&&(e={}),this.B(e),this.context.arc(this.F(t,e),this.I(i,e),this.L(s,e),0,n.K),this.H(e)},t.prototype.drawImage=function(t,i,s,e){void 0===e&&(e={}),this.B(e),this.context.drawImage(t,this.F(i,e),this.I(s,e)),this.H(e)},t.prototype.Y=function(t,i,s,r,o,h){void 0===h&&(h={}),this.q((0,n.Y)(this.F(t,h),this.I(i,h),this.L(s,h),r,o),e(e({},h),{C:!1,P:!0}))},t.prototype.V=function(t,i,s,r,o){void 0===o&&(o={}),this.q((0,n.V)(this.F(t,o),this.I(i,o),this.L(s,o),r),e(e({},o),{C:!1,P:!0}))},t.prototype.X=function(t){this.G(e(e({},this.options.T),t))},t.prototype.text=function(t,i,s,e){void 0===e&&(e={}),this.B(e),this.context.fillText(t,this.F(i,e),this.I(s,e),this.Z("maxTextWidth",e)),this.H(e)},t.prototype.clear=function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.$=function(t,i){void 0===i&&(i={}),t.width=t.clientWidth*(i.tt?r.it:1),t.height=t.clientHeight*(i.tt?r.it:1)},t.prototype.F=function(t,i){return void 0===i&&(i={}),this.Z("useNormalCoordinates",i)?this.coords.st(t):t},t.prototype.I=function(t,i){return void 0===i&&(i={}),this.Z("useNormalCoordinates",i)?this.coords.et(t):t},t.prototype.L=function(t,i){void 0===i&&(i={});var s=this.Z("scalarNormalization",i);return"width"===s?this.coords.width(t):"height"===s?this.coords.height(t):t},t.prototype.Z=function(t,i){return i&&t in i?i[t]:this.options[t]},t.prototype.nt=function(t,i){var s=i&&t in i?i[t]:this.options.T[t];return"function"==typeof s?s(this.coords):s},t.prototype.rt=function(t){var i=this.nt("fontSize",t),s=this.nt("lineHeight",t),e=this.nt("fontStyle",t),n=this.nt("fontFamily",t),r=this.nt("fontWeight",t),o=this.nt("fontStretch",t),h="number"==typeof i?"".concat(i,"px"):void 0;return s&&h&&(h="".concat(i," / ").concat(s,"}")),[h,n,e,r,o].join(" ").trim()},t.prototype.G=function(t){for(var i in t){var s=this.nt(i,t);if(!(0,n.ot)(s)){if("transform"===i&&this.context.setTransform(s),"translation"===i){var e=s,r=e.x,o=e.y;this.context.translate(this.F(r),this.I(o))}if("rotation"===i)if("number"==typeof s)this.context.rotate(s);else{var h=s,a=h.rotation,u=h.origin,c=this.F(u.x),l=this.I(u.y);this.context.translate(c,l),this.context.rotate(a),this.context.translate(-c,-l)}if("scale"===i)if("origin"in s){var f=s,d=f.origin,v=f.scale,p=f.ht,w=void 0!==p&&p;c=this.F(d.x),l=this.I(d.y);this.context.translate(c,l),this.context.scale(v.x,v.y),this.context.translate(-c,-l),w&&(this.context.lineWidth=this.context.lineWidth*(1/((v.x+v.y)/2)))}else{var M=s;r=M.x,o=M.y;this.context.scale(r,o)}"lineDash"===i&&this.context.setLineDash(s),"alpha"===i&&(this.context.globalAlpha=s),i in this.context&&"function"!=typeof this.context[i]&&(this.context[i]=this.nt(i,t))}}this.context.font=this.rt(t)},t.prototype.B=function(t){void 0===t&&(t={}),this.Z("saveAndRestore",t)&&this.context.save(),this.Z("skipApplyStyles",t)||this.X(t.T),this.Z("beginPath",t)&&this.context.beginPath()},t.prototype.H=function(t){this.Z("closePath",t)&&this.context.closePath(),this.Z("fill",t)&&this.context.fill(),this.Z("stroke",t)&&this.context.stroke(),this.Z("saveAndRestore",t)&&this.context.restore()},t}();i.j=o},367:function(t,i,s){"use strict";var e,n=this&&this.ut||(e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},e(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}),r=this&&this.O||function(){return r=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t},r.apply(this,arguments)};Object.defineProperty(i,"t",{value:!0}),i.ct=void 0;var o=s(839),h=s(358),a=function(t){function i(i,s){var e=t.call(this,i,s)||this;return e.options=r(r({},{lt:.025,ft:!1}),e.options),e}return n(i,t),i.prototype.q=function(t,i){void 0===i&&(i={});for(var s=t.length-1,e=0;e<2;e++){for(var n=[],h=0;h<s;h++){var a=t[h],u=a[0],c=a[1],l=t[h+1],f=l[0],d=l[1],v=Math.sqrt(Math.pow(u-f,2)+Math.pow(c-d,2)),p=this.options.lt*v;if(i.ft&&h===s-1){n.push(n[0]);break}for(var w=0;w<4;w++){var M=Math.random()*p,g=Math.random()*o.K,b=M*Math.cos(g),m=M*Math.sin(g),y=NaN,_=NaN;if(0===w&&(y=u+b,_=c+m),1===w){y=(0,o.dt)(.5,u,f)+b,_=(0,o.dt)(.5,c,d)+m}if(2===w){y=(0,o.dt)(.75,u,f)+b,_=(0,o.dt)(.75,c,d)+m}3===w&&(y=f+b,_=d+m),n.push([y,_])}}var O=0===e?i:r(r({},i),{fill:!1});this.U(n,O)}},i.prototype.J=function(t,i,s,e){void 0===e&&(e={});for(var n=this.options.lt*this.L(s,e)/window.innerWidth,h=0;h<2;h++){for(var a=[],u=0;u<16;u++){var c=Math.random()*n,l=Math.random()*o.K,f=c*Math.cos(l),d=c*Math.sin(l),v=o.K*u/16,p=this.F(t+f,e)+Math.cos(v)*this.L(s,e),w=this.I(i+d,e)+Math.sin(v)*this.L(s,e);a.push([p,w])}a[16]=a[0],a[17]=a[1],this.U(a,r(r({},e),{C:!1,P:!0,ft:!0}))}},i.prototype.rect=function(t,i,s,e,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===e&&(e=1),void 0===n&&(n={});var o=this.F(t),h=this.I(i),a=this.L(s),u=this.L(e),c=[[o,h],[o+a,h],[o+a,h+u],[o,h+u],[o,h]];this.q(c,r(r({},n),{C:!1,P:!0,ft:!0}))},i.prototype.vt=function(t,i){this.context.save(),this.X(i);var s=this.context.measureText(t);return this.context.restore(),s},i.prototype.text=function(i,s,e,n){var a=this;void 0===n&&(n={});var u=this.vt(i,n.T),c=u.actualBoundingBoxAscent,l=u.actualBoundingBoxDescent,f=u.width,d=i.split(""),v=c-l,p=this.coords.wt(v),w=f/d.length,M=this.coords.Mt(w)-this.coords.Mt(0),g=M*d.length;this.X(n.T),d.forEach((function(i,u){var c,l;if("left"===a.context.textAlign)l=(c=s+M*u)+M/2;else if("right"===a.context.textAlign)l=(c=-g+s+M*(u+1))-M/2;else{if("center"!==a.context.textAlign)throw new Error("textAlign must be 'left', 'right', or 'center' to use rough text");l=c=-g/2+s+M*(.5+u)}var d,v=e;if("top"===a.context.textBaseline)d=v-p/2;else if("bottom"===a.context.textBaseline)d=v-p/2;else{if("middle"!==a.context.textBaseline)throw new Error("textBaseline must be 'top', 'bottom', or 'middle' to use rough text");d=v}var w=(a.Z("roughness",n)||0)*f*.05,b=[(0,h.random)(Math.min(.4,w/6.5))*M,(0,h.random)(Math.min(.4,w/6.5))*M],m=[(0,h.random)(Math.min(.4,w/6.5))*p,(0,h.random)(Math.min(.4,w/6.5))*p];t.prototype.text.call(a,i,c+b[0],v+m[0],r(r({},n),{T:r(r({},n.T),{rotation:{origin:new o.gt(l,d),rotation:w*Math.PI/16}})})),t.prototype.text.call(a,i,c+b[1],v+m[1],r(r({},n),{T:r(r({},n.T),{rotation:{origin:new o.gt(l,d),rotation:-w*Math.PI/16}})}))}))},i}(o.j);i.ct=a},659:function(t,i,s){"use strict";var e=this&&this.O||function(){return e=Object.assign||function(t){for(var i,s=1,e=arguments.length;s<e;s++)for(var n in i=arguments[s])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t},e.apply(this,arguments)};Object.defineProperty(i,"t",{value:!0}),i.R=void 0;var n,r=s(654),o=s(796),h=s(908),a=s(482);!function(t){t.bt="up",t.yt="down"}(n||(n={}));var u=function(){function t(t){if(void 0===t&&(t={}),(0,o.ot)(t.canvas)&&(0,r._t)(t.Ot,t.jt))throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");Object.assign(this,e(e({},{xt:[-1,1],St:[-1,1],At:!1,orientationY:"down",kt:!1}),t))}return t.prototype.Rt=function(){var t;return null!==(t=this.Ot)&&void 0!==t?t:this.canvas.width},t.prototype.Nt=function(){return this.Rt()-2*this.zt()},t.prototype.Pt=function(){var t;return null!==(t=this.jt)&&void 0!==t?t:this.canvas.height},t.prototype.Ct=function(){return this.Pt()-2*this.Et()},t.prototype.Dt=function(){var t,i;return null!==(i=null!==(t=this.Wt)&&void 0!==t?t:this.padding)&&void 0!==i?i:0},t.prototype.zt=function(){return this.Dt()*this.Rt()},t.prototype.Tt=function(){return(0,o.ot)(this.Bt)?(0,o.ot)(this.padding)?0:this.kt?this.padding*(this.Rt()/this.Pt()):this.padding:this.Bt},t.prototype.Et=function(){return this.Tt()*this.Pt()},t.prototype.Ft=function(){var t;return null!==(t=this.offsetX)&&void 0!==t?t:0},t.prototype.It=function(){var t;return null!==(t=this.offsetY)&&void 0!==t?t:0},t.prototype.st=function(t){var i=(0,a.normalize)(t,this.xt[0],this.xt[1],this.At);return this.zt()+this.Ft()+i*this.Nt()},t.prototype.et=function(t){var i=(0,a.normalize)(t,this.St[0],this.St[1],this.At),s=this.Lt===n.bt;return this.Et()+this.It()+(s?1-i:i)*this.Ct()},t.prototype.Mt=function(t){var i=(0,a.normalize)(t,this.zt(),this.zt()+this.width(),this.At);return(0,h.dt)(i,this.xt[0],this.xt[1])},t.prototype.Ht=function(t){var i=(0,a.normalize)(t,this.Et(),this.Et()+this.height(),this.At);return(0,h.dt)(i,this.xt[0],this.xt[1])},t.prototype.width=function(t){return this.Nt()*(null!=t?t:1)},t.prototype.height=function(t){return this.Ct()*(null!=t?t:1)},t.prototype.qt=function(t){return this.Mt(t)-this.Mt(0)},t.prototype.wt=function(t){return this.Ht(t)-this.Ht(0)},t}();i.R=u},326:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Ut=void 0;var e=s(839);i.Ut=function(t,i){if(t.parentElement){var s=t.parentElement,n=i.x,r=i.y,o=new ResizeObserver((function(){var i=s.getBoundingClientRect(),o=i.width,h=i.height,a=Math.min(o/n,h/r),u=t.clientWidth,c=t.clientHeight,l=Math.round(a*n),f=Math.round(a*r);l===u&&f===c||(t instanceof HTMLCanvasElement&&(t.width=l*e.it,t.height=f*e.it),t.style.width=l+"px",t.style.height=f+"px")}));return o.observe(s),o}return console.warn("aspectRatioResize: element has no parent and cannot be resized"),null}},999:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Jt=void 0;i.Jt=function(t,i,s){var e=s*Math.sqrt(3)/2;return[[t,i-2*e/3],[t+s/2,i*(e/3)],[t-s/2,i*(e/3)]]}},125:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Kt=void 0;i.Kt=function(t,i,s,e){var n=Math.sqrt(e*e/4-s*s);return[[t,i-2*n/3],[t+e/2,i*(n/3)],[t-e/2,i*(n/3)]]}},932:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.V=void 0;var e=s(965);i.V=function(t,i,s,n){void 0===n&&(n=5);for(var r=[],o=0,h=n;o<=h;o++){var a=-e.PI/(2*n)+e.K*(o/h);r.push([t+Math.cos(a)*s,i+Math.sin(a)*s])}return r}},166:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Yt=void 0;i.Yt=function(t,i,s,e,n){return[Math.cos(n)*(t-s)-Math.sin(n)*(i-e)+s,Math.sin(n)*(t-s)+Math.cos(n)*(i-e)+e]}},154:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Y=void 0;var e=s(965);i.Y=function(t,i,s,n,r){void 0===n&&(n=5),void 0===r&&(r=.4);for(var o=[],h=0,a=2*n;h<=a;h++){var u=-e.PI/(2*n)+e.K*(h/a),c=h%2;o.push([t+Math.cos(u)*(0===c?s:s*r),i+Math.sin(u)*(0===c?s:s*r)])}return o}},839:function(t,i,s){"use strict";var e=this&&this.g||(Object.create?function(t,i,s,e){void 0===e&&(e=s),Object.defineProperty(t,e,{m:!0,get:function(){return i[s]}})}:function(t,i,s,e){void 0===e&&(e=s),t[e]=i[s]}),n=this&&this._||function(t,i){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(i,s)||e(i,t,s)};Object.defineProperty(i,"t",{value:!0}),n(s(712),i),n(s(367),i),n(s(659),i),n(s(603),i),n(s(147),i),n(s(654),i),n(s(796),i),n(s(90),i),n(s(466),i),n(s(92),i),n(s(358),i),n(s(159),i),n(s(600),i),n(s(965),i),n(s(908),i),n(s(250),i),n(s(482),i),n(s(674),i),n(s(326),i),n(s(999),i),n(s(125),i),n(s(932),i),n(s(166),i),n(s(154),i)},603:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.it=void 0,i.it=window.devicePixelRatio||1},90:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Vt=void 0;i.Vt=function(t){return JSON.parse(JSON.stringify(t))}},147:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Xt=void 0;i.Xt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.every((function(t){return void 0===t}))}},654:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i._t=void 0;i._t=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.some((function(t){return void 0===t}))}},796:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ot=void 0;i.ot=function(t){return void 0===t}},466:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.Gt=void 0;i.Gt=function(t){for(new Date;new Date-t<ms;);}},674:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.gt=void 0;var e=s(159),n=function(){function t(t,i){this.x=t,this.y=i}return Object.defineProperty(t.prototype,"ratio",{get:function(){return this.x/this.y},m:!1,Qt:!0}),Object.defineProperty(t.prototype,"Zt",{get:function(){return Math.pow(Math.pow(this.x,2)+Math.pow(this.y,2),.5)},m:!1,Qt:!0}),t.prototype.add=function(t,i){return"number"==typeof t?(this.x+=t,"number"==typeof i&&(this.y+=i)):(this.x+=t.x,this.y+=t.y),this},t.prototype.angle=function(){return Math.atan2(-this.y,-this.x)+Math.PI},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.$t=function(t){return(0,e.ti)(this.x,this.y,t.x,t.y)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.Zt;return 0!==t&&(this.x/=t,this.y/=t),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},t.from=function(i,s){return new t(i.x-s.x,i.y-s.y)},t}();i.gt=n},600:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.At=void 0;i.At=function(t,i,s){return Math.max(Math.min(s,t),i)}},92:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ii=i.si=void 0;var e=s(159);i.si=function(t,i,s,n,r,o){return(0,e.ti)(t,i,n,r)<=s+o};i.ii=function(t,i,s,e,n,r,o,h){return!(i+e<r||i>r+h||t+s<n||t>n+o)}},965:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ei=i.PI=i.K=void 0;var e=s(674);i.K=2*Math.PI,i.PI=Math.PI,i.ei=new e.gt(0,0)},159:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ni=i.ti=void 0;i.ti=function(t,s,e,n){return Math.pow((0,i.ni)(t,s,e,n),.5)};i.ni=function(t,i,s,e){return Math.pow(s-t,2)+Math.pow(e-i,2)}},908:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.dt=void 0;i.dt=function(t,i,s){return i*(1-t)+s*t}},250:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.ri=void 0;i.ri=function(t,i){return(t%i+i)%i}},482:(t,i,s)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.normalize=void 0;var e=s(600);i.normalize=function(t,i,s,n){return void 0===n&&(n=!1),((n?(0,e.At)(t,i,s):t)-i)/(s-i)}},358:(t,i)=>{"use strict";Object.defineProperty(i,"t",{value:!0}),i.random=void 0,i.random=function(t,i){return void 0===t&&(t=1),void 0===i&&(i=0),Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:i+Math.random()*(t-i)}},557:function(t){var i;t.exports=(i=function(){function t(t){return n.appendChild(t.oi),t}function s(t){for(var i=0;i<n.children.length;i++)n.children[i].style.display=i===t?"block":"none";e=t}var e=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(t){t.preventDefault(),s(++e%n.children.length)}),!1);var r=(performance||Date).now(),o=r,h=0,a=t(new i.hi("FPS","#0ff","#002")),u=t(new i.hi("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new i.hi("MB","#f08","#201"));return s(0),{ai:16,oi:n,ui:t,ci:s,li:function(){r=(performance||Date).now()},end:function(){h++;var t=(performance||Date).now();if(u.update(t-r,200),t>o+1e3&&(a.update(1e3*h/(t-o),100),o=t,h=0,c)){var i=performance.memory;c.update(i.fi/1048576,i.di/1048576)}return t},update:function(){r=this.end()},vi:n,pi:s}},i.hi=function(t,i,s){var e=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),h=80*o,a=48*o,u=3*o,c=2*o,l=3*o,f=15*o,d=74*o,v=30*o,p=document.createElement("canvas");p.width=h,p.height=a,p.style.cssText="width:80px;height:48px";var w=p.getContext("2d");return w.font="bold "+9*o+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=s,w.fillRect(0,0,h,a),w.fillStyle=i,w.fillText(t,u,c),w.fillRect(l,f,d,v),w.fillStyle=s,w.globalAlpha=.9,w.fillRect(l,f,d,v),{oi:p,update:function(a,M){e=Math.min(e,a),n=Math.max(n,a),w.fillStyle=s,w.globalAlpha=1,w.fillRect(0,0,h,f),w.fillStyle=i,w.fillText(r(a)+" "+t+" ("+r(e)+"-"+r(n)+")",u,c),w.drawImage(p,l+o,f,d-o,v,l,f,d-o,v),w.fillRect(l+d-o,f,o,v),w.fillStyle=s,w.globalAlpha=.9,w.fillRect(l+d-o,f,o,r((1-a/M)*v))}}},i)}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.n=t=>{var i=t&&t.t?()=>t.default:()=>t;return s.d(i,{a:i}),i},s.d=(t,i)=>{for(var e in i)s.wi(i,e)&&!s.wi(t,e)&&Object.defineProperty(t,e,{m:!0,get:i[e]})},s.wi=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{"use strict";var t=s(839),i=s(557),e=s.n(i);const n=[[[22,38],[35,87],[37,89],[44,92],[55,92],[60,89],[64,84],[76,38],[74,35],[59,22],[49,20],[38,22],[29,29],[22,38]],[[31,52],[45,55],[40,61],[35,59],[31,52]],[[58,61],[56,60],[54,55],[67,52],[62,59],[58,61]],[[58,25],[59,17],[63,12],[68,8],[76,7],[83,8],[88,12],[92,17],[94,25],[93,29],[89,38]],[[74,35],[89,52],[86,54],[83,55],[79,55],[75,51],[72,40],[74,35]],[[40,25],[38,17],[34,12],[29,8],[22,7],[15,8],[10,12],[6,17],[5,29],[9,38]],[[25,35],[9,52],[11,54],[14,55],[19,55],[22,51],[25,40],[25,35]]],r=[[[49,22],[63,11],[73,10],[82,11],[89,17],[95,24],[97,34],[95,39],[90,48],[49,90],[7,48],[2,39],[1,34],[2,24],[8,17],[15,11],[25,10],[34,11],[49,22]]],o=[[[95,56],[75,43],[51,35],[43,53],[40,65],[40,82],[44,91],[49,95],[54,96],[65,94],[72,90],[86,74],[96,59],[95,56]],[[53,85],[49,80],[47,68],[56,79],[71,80],[59,85],[53,85]],[[73,71],[67,65],[76,65],[81,72],[73,71]],[[54,62],[49,55],[57,56],[63,62],[54,62]],[[39,47],[33,49],[27,56],[31,45],[36,42],[42,42],[44,36],[48,29],[52,29],[57,31],[55,20],[49,2],[24,7],[2,19],[11,42],[23,57],[35,63],[39,47]],[[43,22],[51,25],[43,29],[35,25],[43,22]],[[25,36],[16,38],[20,31],[29,29],[25,36]]],h=[[[58,15],[55,7],[48,4],[40,7],[37,15],[40,22],[48,26],[55,22],[58,15]],[[87,34],[85,30],[81,29],[14,29],[9,30],[8,34],[9,38],[14,40],[37,40],[37,88],[38,93],[43,95],[45,94],[49,90],[50,80],[52,80],[72,68],[72,62],[58,52],[58,40],[81,40],[85,38],[87,34]],[[50,68],[50,62],[54,65],[50,68]]],a=[[[49,67],[41,65],[36,61],[32,56],[31,49],[32,41],[36,35],[41,31],[49,30],[56,31],[62,35],[66,41],[68,49],[66,56],[62,61],[56,65],[49,67]],[[84,67],[76,63],[73,56],[76,48],[84,45],[91,48],[95,56],[91,63],[84,67]],[[62,25],[54,21],[51,14],[54,5],[62,2],[69,5],[73,14],[69,21],[62,25]],[[14,25],[6,21],[3,14],[6,5],[14,2],[21,5],[25,14],[21,21],[14,25]],[[14,88],[6,84],[3,76],[6,68],[14,65],[21,68],[25,76],[21,84],[14,88]],[[68,95],[60,91],[57,84],[60,76],[68,73],[75,76],[79,84],[75,91],[68,95]],[[57,22],[61,23],[57,34],[53,32],[57,22]],[[66,50],[75,52],[74,56],[66,54],[66,50]],[[59,63],[65,75],[62,76],[55,65],[59,63]],[[22,19],[39,36],[36,38],[19,22],[22,19]],[[34,58],[37,61],[23,72],[20,69],[34,58]]],u=[[[34,48],[20,48],[28,51],[39,51],[39,47],[34,48]],[[30,28],[25,31],[27,33],[35,38],[41,39],[30,28]],[[34,40],[24,33],[19,39],[28,41],[38,41],[34,40]],[[39,43],[28,44],[19,42],[18,43],[19,46],[33,46],[38,44],[39,43]],[[73,24],[67,19],[60,18],[56,34],[59,36],[63,32],[76,28],[73,24]],[[54,18],[49,19],[51,34],[54,34],[54,27],[58,18],[54,18]],[[40,24],[47,35],[49,34],[48,19],[32,26],[43,37],[45,36],[38,24],[39,22],[40,24]],[[65,45],[63,44],[64,47],[67,46],[65,45]],[[72,40],[62,41],[69,44],[73,41],[72,40]],[[76,31],[70,31],[60,38],[75,39],[76,31]],[[80,20],[76,13],[65,5],[58,4],[46,4],[32,7],[26,11],[16,21],[13,28],[12,36],[14,44],[21,52],[26,53],[39,53],[37,60],[23,79],[25,85],[29,89],[35,92],[47,91],[53,88],[63,79],[67,74],[65,49],[69,47],[79,37],[82,28],[80,20]],[[19,46],[19,42],[28,44],[39,43],[38,44],[33,46],[19,46]],[[49,34],[47,35],[39,22],[38,24],[39,27],[45,36],[43,37],[32,26],[48,19],[49,34]],[[41,39],[35,38],[25,31],[30,28],[41,39]],[[30,38],[38,41],[28,42],[19,40],[24,33],[30,38]],[[20,48],[29,49],[39,47],[39,51],[28,51],[20,48]],[[60,18],[67,19],[76,28],[63,32],[59,36],[56,35],[60,18]],[[57,18],[54,34],[51,34],[49,19],[57,18]],[[64,47],[63,44],[67,46],[64,47]],[[69,44],[62,41],[72,40],[73,41],[69,44]],[[75,37],[75,39],[60,38],[74,30],[76,31],[76,34],[75,37]]],c=[[[87,35],[83,21],[80,15],[70,6],[57,1],[43,1],[30,6],[20,15],[15,28],[14,35],[9,39],[7,47],[9,54],[14,59],[18,72],[26,84],[37,92],[44,95],[57,95],[63,92],[74,84],[82,72],[87,59],[94,50],[95,47],[92,39],[87,35]],[[87,45],[76,44],[76,35],[80,34],[80,41],[83,41],[87,45]],[[78,63],[76,68],[76,65],[78,63]],[[63,74],[63,63],[71,63],[73,65],[73,74],[63,74]],[[45,74],[43,73],[43,65],[45,63],[57,63],[57,74],[45,74]],[[29,74],[30,63],[38,63],[40,65],[40,73],[29,74]],[[24,63],[25,68],[24,63]],[[22,30],[25,24],[25,29],[22,30]],[[57,19],[57,30],[43,29],[43,21],[45,19],[57,19]],[[78,30],[76,29],[76,24],[78,30]],[[73,58],[71,60],[63,60],[62,56],[58,54],[57,60],[45,60],[43,58],[43,54],[40,56],[38,60],[30,60],[29,35],[38,34],[40,35],[40,38],[43,40],[43,35],[45,34],[57,34],[58,40],[62,38],[63,34],[73,35],[73,58]],[[29,29],[29,19],[38,19],[40,21],[40,29],[29,29]],[[73,19],[73,29],[63,30],[63,19],[73,19]],[[63,16],[62,11],[70,16],[63,16]],[[40,14],[38,16],[31,16],[40,11],[40,14]],[[58,9],[57,16],[45,16],[43,14],[43,9],[58,9]],[[18,41],[21,41],[21,35],[24,34],[25,44],[14,45],[18,41]],[[18,52],[14,49],[25,50],[24,60],[22,60],[21,53],[18,52]],[[31,78],[40,79],[40,86],[31,78]],[[43,88],[43,79],[58,79],[58,88],[43,88]],[[62,86],[63,78],[71,78],[62,86]],[[83,52],[80,53],[78,60],[76,58],[76,50],[87,49],[83,52]],[[38,41],[33,42],[32,47],[33,50],[38,52],[41,50],[43,47],[41,42],[38,41]],[[63,41],[59,42],[58,47],[59,50],[63,52],[67,50],[69,47],[67,42],[63,41]]],l=[[[37,36],[46,37],[53,42],[57,48],[60,58],[59,66],[56,69],[49,74],[46,84],[37,87],[31,86],[28,84],[26,74],[17,69],[14,62],[17,48],[21,42],[28,37],[37,36]],[[63,95],[68,71],[69,59],[67,45],[64,35],[58,28],[47,21],[37,19],[27,21],[15,28],[10,35],[7,45],[6,59],[6,71],[12,95]],[[14,61],[15,79],[21,95]],[[61,61],[59,79],[54,95]],[[77,21],[45,10],[29,9],[20,9],[12,13],[17,8],[25,4],[44,2],[71,6],[92,13],[77,21]],[[94,9],[82,95]],[[42,51],[39,53],[40,59],[43,63],[46,63],[51,60],[53,55],[53,51],[47,48],[42,51]],[[37,63],[34,66],[33,71],[41,71],[40,66],[37,63]],[[33,51],[30,49],[24,49],[22,51],[20,55],[24,60],[30,63],[34,59],[35,56],[33,51]]],f=[[[49,39],[41,43],[39,47],[39,52],[43,58],[47,60],[52,60],[58,56],[60,52],[60,47],[56,41],[49,39]],[[49,42],[43,45],[42,52],[45,56],[52,57],[56,54],[57,47],[54,43],[49,42]],[[16,20],[25,25],[26,24],[25,19],[22,17],[19,17],[16,20]],[[34,5],[30,5],[28,7],[28,13],[30,15],[35,15],[38,12],[37,6],[34,5]],[[65,5],[61,8],[61,12],[64,15],[69,15],[71,13],[71,7],[69,5],[65,5]],[[74,25],[83,19],[80,17],[75,18],[73,21],[74,25]],[[50,69],[49,68],[49,70],[50,69]],[[51,72],[49,71],[48,73],[50,74],[51,72]],[[52,77],[51,75],[48,75],[49,79],[51,79],[52,77]],[[50,77],[49,76],[49,78],[50,77]],[[33,36],[41,42],[33,36]],[[40,30],[45,40],[40,30]],[[49,28],[50,40],[49,28]],[[54,40],[59,30],[54,40]],[[58,42],[66,35],[58,42]],[[58,53],[67,59],[58,53]],[[54,55],[59,65],[54,55]],[[49,55],[50,67],[49,55]],[[40,64],[45,55],[40,64]],[[33,59],[41,52],[33,59]],[[33,36],[41,42],[33,36]],[[40,30],[45,40],[40,30]],[[49,28],[50,40],[49,28]],[[54,40],[59,30],[54,40]],[[58,42],[66,35],[58,42]],[[21,47],[26,50],[21,47]],[[21,47],[26,50],[21,47]],[[21,53],[25,50],[21,53]],[[21,53],[25,50],[21,53]],[[74,50],[78,53],[79,52],[74,50]],[[74,50],[78,53],[79,52],[74,50]],[[74,49],[78,46],[74,49]],[[74,49],[78,46],[74,49]],[[49,81],[50,92],[49,81]],[[47,90],[50,92],[47,90]],[[50,92],[52,90],[50,92]]],d=[[[20,39],[20,35],[13,35],[14,41],[17,42],[20,39]],[[86,37],[85,34],[81,34],[79,36],[79,40],[83,42],[86,40],[86,37]],[[25,50],[40,58],[52,60],[59,58],[74,49],[58,44],[46,43],[25,50]]],v=[[[25,49],[26,50],[44,44],[55,44],[74,50],[63,43],[52,39],[40,41],[25,49]],[[16,20],[16,26],[20,28],[24,27],[25,25],[16,20]],[[55,5],[53,1],[48,0],[45,2],[44,7],[46,10],[51,11],[54,9],[55,5]],[[74,25],[78,28],[82,27],[84,24],[83,19],[74,25]],[[21,40],[21,36],[18,34],[13,34],[11,37],[11,42],[13,44],[19,44],[21,40]],[[29,8],[28,13],[30,15],[35,14],[35,8],[29,8]],[[64,14],[69,15],[71,13],[71,9],[68,7],[64,8],[64,14]],[[78,41],[80,44],[86,44],[88,42],[87,35],[79,35],[78,41]]],p=[[[58,40],[97,40],[97,89],[3,89],[3,40],[42,40]],[[86,89],[89,81],[97,78]],[[50,53],[48,51],[48,46],[52,46],[52,51],[50,53]],[[3,78],[10,81],[14,89]],[[58,40],[55,33],[53,31],[50,31],[43,33],[41,40],[41,51],[43,56],[50,59],[55,56],[58,51],[58,40]],[[97,40],[94,23],[84,8],[16,8],[5,23],[3,40]]],w=[[[58,46],[68,43],[75,40],[74,43],[70,50],[63,50],[60,49],[58,46]],[[49,3],[35,6],[24,14],[16,26],[14,40],[16,62],[23,78],[34,88],[49,94],[62,89],[73,79],[81,63],[84,40],[81,26],[73,14],[62,6],[49,3]],[[46,48],[45,59],[37,54],[34,57],[31,63],[32,73],[43,84],[35,81],[26,74],[21,63],[19,50],[19,34],[22,24],[29,14],[41,7],[32,17],[31,32],[33,37],[39,41],[42,38],[43,31],[46,43],[43,45],[46,48]],[[56,85],[64,76],[68,68],[66,59],[61,54],[58,55],[54,59],[53,48],[56,46],[53,44],[54,33],[56,31],[58,40],[62,40],[65,37],[68,28],[66,18],[58,7],[69,14],[76,24],[79,34],[79,50],[77,63],[75,70],[69,77],[62,82],[56,85]],[[41,46],[30,43],[23,40],[23,43],[27,50],[35,50],[38,49],[41,46]]];var M;!function(t){t.Mi="gameplay",t.gi="intro",t.bi="paused",t.mi="upgrade"}(M||(M={}));const g={move:{yi:!1,_i:!1,left:!1,right:!1},timestamp:{Oi:0,ji:-58e3},xi:!1,Si:[],Ai:[],items:[],ki:[],Ri:M.gi,Ni:4,zi:0,Pi:1550,Ci:0},b=new t.gt(0,0),m=new t.gt(32,18),y=new t.gt(m.x/2-1,m.y/2-1),_=1/m.x,O="rgb(28,5,50)",j="rgba(0,0,0)",x="rgb(253,93,106)",S="rgb(254,184,18)",A="rgb(111,254,237)",k="rgb(248,96,248)",R={Ei:document.querySelector("canvas#ui"),map:document.querySelector("canvas#map"),Di:document.querySelector("canvas#gameplay")},N={Ei:R.Ei.getContext("2d"),map:R.map.getContext("2d"),Di:R.Di.getContext("2d")},z="Arial, sans-serif",P={strokeStyle:"white",fillStyle:"white",lineWidth:t=>t.width(.001),fontFamily:z,textAlign:"center",textBaseline:"middle",fontSize:t=>t.width(.1)},C={C:!0,D:"width"},E={map:new t.R({canvas:R.map,xt:[0,m.x],St:[0,m.y]}),Ei:new t.R({canvas:R.Ei,padding:.1})},D={map:new t.j(N.map,{...C,coords:E.map,T:P,stroke:!0}),Di:new t.ct(N.Di,{...C,coords:E.map,T:{...P,lineWidth:t=>t.width(.00175)},stroke:!0,lt:.1}),Ei:new t.ct(N.Ei,{...C,coords:E.Ei,T:{...P,lineWidth:t=>t.width(.01),fontSize:t=>t.width(.1),fontFamily:z}})},W=[0,100],T=[-1,1],B={Wi:{}};class F{constructor(t){this.Ti="",this.cache={},this.Bi=!1,this.position=t,this.Fi=t.clone()}get Ii(){if("Ii"in this.cache)return this.cache.Ii;const t=this.position.clone().add(this.Li/2,this.Li/2);return this.cache.Ii=t,t}get key(){if("key"in this.cache)return this.cache.key;const t=String(this.Ti)+String(this.Hi)+JSON.stringify(this.options);return this.cache.key=t,t}qi(i,s){const e=this.key;e in B.Wi&&B.Wi[e].length||(B.Wi[this.key]=((i,s,e,n,r)=>{const o=[];i.X(i.options.T);for(let h=0;h<n;h++){const n=document.createElement("canvas");n.width=e,n.height=e;const h=n.getContext("2d");s(new t.ct(h,{...i.options,T:{...i.options.T,lineWidth:i.context.lineWidth},coords:new t.R({canvas:n,xt:r,St:r})})),o.push(n)}return o})(D.Di,this.Ui,D.Di.coords.width(_*this.Li),4,this.Ji));const n=B.Wi[e][g.Ci];D.Di.drawImage(n,(0,t.dt)(i,this.Fi.x,this.position.x),(0,t.dt)(i,this.Fi.y,this.position.y),s)}update(t,i,s){this.Fi.set(this.position),this.Ii.x=this.position.x+this.Li/2,this.Ii.y=this.position.y+this.Li/2}}const I=new class extends F{constructor(i){super(i),this.Hi=.75,this.Li=1.5,this.Ti=0,this.speed=.005,this.Ji=W,this.Ki="right",this.Yi={T:{scale:{origin:this.Ii,scale:new t.gt(-1,1)}}},this.options={T:{fillStyle:k},fill:!0},this.Ui=t=>{h.forEach((i=>{t.q(i,this.options)}))},this.update=(t,i)=>{super.update(t,i),this.Vi(t,i)},this.Vi=(i,s)=>{const e=s*this.speed,n=.7071*e;let r=0,o=0;g.move.left&&g.move.yi?(r=-n,o=-n):g.move.left&&g.move._i?(r=-n,o=n):g.move.right&&g.move.yi?(r=n,o=-n):g.move.right&&g.move._i?(r=n,o=n):g.move.yi?o=-e:g.move._i?o=e:g.move.left?r=-e:g.move.right&&(r=e),this.position.x=(0,t.At)(this.position.x+r,0,m.x-1),this.position.y=(0,t.At)(this.position.y+o,0,m.y-1)}}qi(t){super.qi(t,"left"===this.Ki?this.Yi:void 0)}}(y.clone()),L={6:{Xi:[10,11,12.5,15,18,21.5,26.5],range:[1.5,1.55,1.65,1.8,2,2.25,2.55],Gi:[1,2,3,4,5,6,7]},7:{Qi:[.07,.09,.11,.15,.2,.25,.34],Zi:[1.5,1.55,1.65,1.85,2.15,2.65,3.15]},8:{Xi:[6,6.5,7.5,9,11,13.5,17],frequency:[1,1.5,2,3,4,6,8]},9:{Xi:[3,4,6,9,13,18,24],Zi:[1.5,1.7,2,2.4,2.9,3.5,4.2]},10:{Xi:[16,18,21,25,30,36,43],frequency:[.5,.6,.7,.9,1.1,1.4,1.7]}};class H extends F{constructor(i,s=I.Ii.clone()){super(s),this.size=.25,this.$i=(i,s,e)=>{for(let n=0;n<g.Si.length;n++){const r=g.Si[n];(0,t.si)(this.Ii.x,this.Ii.y,this.Hi,r.Ii.x,r.Ii.y,r.Hi)&&r.Xi(i,s,e,this.Ti)}},this.parent=i}update(t,i,s){super.update(t,i),this.Vi(t,i,s),this.$i(this.parent.Xi,s,t)}}class q extends H{constructor(i,s){super(i,I.position.clone()),this.Ji=T,this.Li=1,this.Hi=.05,this.Ti=8,this.options=void 0,this.Ui=t=>{t.q([[-1,0],[1,0]]),t.q([[-.75,-.4],[-1,0],[-.75,.4]])},this.Vi=(t,i)=>{this.Fi.set(this.position),this.position.x+=this.ts.x*this.parent.speed,this.position.y+=this.ts.y*this.parent.speed},this.ts=t.gt.from(s,this.Ii).normalize(),this.ss=this.ts.angle()+t.PI,this.es={T:{rotation:{origin:this.Ii,rotation:this.ss}}}}qi(t){super.qi(t,this.es)}}class U extends class{constructor(){this.ns=[],g.Ai.push(this)}rs(){return this.level<7}qi(t){for(let i=0;i<this.ns.length;i++)this.ns[i].qi(t)}update(t,i){for(let s=0;s<this.ns.length;s++)this.ns[s].Bi?this.ns.splice(s,1):this.ns[s].update(t,i,s)}}{constructor(){super(),this.level=1,this.range=5,this.speed=.1,this.os=0,this.upgrade=()=>{this.rs()&&this.level++}}get hs(){return L[8]}get frequency(){return 1e3/this.hs.frequency[this.level-1]}get Xi(){return this.hs.Xi[this.level-1]}update(t,i){if(super.update(t,i),t-this.os>this.frequency){this.os=t;const i=this.us();i&&this.ns.push(new q(this,i.Ii))}for(let s=0;s<this.ns.length;s++){const e=this.ns[s];e.update(t,i,s),e.Ii.$t(I.Ii)>this.range&&(e.Bi=!0)}}us(){let t,i=1/0;for(let s=0;s<g.Si.length;s++){const e=I.Ii.$t(g.Si[s].Ii);e<i&&(i=e,t=g.Si[s])}return t}}const J=()=>{D.Ei.clear();for(let i=0;i<g.Ni;i++){const s=new t.R({offsetX:D.Ei.coords.st(-1)+D.Ei.coords.width(i/g.Ni),offsetY:D.Ei.coords.et(-1),Ot:D.Ei.coords.width()/g.Ni,jt:D.Ei.coords.height(),padding:.05}),e=new t.ct(D.Ei.context,{...D.Ei.options,coords:s,stroke:!1});e.rect(-1,-1,1,e.coords.height()/e.coords.width(),{stroke:g.zi===i,fill:!0,T:{fillStyle:"rgba(255,255,255,.5)"}}),e.text("TEST",0,-.8,{T:{textBaseline:"top"}})}};var K;!function(t){t[t.cs=0]="Initialize",t[t.ls=1]="CanvasResize",t[t.fs=2]="Tick",t[t.ds=3]="KeyDown",t[t.vs=4]="KeyUp",t[t.ps=5]="StateChange"}(K||(K={}));const Y={[K.cs]:[],[K.ls]:[],[K.fs]:[],[K.ds]:[],[K.vs]:[],[K.ps]:[]},V=(t,i)=>{Y[t].push(i)},X=(t,...i)=>{const s=Y[t];for(let t=0;t<s.length;t++)s[t](...i)};new ResizeObserver((()=>{X(K.ls)})).observe(R.map),window.addEventListener("keydown",(t=>{X(K.ds,t.key)})),window.addEventListener("keyup",(t=>{X(K.vs,t.key)}));class G extends F{constructor(t,i){super(t),this.ws=t=>{this.Bi=!0},this.Ms=i}update(t,i,s){super.update(t,i),this.Vi(t,i,s)}Vi(i,s,e){this.Ms.gs&&((i,s,e,n)=>{const r=t.gt.from(I.position,i);if(!e.start&&r.Zt<e.ti)e.start=s;else if(e.start&&r.Zt<.5)e.bs(n);else if(e.start){const t=s-e.start;r.normalize();const n=r.clone().multiply(.0015*t-.25);i.x+=n.x,i.y+=n.y}})(this.position,i,this.Ms.gs,e)}}class Q extends G{constructor(t){super(t,{gs:{ti:3,ys:t.clone(),bs:t=>{this.ws(t)}}}),this.Ji=T,this.Li=1,this.Hi=.25,this.Ti=11,this.Ui=t=>{t.Y(0,0,this.Hi,5,.4,this.options)}}}class Z extends Q{constructor(t){super(t),this.points=1,this.options={T:{fillStyle:S,strokeStyle:S},fill:!0}}}class $ extends Q{constructor(t){super(t),this.points=5,this.options={T:{fillStyle:A,strokeStyle:A},fill:!0}}}class tt extends Q{constructor(t){super(t),this.points=25,this.options={T:{fillStyle:k,strokeStyle:k},fill:!0}}}const it=(0,s(257).i)({o:.5,u:1,h:.2,l:2});class st extends F{constructor(i,s,e){super(st._s(i.Ii.clone(),i)),this.Hi=.5,this.Li=1,this.duration=500,this.Os={T:{scale:{origin:b,scale:new t.gt(1,1)}}},this.options=void 0,this.Ji=T,this.qi=t=>{super.qi(t,this.Os)},this.Ui=t=>{t.text(this.text,0,0,{fill:!0,T:{fontSize:t=>t.width(.35),textBaseline:"top"},lt:.3})},this.target=i,this.Ti=s,this.text=s,this.start=e}static _s(t,i){return t.x=i.Ii.x-i.Li/2,t.y=i.Ii.y-1-i.Li/2,t}update(t,i){super.update(t,0,i);const s=it((t-this.start)/this.duration);this.Os.T.scale.origin=this.Ii,this.Os.T.scale.scale.x=s,this.Os.T.scale.scale.y=s,st._s(this.position,this.target),t-this.start>=this.duration&&(this.Bi=!0)}}class et extends F{constructor(t,i,s){super(t),this.speed=.00175,this.js=1e3,this.xs={},this.options={T:{fillStyle:j},fill:!0},this.Ms=i,this.Ss=s}As(t){D.Di.text(String(t),this.Ii.x,this.Ii.y-this.Li/2)}Xi(t,i,s,e){const n=this.xs[e];n&&s-n<this.js||(this.Ss-=t,g.ki.push(new st(this,String(t),s)),this.Ss<=0&&this.ws(),this.xs[e]=s)}ws(){const i=new((0,t.random)([Z,$,tt]))(this.Ii.clone());i.position.add(-i.Li/2,-i.Li/2),g.items.push(i),this.Bi=!0}update(t,i){super.update(t,i),this.Vi(t,i)}Vi(i,s){this.Ms.ks&&((i,s,e)=>{const n=t.gt.from(I.position,i).normalize().multiply(s*e.Rs);i.x+=n.x,i.y+=n.y})(this.position,s,this.Ms.ks),this.Ms.Ns&&((i,s,e)=>{const n=t.gt.from(I.position,i);if(n.Zt<e.ti){const t=n.normalize().multiply(s*e.ks);i.x+=t.x,i.y+=t.y}else{if(i.equals(e.zs))return;if(i.$t(e.zs)<.1)i.set(e.zs);else{const n=t.gt.from(e.zs,i).normalize().multiply(s*e.ks);i.x+=n.x,i.y+=n.y}}})(this.position,s,this.Ms.Ns)}}class nt extends et{constructor(t,i){super(t,{Ns:{ks:.002,ti:3,zs:t.clone()}},i),this.Ji=W,this.Li=1,this.Ti=1,this.Hi=.5,this.Ui=t=>{n.forEach((i=>t.q(i,this.options)))}}}class rt extends F{constructor(i,s){super(i),this.Bi=!1,this.Ti=12,this.Hi=1.5,this.Li=3,this.duration=2500,this.Ps=g.Pi/2,this.options=void 0,this.Ji=T,this.Ui=i=>{i.rect(-.2,-.8,.2,.8,{T:{rotation:{origin:b,rotation:t.PI/4},fillStyle:x},fill:!0,stroke:!1}),i.rect(-.2,-.8,.2,.8,{T:{rotation:{origin:b,rotation:-t.PI/4},fillStyle:x},fill:!0,stroke:!1})},this.start=s}update(t,i){super.update(t,0,i),t-this.start>rt.duration&&(this.Bi=!0)}}rt.duration=2500;const ot=[0,1,2,3],ht=[class extends et{constructor(t,i){super(t,{ks:{Rs:.002}},i),this.Ji=W,this.Li=1,this.Ti=3,this.Hi=.5,this.Ui=t=>{w.forEach((i=>t.q(i,this.options)))}}},class extends et{constructor(t,i){super(t,{ks:{Rs:.002}},i),this.Ji=W,this.Li=2,this.Ti=2,this.Hi=1,this.Ui=t=>{o.forEach((i=>t.q(i,this.options)))}}},class extends et{constructor(t,i){super(t,{ks:{Rs:.002}},i),this.Ji=W,this.Li=1,this.Ti=4,this.Hi=.5,this.speed=.002,this.Ui=t=>{c.forEach((i=>t.q(i,this.options)))}}},class extends et{constructor(t,i){super(t,{ks:{Rs:.002}},i),this.Ji=W,this.Li=1,this.Ti=5,this.Hi=.5,this.Ui=t=>{l.forEach((i=>t.q(i,this.options)))}}}],at=i=>{const s=(i-g.timestamp.ji-6e4)/rt.duration;if(s<1&&!g.xi){const s=(0,t.random)(.8*m.x,.1),e=(0,t.random)(.8*m.y,.1),n=new rt(new t.gt(s,e),i);g.xi=n,g.ki.push(n)}else if(s>1&&g.xi){const s=Math.floor((0,t.random)(16,12));for(let i=0;i<s;i++){const e=g.xi.Ii.x+1.5*Math.cos(t.K*i/s),n=g.xi.Ii.y+1.5*Math.sin(t.K*i/s);g.Si.push(new nt(new t.gt(e,n),5))}g.timestamp.ji=i,g.xi=!1}},ut=new(e()),ct=ut.ui(new(e().hi)("phys","#0ff","#002"));ut.oi.id="stats",document.body.appendChild(ut.oi);const lt=1e3/60;let ft=0,dt=0,vt=0;const pt=(t=0)=>{ut.li();const i=g.Ri!==M.Mi?0:t-dt;for(dt=t,[w,n,r,o,h,a,u,c,l,f,d,v,p].forEach((()=>null)),vt+=Math.min(i,50);vt>=lt;)wt(),vt-=lt,ft+=lt;Mt(vt/lt),ut.end(),window.requestAnimationFrame(pt)},wt=()=>{ct.update(59.99999999999999,200),I.update(ft,lt);for(let t=g.Ai.length-1;t>=0;t--)g.Ai[t].update(ft,lt);for(let t=g.Si.length-1;t>=0;t--)g.Si[t].Bi?g.Si.splice(t,1):g.Si[t].update(ft,lt);for(let t=g.items.length-1;t>=0;t--)g.items[t].Bi?g.items.splice(t,1):g.items[t].update(ft,lt,t);for(let t=g.ki.length-1;t>=0;t--)g.ki[t].Bi?g.ki.splice(t,1):g.ki[t].update(ft,t);(i=>{const s=1e3*(9e5-Math.max(0,i)/1e3)/1e6;if(i-g.timestamp.Oi>=s){g.timestamp.Oi=i;const s=(0,t.random)(ht),e=(0,t.random)(ot);let n,r;0===e&&(n=(0,t.random)(m.x),r=0),1===e&&(n=(0,t.random)(m.x),r=m.y),2===e&&(n=0,r=(0,t.random)(m.y)),3===e&&(n=0,r=(0,t.random)(m.y)),g.Si.push(new s(new t.gt(n,r),5))}i-g.timestamp.ji>=6e4&&at(i)})(ft)},Mt=t=>{g.Ci=Math.floor(ft/g.Pi%1*4),D.Di.clear();for(let i=0;i<g.Si.length;i++)g.Si[i].qi(t);for(let i=0;i<g.Ai.length;i++)g.Ai[i].qi(t);for(let i=0;i<g.items.length;i++)g.items[i].qi(t);for(let i=0;i<g.ki.length;i++)g.ki[i].qi(t);I.qi(t)};(0,t.Ut)(R.map,m),(0,t.Ut)(R.Di,m),(0,t.Ut)(R.Ei,m),V(K.ds,(i=>{"Enter"===i&&g.Ai.forEach((t=>t.upgrade())),"ArrowLeft"!==i&&"a"!==i||(g.Ri===M.Mi&&(g.move.left=!0,I.Ki="left"),g.Ri===M.mi&&(g.zi=(0,t.ri)(g.zi-1,g.Ni),J())),"ArrowRight"!==i&&"d"!==i||(g.Ri===M.Mi&&(g.move.right=!0,I.Ki="right"),g.Ri===M.mi&&(g.zi=(0,t.ri)(g.zi+1,g.Ni),J())),"ArrowUp"!==i&&"w"!==i||(g.move.yi=!0),"ArrowDown"!==i&&"s"!==i||(g.move._i=!0),"Escape"===i&&g.Ri===M.Mi&&X(K.ps,M.bi)})),V(K.vs,(t=>{"ArrowLeft"!==t&&"a"!==t||(g.move.left=!1),"ArrowRight"!==t&&"d"!==t||(g.move.right=!1),"ArrowUp"!==t&&"w"!==t||(g.move.yi=!1),"ArrowDown"!==t&&"s"!==t||(g.move._i=!1),"Enter"===t&&g.Ri===M.bi&&X(K.ps,M.Mi)})),V(K.ls,(()=>{(t=>{for(let i=0;i<m.x;i++)for(let s=0;s<m.y;s++)t.rect(i,s,1/m.x,1/m.x,{T:{strokeStyle:"rgba(255,255,255,0.1)"}})})(D.map);for(const t in B.Wi)B.Wi[t].length=0;g.Ri===M.mi&&J()})),V(K.ps,(t=>{if(t===M.mi)g.zi=0;g.Ri=t})),V(K.cs,(()=>{document.body.style.backgroundColor=O,R.map.style.zIndex="-1",new U})),X(K.cs),X(K.ps,M.Mi),window.requestAnimationFrame(pt)})()})();</script></body></html>