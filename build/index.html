<html><head><link href="main.css" rel="stylesheet"></head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.01"><title>Bardo</title><body class="full"><div id="root"><canvas id="ui"></canvas><canvas id="map"></canvas><canvas id="gameplay"></canvas></div><script>(()=>{var t={712:function(t,i,s){"use strict";var n=this&&this.t||function(){return n=Object.assign||function(t){for(var i,s=1,n=arguments.length;s<n;s++)for(var e in i=arguments[s])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t},n.apply(this,arguments)};Object.defineProperty(i,"i",{value:!0}),i.o=i.h=void 0;var e=s(839),o=s(603);!function(t){t.u="width",t.v="height"}(i.h||(i.h={}));var r=function(){function t(t,i){var s;void 0===i&&(i={}),this.context=t,this.coords=null!==(s=i.coords)&&void 0!==s?s:new e.l({canvas:t.canvas});var o={beginPath:!0,closePath:!1,fill:!1,p:void 0,M:!0,stroke:!1,m:!1,_:!1,g:!1};this.options=n(n({},o),i),this.options.O=n(n({},{fontFamily:"sans-serif",fontSize:16}),i.O)}return t.prototype.rect=function(t,i,s,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===n&&(n=1),void 0===e&&(e={}),this.j(e),this.context.rect(this.S(t,e),this.A(i,e),this.R(s,e),this.R(n,e)),this.k(e)},t.prototype.N=function(t,i){void 0===i&&(i={}),this.j(i);for(var s=0;s<t.length;s++){var n=this.S(t[s][0],i),e=this.A(t[s][1],i);0===s?this.context.moveTo(n,e):this.context.lineTo(n,e)}this.k(i)},t.prototype.C=function(t,i){void 0===i&&(i={}),this.j(i);for(var s=0;s<t.length-2;s++){var n=this.S(t[s][0],i),e=this.A(t[s][1],i);if(0===s)this.context.moveTo(n,e);else if(s<t.length-2){var o=(n+this.S(t[s+1][0],i))/2,r=(e+this.A(t[s+1][1],i))/2;this.context.quadraticCurveTo(n,e,o,r)}}this.context.quadraticCurveTo(this.S(t[t.length-2][0],i),this.A(t[t.length-2][1],i),this.S(t[t.length-1][0],i),this.A(t[t.length-1][1],i)),this.k(i)},t.prototype.P=function(t,i,s,n){void 0===n&&(n={}),this.j(n),this.context.arc(this.S(t,n),this.A(i,n),this.R(s,n),0,e.D),this.k(n)},t.prototype.drawImage=function(t,i,s,n){void 0===n&&(n={}),this.j(n),this.context.drawImage(t,this.S(i,n),this.A(s,n)),this.k(n)},t.prototype.W=function(t,i,s,o,r,h){void 0===h&&(h={}),this.N((0,e.W)(this.S(t,h),this.A(i,h),this.R(s,h),o,r),n(n({},h),{m:!1,M:!0}))},t.prototype.L=function(t,i,s,o,r){void 0===r&&(r={}),this.N((0,e.L)(this.S(t,r),this.A(i,r),this.R(s,r),o),n(n({},r),{m:!1,M:!0}))},t.prototype.T=function(t){this.F(n(n({},this.options.O),t))},t.prototype.text=function(t,i,s,n){void 0===n&&(n={}),this.j(n),this.context.fillText(t,this.S(i,n),this.A(s,n),this.H("maxTextWidth",n)),this.k(n)},t.prototype.clear=function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.I=function(t,i){void 0===i&&(i={}),t.width=t.clientWidth*(i.U?o.B:1),t.height=t.clientHeight*(i.U?o.B:1)},t.prototype.S=function(t,i){return void 0===i&&(i={}),this.H("useNormalCoordinates",i)?this.coords.J(t):t},t.prototype.A=function(t,i){return void 0===i&&(i={}),this.H("useNormalCoordinates",i)?this.coords.K(t):t},t.prototype.R=function(t,i){void 0===i&&(i={});var s=this.H("scalarNormalization",i);return"width"===s?this.coords.width(t):"height"===s?this.coords.height(t):t},t.prototype.H=function(t,i){return i&&t in i?i[t]:this.options[t]},t.prototype.Y=function(t,i){var s=i&&t in i?i[t]:this.options.O[t];return"function"==typeof s?s(this.coords):s},t.prototype.q=function(t){var i=this.Y("fontSize",t),s=this.Y("lineHeight",t),n=this.Y("fontStyle",t),e=this.Y("fontFamily",t),o=this.Y("fontWeight",t),r=this.Y("fontStretch",t),h="number"==typeof i?"".concat(i,"px"):void 0;return s&&h&&(h="".concat(i," / ").concat(s,"}")),[h,e,n,o,r].join(" ").trim()},t.prototype.F=function(t){for(var i in t){var s=this.Y(i,t);if(!(0,e.G)(s)){if("transform"===i&&this.context.setTransform(s),"translation"===i){var n=s,o=n.x,r=n.y;this.context.translate(this.S(o),this.A(r))}if("rotation"===i)if("number"==typeof s)this.context.rotate(s);else{var h=s,a=h.rotation,u=h.origin,c=this.S(u.x),f=this.A(u.y);this.context.translate(c,f),this.context.rotate(a),this.context.translate(-c,-f)}if("scale"===i)if("origin"in s){var v=s,l=v.origin,d=v.scale,p=v.V,M=void 0!==p&&p;c=this.S(l.x),f=this.A(l.y);this.context.translate(c,f),this.context.scale(d.x,d.y),this.context.translate(-c,-f),M&&(this.context.lineWidth=this.context.lineWidth*(1/((d.x+d.y)/2)))}else{var w=s;o=w.x,r=w.y;this.context.scale(o,r)}"lineDash"===i&&this.context.setLineDash(s),"alpha"===i&&(this.context.globalAlpha=s),i in this.context&&"function"!=typeof this.context[i]&&(this.context[i]=this.Y(i,t))}}this.context.font=this.q(t)},t.prototype.j=function(t){void 0===t&&(t={}),this.H("saveAndRestore",t)&&this.context.save(),this.H("skipApplyStyles",t)||this.T(t.O),this.H("beginPath",t)&&this.context.beginPath()},t.prototype.k=function(t){this.H("closePath",t)&&this.context.closePath(),this.H("fill",t)&&this.context.fill(),this.H("stroke",t)&&this.context.stroke(),this.H("saveAndRestore",t)&&this.context.restore()},t}();i.o=r},367:function(t,i,s){"use strict";var n,e=this&&this.X||(n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},n(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}),o=this&&this.t||function(){return o=Object.assign||function(t){for(var i,s=1,n=arguments.length;s<n;s++)for(var e in i=arguments[s])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t},o.apply(this,arguments)};Object.defineProperty(i,"i",{value:!0}),i.Z=void 0;var r=s(839),h=function(t){function i(i,s){var n=t.call(this,i,s)||this;return n.options=o(o({},{$:.025,tt:!1}),n.options),n}return e(i,t),i.prototype.N=function(t,i){void 0===i&&(i={});for(var s=t.length-1,n=0;n<2;n++){for(var e=[],h=0;h<s;h++){var a=t[h],u=a[0],c=a[1],f=t[h+1],v=f[0],l=f[1],d=Math.sqrt(Math.pow(u-v,2)+Math.pow(c-l,2)),p=this.options.$*d;if(i.tt&&h===s-1){e.push(e[0]);break}for(var M=0;M<4;M++){var w=Math.random()*p,b=Math.random()*r.D,m=w*Math.cos(b),_=w*Math.sin(b),g=NaN,O=NaN;if(0===M&&(g=u+m,O=c+_),1===M){var y=.5;g=(0,r.it)(y,u,v)+m,O=(0,r.it)(y,c,l)+_}if(2===M){y=.75;g=(0,r.it)(y,u,v)+m,O=(0,r.it)(y,c,l)+_}3===M&&(g=v+m,O=l+_),e.push([g,O])}}var j=0===n?i:o(o({},i),{fill:!1});this.C(e,j)}},i.prototype.P=function(t,i,s,n){void 0===n&&(n={});for(var e=10*this.options.$*this.R(s,n)/window.innerWidth,h=0;h<2;h++){for(var a=[],u=0;u<16;u++){var c=Math.random()*e,f=Math.random()*r.D,v=c*Math.cos(f),l=c*Math.sin(f),d=r.D*u/16,p=this.S(t+v,n)+Math.cos(d)*this.R(s,n),M=this.A(i+l,n)+Math.sin(d)*this.R(s,n);a.push([p,M])}a[16]=a[0],a[17]=a[1],this.C(a,o(o({},n),{m:!1,M:!0,tt:!0}))}},i.prototype.rect=function(t,i,s,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===n&&(n=1),void 0===e&&(e={});var r=this.S(t),h=this.A(i),a=this.R(s),u=this.R(n),c=[[r,h],[r+a,h],[r+a,h+u],[r,h+u],[r,h]];this.N(c,o(o({},e),{m:!1,M:!0,tt:!0}))},i.prototype.L=function(i,s,n,e,r){void 0===r&&(r={}),t.prototype.L.call(this,i,s,n,e,o(o({},r),{tt:!0}))},i}(r.o);i.Z=h},659:function(t,i,s){"use strict";var n=this&&this.t||function(){return n=Object.assign||function(t){for(var i,s=1,n=arguments.length;s<n;s++)for(var e in i=arguments[s])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t},n.apply(this,arguments)};Object.defineProperty(i,"i",{value:!0}),i.l=void 0;var e,o=s(654),r=s(796),h=s(908),a=s(482);!function(t){t.st="up",t.nt="down"}(e||(e={}));var u=function(){function t(t){if(void 0===t&&(t={}),(0,r.G)(t.canvas)&&(0,o.et)(t.ot,t.rt))throw new Error("Invalid options. A canvas element must be supplied if baseHeight or baseWidth are not defined.");Object.assign(this,n(n({},{ht:[-1,1],ut:[-1,1],ct:!1,orientationY:"down",ft:!1}),t))}return t.prototype.vt=function(){var t;return null!==(t=this.ot)&&void 0!==t?t:this.canvas.width},t.prototype.lt=function(){return this.vt()-2*this.dt()},t.prototype.Mt=function(){var t;return null!==(t=this.rt)&&void 0!==t?t:this.canvas.height},t.prototype.wt=function(){return this.Mt()-2*this.bt()},t.prototype._t=function(){var t,i;return null!==(i=null!==(t=this.gt)&&void 0!==t?t:this.padding)&&void 0!==i?i:0},t.prototype.dt=function(){return this._t()*this.vt()},t.prototype.Ot=function(){return(0,r.G)(this.yt)?(0,r.G)(this.padding)?0:this.ft?this.padding*(this.vt()/this.Mt()):this.padding:this.yt},t.prototype.bt=function(){return this.Ot()*this.Mt()},t.prototype.jt=function(){var t;return null!==(t=this.offsetX)&&void 0!==t?t:0},t.prototype.xt=function(){var t;return null!==(t=this.offsetY)&&void 0!==t?t:0},t.prototype.J=function(t){var i=(0,a.normalize)(t,this.ht[0],this.ht[1],this.ct);return this.dt()+this.jt()+i*this.lt()},t.prototype.K=function(t){var i=(0,a.normalize)(t,this.ut[0],this.ut[1],this.ct),s=this.St===e.st;return this.bt()+this.xt()+(s?1-i:i)*this.wt()},t.prototype.At=function(t){var i=(0,a.normalize)(t,this.dt(),this.dt()+this.width(),this.ct);return(0,h.it)(i,this.ht[0],this.ht[1])},t.prototype.Rt=function(t){var i=(0,a.normalize)(t,this.bt(),this.bt()+this.height(),this.ct);return(0,h.it)(i,this.ht[0],this.ht[1])},t.prototype.width=function(t){return this.lt()*(null!=t?t:1)},t.prototype.height=function(t){return this.wt()*(null!=t?t:1)},t}();i.l=u},358:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.kt=void 0;var n=s(839);i.kt=function(t,i){if(t.parentElement){var s=t.parentElement,e=i.x,o=i.y,r=new ResizeObserver((function(){var i=s.getBoundingClientRect(),r=i.width,h=i.height,a=Math.min(r/e,h/o),u=t.clientWidth,c=t.clientHeight,f=Math.round(a*e),v=Math.round(a*o);f===u&&v===c||(t instanceof HTMLCanvasElement&&(t.width=f*n.B,t.height=v*n.B),t.style.width=f+"px",t.style.height=v+"px")}));return r.observe(s),r}return console.warn("aspectRatioResize: element has no parent and cannot be resized"),null}},999:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Nt=void 0;i.Nt=function(t,i,s){var n=s*Math.sqrt(3)/2;return[[t,i-2*n/3],[t+s/2,i*(n/3)],[t-s/2,i*(n/3)]]}},125:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Ct=void 0;i.Ct=function(t,i,s,n){var e=Math.sqrt(n*n/4-s*s);return[[t,i-2*e/3],[t+n/2,i*(e/3)],[t-n/2,i*(e/3)]]}},932:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.L=void 0;var n=s(965);i.L=function(t,i,s,e){void 0===e&&(e=5);for(var o=[],r=0,h=e;r<=h;r++){var a=-n.PI/(2*e)+n.D*(r/h);o.push([t+Math.cos(a)*s,i+Math.sin(a)*s])}return o}},166:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.zt=void 0;i.zt=function(t,i,s,n,e){return[Math.cos(e)*(t-s)-Math.sin(e)*(i-n)+s,Math.sin(e)*(t-s)+Math.cos(e)*(i-n)+n]}},154:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.W=void 0;var n=s(965);i.W=function(t,i,s,e,o){void 0===e&&(e=5),void 0===o&&(o=.4);for(var r=[],h=0,a=2*e;h<=a;h++){var u=-n.PI/(2*e)+n.D*(h/a),c=h%2;r.push([t+Math.cos(u)*(0===c?s:s*o),i+Math.sin(u)*(0===c?s:s*o)])}return r}},839:function(t,i,s){"use strict";var n=this&&this.Pt||(Object.create?function(t,i,s,n){void 0===n&&(n=s),Object.defineProperty(t,n,{Dt:!0,get:function(){return i[s]}})}:function(t,i,s,n){void 0===n&&(n=s),t[n]=i[s]}),e=this&&this.Et||function(t,i){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(i,s)||n(i,t,s)};Object.defineProperty(i,"i",{value:!0}),e(s(712),i),e(s(367),i),e(s(659),i),e(s(603),i),e(s(147),i),e(s(654),i),e(s(796),i),e(s(792),i),e(s(466),i),e(s(92),i),e(s(159),i),e(s(600),i),e(s(965),i),e(s(908),i),e(s(250),i),e(s(482),i),e(s(674),i),e(s(358),i),e(s(999),i),e(s(125),i),e(s(932),i),e(s(166),i),e(s(154),i)},603:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.B=void 0,i.B=window.devicePixelRatio||1},792:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Wt=void 0;i.Wt=function(t){return JSON.parse(JSON.stringify(t))}},147:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Lt=void 0;i.Lt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.every((function(t){return void 0===t}))}},654:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.et=void 0;i.et=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.some((function(t){return void 0===t}))}},796:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.G=void 0;i.G=function(t){return void 0===t}},466:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Tt=void 0;i.Tt=function(t){for(new Date;new Date-t<ms;);}},674:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Ft=void 0;var n=s(159),e=function(){function t(t,i){this.x=t,this.y=i}return Object.defineProperty(t.prototype,"ratio",{get:function(){return this.x/this.y},Dt:!1,Ht:!0}),Object.defineProperty(t.prototype,"It",{get:function(){return Math.pow(Math.pow(this.x,2)+Math.pow(this.y,2),.5)},Dt:!1,Ht:!0}),t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.Ut=function(t){return(0,n.Bt)(this.x,this.y,t.x,t.y)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.It;return 0!==t&&(this.x/=t,this.y/=t),this},t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},t.from=function(i,s){return new t(i.x-s.x,i.y-s.y)},t}();i.Ft=e},600:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.ct=void 0;i.ct=function(t,i,s){return Math.max(Math.min(s,t),i)}},92:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Jt=i.Kt=void 0;var n=s(159);i.Kt=function(t,i,s,e,o,r){return(0,n.Bt)(t,i,e,o)<=s+r};i.Jt=function(t,i,s,n,e,o,r,h){return!(i+n<o||i>o+h||t+s<e||t>e+r)}},965:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Yt=i.PI=i.D=void 0;var n=s(674);i.D=2*Math.PI,i.PI=Math.PI,i.Yt=new n.Ft(0,0)},159:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.qt=i.Bt=void 0;i.Bt=function(t,s,n,e){return Math.pow((0,i.qt)(t,s,n,e),.5)};i.qt=function(t,i,s,n){return Math.pow(s-t,2)+Math.pow(n-i,2)}},908:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.it=void 0;i.it=function(t,i,s){return i*(1-t)+s*t}},250:(t,i)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.Gt=void 0;i.Gt=function(t,i){return(t%i+i)%i}},482:(t,i,s)=>{"use strict";Object.defineProperty(i,"i",{value:!0}),i.normalize=void 0;var n=s(600);i.normalize=function(t,i,s,e){return void 0===e&&(e=!1),((e?(0,n.ct)(t,i,s):t)-i)/(s-i)}},557:function(t){var i;t.exports=(i=function(){function t(t){return e.appendChild(t.Vt),t}function s(t){for(var i=0;i<e.children.length;i++)e.children[i].style.display=i===t?"block":"none";n=t}var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(t){t.preventDefault(),s(++n%e.children.length)}),!1);var o=(performance||Date).now(),r=o,h=0,a=t(new i.Xt("FPS","#0ff","#002")),u=t(new i.Xt("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new i.Xt("MB","#f08","#201"));return s(0),{Qt:16,Vt:e,Zt:t,$t:s,ti:function(){o=(performance||Date).now()},end:function(){h++;var t=(performance||Date).now();if(u.update(t-o,200),t>r+1e3&&(a.update(1e3*h/(t-r),100),r=t,h=0,c)){var i=performance.memory;c.update(i.ii/1048576,i.si/1048576)}return t},update:function(){o=this.end()},ni:e,ei:s}},i.Xt=function(t,i,s){var n=1/0,e=0,o=Math.round,r=o(window.devicePixelRatio||1),h=80*r,a=48*r,u=3*r,c=2*r,f=3*r,v=15*r,l=74*r,d=30*r,p=document.createElement("canvas");p.width=h,p.height=a,p.style.cssText="width:80px;height:48px";var M=p.getContext("2d");return M.font="bold "+9*r+"px Helvetica,Arial,sans-serif",M.textBaseline="top",M.fillStyle=s,M.fillRect(0,0,h,a),M.fillStyle=i,M.fillText(t,u,c),M.fillRect(f,v,l,d),M.fillStyle=s,M.globalAlpha=.9,M.fillRect(f,v,l,d),{Vt:p,update:function(a,w){n=Math.min(n,a),e=Math.max(e,a),M.fillStyle=s,M.globalAlpha=1,M.fillRect(0,0,h,v),M.fillStyle=i,M.fillText(o(a)+" "+t+" ("+o(n)+"-"+o(e)+")",u,c),M.drawImage(p,f+r,v,l-r,d,f,v,l-r,d),M.fillRect(f+l-r,v,r,d),M.fillStyle=s,M.globalAlpha=.9,M.fillRect(f+l-r,v,r,o((1-a/w)*d))}}},i)}},i={};function s(n){var e=i[n];if(void 0!==e)return e.exports;var o=i[n]={exports:{}};return t[n].call(o.exports,o,o.exports,s),o.exports}s.n=t=>{var i=t&&t.i?()=>t.default:()=>t;return s.d(i,{a:i}),i},s.d=(t,i)=>{for(var n in i)s.oi(i,n)&&!s.oi(t,n)&&Object.defineProperty(t,n,{Dt:!0,get:i[n]})},s.oi=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{"use strict";var t,i=s(839),n=s(557),e=s.n(n);!function(t){t.ri="gameplay",t.hi="intro",t.ai="paused",t.ui="upgrade"}(t||(t={}));const o=new i.Ft(32,18),r=new i.Ft(o.x/2-1,o.y/2-1),h=1/o.x,a={move:{ci:!1,fi:!1,left:!1,right:!1},vi:[],timestamp:{li:0},di:[],pi:t.hi,Mi:4,wi:0};class u{constructor(t,s){this.bi=[],this.mi=0,this._i=1,this.gi=1550,this.Oi=1,this.yi=t=>{this.ji.drawImage(this.bi[this.mi],(0,i.it)(t,this.xi.x,this.position.x),(0,i.it)(t,this.xi.y,this.position.y))},this.Si=()=>{this.bi=((t,s,n,e,o)=>{const r=[];t.T(t.options.O);for(let h=0;h<e;h++){const e=document.createElement("canvas");e.width=n,e.height=n;const h=e.getContext("2d"),a=new i.Z(h,{...t.options,O:{...t.options.O,lineWidth:t.context.lineWidth},coords:new i.l({canvas:e,ht:o,ut:o})});s(a),a.context.save(),a.context.fillStyle="rgba(255,0,0,0.2)",a.context.fillRect(0,0,e.width,e.height),a.context.restore(),r.push(e)}return r})(this.ji,this.Ai,this.ji.coords.width(h*this.Oi),this._i,this.Ri)},this.ji=t,this.position=s,this.xi=s.clone()}update(t,i){this.xi.set(this.position),this.mi=Math.floor(t/this.gi%1*this.bi.length)}}const c={ki:document.querySelector("canvas#ui"),map:document.querySelector("canvas#map"),Ni:document.querySelector("canvas#gameplay")},f={ki:c.ki.getContext("2d"),map:c.map.getContext("2d"),Ni:c.Ni.getContext("2d")},v="Comic Sans MS, Chalkboard, cursive",l={strokeStyle:"white",fillStyle:"white",lineWidth:t=>t.width(.001),textAlign:"center",fontFamily:v},d={m:!0,_:"width"},p={map:new i.l({canvas:c.map,ht:[0,o.x],ut:[0,o.y]}),ki:new i.l({canvas:c.ki,padding:.1})},M={map:new i.o(f.map,{...d,coords:p.map,O:l,stroke:!0}),Ni:new i.Z(f.Ni,{...d,coords:p.map,O:{...l,lineWidth:t=>t.width(.00175)},stroke:!0,$:.1}),ki:new i.Z(f.ki,{...d,coords:p.ki,O:{...l,lineWidth:t=>t.width(.01),fontSize:t=>t.width(.1),fontFamily:v}})},w=new class extends u{constructor(t,s){super(t,s),this.size=.5,this.speed=.005,this.Ri=[-1,1],this.Ai=t=>{t.W(0,0,this.size,5)},this.update=(t,i)=>{super.update(t,i),this.Ci(t,i)},this.Ci=(t,s)=>{const n=s*this.speed,e=.7071*n;let r=0,h=0;a.move.left&&a.move.ci?(r=-e,h=-e):a.move.left&&a.move.fi?(r=-e,h=e):a.move.right&&a.move.ci?(r=e,h=-e):a.move.right&&a.move.fi?(r=e,h=e):a.move.ci?h=-n:a.move.fi?h=n:a.move.left?r=-n:a.move.right&&(r=n),this.position.x=(0,i.ct)(this.position.x+r,0,o.x-1),this.position.y=(0,i.ct)(this.position.y+h,0,o.y-1)},this.zi=(t,i,s=this.position.x,n=this.position.y)=>(s-t)**2+(n-i)**2<=this.size**2,this.Si()}}(M.Ni,r.clone());class b extends u{constructor(t){super(t,w.position.clone()),this.size=.25,this.speed=5e-4,this.Ri=[-1,1],a.di.push(this)}update(t,i){super.update(t,i),this.Ci(t,i),this.Pi()}Pi(){for(let t=0;t<a.vi.length;t++){const s=a.vi[t];(0,i.Kt)(this.position.x,this.position.y,this.Di,s.position.x,s.position.y,s.Di)&&s.Ei(t)}}}class m extends b{constructor(t){super(t),this.Wi=1.5,this.Di=.25,this.Ai=t=>{t.P(0,0,this.Di)},this.Ci=(t,s)=>{this.xi.set(this.position);const n=i.D*t*this.speed;this.position.x=w.position.x+Math.cos(n)*this.Wi,this.position.y=w.position.y+Math.sin(n)*this.Wi},this.Si()}}const _="rgb(28,5,50)",g=()=>{M.ki.clear();for(let t=0;t<a.Mi;t++){const s=new i.l({offsetX:M.ki.coords.J(-1)+M.ki.coords.width(t/a.Mi),offsetY:M.ki.coords.K(-1),ot:M.ki.coords.width()/a.Mi,rt:M.ki.coords.height(),padding:.05}),n=new i.Z(M.ki.context,{...M.ki.options,coords:s,stroke:!1});n.rect(-1,-1,1,n.coords.height()/n.coords.width(),{stroke:a.wi===t,fill:!0,O:{fillStyle:"rgba(255,255,255,.5)"}}),n.text("TEST",0,-.8,{O:{textBaseline:"top"}})}};var O;!function(t){t[t.Li=0]="Initialize",t[t.Ti=1]="CanvasResize",t[t.Fi=2]="Tick",t[t.Hi=3]="KeyDown",t[t.Ii=4]="KeyUp",t[t.Ui=5]="StateChange"}(O||(O={}));const y={[O.Li]:[],[O.Ti]:[],[O.Fi]:[],[O.Hi]:[],[O.Ii]:[],[O.Ui]:[]},j=(t,i)=>{y[t].push(i)},x=(t,...i)=>{const s=y[t];for(let t=0;t<s.length;t++)s[t](...i)};new ResizeObserver((()=>{x(O.Ti)})).observe(c.map),window.addEventListener("keydown",(t=>{x(O.Hi,t.key)})),window.addEventListener("keyup",(t=>{x(O.Ii,t.key)}));class S extends u{constructor(t,i,s){super(t,i),this.Ri=[0,100],this.Ai=t=>{t.W(0,0,this.size,5)},this.Bi=s}Ei(t){a.vi.splice(t,1)}update(t,i){super.update(t,i),this.Ci(t,i)}Ci(t,s){this.Bi.Ji&&((t,s,n)=>{const e=i.Ft.from(w.position,t).normalize().multiply(s*n.Ki);t.x+=e.x,t.y+=e.y})(this.position,s,this.Bi.Ji),this.Bi.Yi&&((t,s,n)=>{const e=i.Ft.from(w.position,t);if(e.It<n.Bt){const i=e.normalize().multiply(s*n.Ji);t.x+=i.x,t.y+=i.y}else{if(t.equals(n.qi))return;if(t.Ut(n.qi)<.1)t.set(n.qi);else{const e=i.Ft.from(n.qi,t).normalize().multiply(s*n.Ji);t.x+=e.x,t.y+=e.y}}})(this.position,s,this.Bi.Yi)}}class A extends S{constructor(t,i){super(t,i,{Yi:{Ji:.002,Bt:3,qi:i.clone()}}),this.Di=.5,this.size=.5,this.speed=.002,this.bi=[],this.Si()}}const R=[[[95,56],[75,43],[51,35],[43,53],[40,65],[40,82],[44,91],[49,95],[54,96],[65,94],[72,90],[86,74],[96,59],[95,56]],[[53,85],[49,80],[47,68],[56,79],[71,80],[59,85],[53,85]],[[73,71],[67,65],[76,65],[81,72],[73,71]],[[54,62],[49,55],[57,56],[63,62],[54,62]],[[39,47],[33,49],[27,56],[31,45],[36,42],[42,42],[44,36],[48,29],[52,29],[57,31],[55,20],[49,2],[24,7],[2,19],[11,42],[23,57],[35,63],[39,47]],[[43,22],[51,25],[43,29],[35,25],[43,22]],[[25,36],[16,38],[20,31],[29,29],[25,36]]];class k extends S{constructor(t,i){super(t,i,{Ji:{Ki:.002}}),this.Di=1,this.size=1,this.speed=.002,this.Oi=2,this.Ai=t=>{R.forEach((i=>t.N(i)))},this.Si()}}let N=0;j(O.Li,((t=1)=>{for(let s=0;s<t;s++){const t=Math.random()*o.x,s=Math.random()*o.y,n=new i.Ft(t,s),e=new k(M.Ni,n);a.vi.push(e)}}));const C=new(e()),z=C.Zt(new(e().Xt)("phys","#0ff","#002"));C.Vt.id="stats",document.body.appendChild(C.Vt);const P=1e3/60;let D=0,E=0,W=0;const L=(i=0)=>{C.ti();const s=a.pi!==t.ri?0:i-E;for(E=i,W+=Math.min(s,50);W>=P;)T(),W-=P,D+=P;F(W/P),C.end(),window.requestAnimationFrame(L)},T=()=>{z.update(59.99999999999999,200),w.update(D,P);for(let t=0;t<a.di.length;t++)a.di[t].update(D,P);for(let t=0;t<a.vi.length;t++)a.vi[t].update(D,P);(t=>{if(t-a.timestamp.li>1e3&&N<0){a.timestamp.li=t;const s=Math.random()*o.x,n=Math.random()*o.y,e=new i.Ft(s,n),r=new A(M.Ni,e);a.vi.push(r),N++}})(D)},F=t=>{M.Ni.clear(),w.yi(t);for(let i=0;i<a.di.length;i++)a.di[i].yi(t);for(let i=0;i<a.vi.length;i++)a.vi[i].yi(t)};(0,i.kt)(c.map,o),(0,i.kt)(c.Ni,o),(0,i.kt)(c.ki,o),j(O.Hi,(s=>{"ArrowLeft"!==s&&"a"!==s||(a.pi===t.ri&&(a.move.left=!0),a.pi===t.ui&&(a.wi=(0,i.Gt)(a.wi-1,a.Mi),g())),"ArrowRight"!==s&&"d"!==s||(a.pi===t.ri&&(a.move.right=!0),a.pi===t.ui&&(a.wi=(0,i.Gt)(a.wi+1,a.Mi),g())),"ArrowUp"!==s&&"w"!==s||(a.move.ci=!0),"ArrowDown"!==s&&"s"!==s||(a.move.fi=!0),"Escape"===s&&a.pi===t.ri&&x(O.Ui,t.ai)})),j(O.Ii,(i=>{"ArrowLeft"!==i&&"a"!==i||(a.move.left=!1),"ArrowRight"!==i&&"d"!==i||(a.move.right=!1),"ArrowUp"!==i&&"w"!==i||(a.move.ci=!1),"ArrowDown"!==i&&"s"!==i||(a.move.fi=!1),"Enter"===i&&a.pi===t.ai&&x(O.Ui,t.ri)})),j(O.Ti,(()=>{(t=>{for(let i=0;i<o.x;i++)for(let s=0;s<o.y;s++)t.rect(i,s,1/o.x,1/o.x,{O:{strokeStyle:"rgba(255,255,255,0.1)"}})})(M.map),w.Si(),a.di.forEach((t=>t.Si())),a.vi.forEach((t=>t.Si())),a.pi===t.ui&&g()})),j(O.Ui,(i=>{if(i===t.ui)a.wi=0;a.pi=i})),j(O.Li,(()=>{document.body.style.backgroundColor=_,new m(M.Ni)})),x(O.Li),x(O.Ui,t.ri),window.requestAnimationFrame(L)})()})();</script></body></html>